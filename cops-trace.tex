\begin{figure*}[!t]
\captionsetup[subfigure]{aboveskip=0pt, belowskip=5pt}

\[
\begin{multlined}
\ToCOPSProg{\copsconf_0 |  \cl,\repl_1:(\opW,(\txid_1,\repl_1)) 
            -> \copsconf_1 | \cl,\repl_1:\mathtt{s}
            -> \copsconf_2 | \cl,\repl_1:(\opR,(\txid_1,\repl_1))
            -> \copsconf_3 | \repl_1:\mathtt{sync}
            -> \copsconf_4 | \cl,\repl_1:(\opR,(\txid_2,\repl_2)) 
            -> \copsconf_5
}
\\[-3pt] \ToCOPSProg{ {\ } | \cl,\repl_1:\mathtt{p}
            -> \copsconf_6 | \cl,\repl_1:(\opR,(\txid_1,\repl_2))
            -> \copsconf_7 | \lb
            -> \copsconf_8 | \cl,\repl_1:(\opR,(\txid_2,\repl_2))
            -> \copsconf_9 | \cl,\repl_1:\mathtt{e}
            -> \cdots
            }
\end{multlined}
\]

\vspace*{-10pt}

\hrulefill

\vspace*{-6pt}

\begin{centertikz}
%Location x
\node(locx) {$\key_1 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
    /\val_0/{(\txid_0,\repl_0)}/\stub
    , /\val_1/{(\txid_1,\repl_1)}/\stub
    , nonvisible/\val'_1/{(\txid_1,\repl_2)}/\stub
}};

%Location y
\path (versionx.east) + (0.75,0) node (locy) {$\key_2 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locy.east) {vlist={versiony}{%
    /\val_0/{(\txid_0,\repl_0)}/\stub
    , nonvisible/\val_2/{(\txid_2,\repl_2)}/\stub
}};

\end{centertikz}

\vspace*{-15pt}

\hrulefill

\caption{Above: the COPS trace that repreduces \cref{fig:cops-request-values,fig:cops-re-read-values}. 
Below: the kv-store encoding of \cref{fig:initial-cops}, and a view (highlighted) encoding of a client context.}
\label{fig:cops-trace}
\label{fig:cops-encode}
\label{fig:encode-mkvs}
\label{fig:encode-view}
\end{figure*}

