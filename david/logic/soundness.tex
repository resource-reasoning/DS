\subsection{Soundness}

The soundness of mCAP is established by relating its proof judgements to the operational semantics. The link is created through a \textit{reification} function that transforms worlds, as defined in Section \ref{worlds}, to concrete machine states. As we constructed mCAP as an instantiation of the views framework \cite{views}, its soundness follows from the soundness of views, given that the transactions (atomic commands) are sound with respect to their operational semantics.

\begin{param}
	(Machine state reification).
	Given the pcm for machine states $(\mathbb{M}, \bullet_\mathbb{M}, \mathbf{0}_\mathbb{M})$, assume a \emph{reification function} $\lfloor - \rfloor_\mathbb{M} : \mathbb{M} \rightarrow \mathcal{P}(\mathcal{S})$ which associates machine states to sets of concrete ones.
\end{param}

\begin{param}
	\label{param:ecmdSound}
	(Elementary command soundness).
	Given the pcm for machine states $(\mathbb{M}, \bullet_\mathbb{M}, \mathbf{0}_\mathbb{M})$ and its associated reification function $\lfloor - \rfloor_\mathbb{M}$, assume that for every elementary command $\hat{\mathds{C}} \in \mathsf{ECmd}$, the corresponding axiom $(M_1, \hat{\mathds{C}}, M_2) \in \textsc{Ax}_{\hat{\mathsf{C}}}$ and any given machine state $m \in \mathbb{M}$ the following \emph{soundness} property holds:
	\[
		\tsem{\hat{\mathds{C}}}(\lfloor M_1 \bullet_\mathbb{M} \{m\} \rfloor_\mathbb{M}) \subseteq \lfloor M_2 \bullet_\mathbb{M} \{m\} \rfloor_\mathbb{M}
	\]
\end{param}

\begin{defn}
	(Reification).
	The \emph{reification of worlds}, $\lfloor - \rfloor_W : \mathsf{World} \rightarrow \mathcal{P}(\mathcal{S})$, is defined as follows.
	\[
		\lfloor (l, g, \mathcal{J}) \rfloor_W \triangleq \lfloor (l \circ g)_\mathsf{M} \rfloor_\mathbb{M}
	\]
\end{defn}
We transform worlds into machine states by dropping the action model, composing the local and the shared state together, and removing all of the region capabilities from it.

\thm (Transaction soundness). For all $\mathds{T} \in \mathsf{Trans}, (W_1, \mathds{T}, W_2) \in \textsc{Ax}_\mathsf{T}$ and $w \in \mathsf{World}$:
\[
	\tsem{\mathds{T}}_\mathsf{T}(\lfloor W_1 \bullet_\mathbb{M} \{ w \} \rfloor_W) \subseteq \lfloor W_2 \bullet_\mathbb{M} R(\{ w \}) \rfloor_W
\]

{\parindent0pt
\begin{proof}
By induction on the structure of $\mathds{T}$. \\	

\textit{Case}: $\ptdef{\mathds{C}}$

Let's pick an arbitrary $\mathds{C} \in \mathsf{Cmd}, w \in \mathsf{World}$ and $W_1, W_2 \in \mathcal{P}(\mathsf{World})$ such that $(W_1, \ptdef{\mathds{C}}_\iota, W_2) \in \textsc{Ax}_\mathsf{T}$ holds. From the definition of $\textsc{Ax}_\mathsf{T}$ we know that there exists $M_1, M_2 \in \mathcal{P}(\mathbb{M})$ such that:
\begin{gather}\label{tsound:1}
	(M_1, \mathds{C}, M_2) \in \textsc{Ax}_\mathsf{S} \land W_1 \Rrightarrow^{\{M_1\}\{M_2\}} W_2
\end{gather}

\textit{To show}:
\[
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor W_1 \bullet \{w\} \rfloor_W) \subseteq \lfloor W_2 \bullet R(\{w\}) \rfloor_W
\]

Let's pick an arbitrary $w_1 = (l_1, g_1, \mathcal{J}_1) \in W_1$. We are now left to show that there exists a $w_2 \in \mathsf{World}$ and $w' \in R(w)$ such that:
\[
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W) = \lfloor w_2 \bullet w' \rfloor_W
\]

From the definition of $\tsem{-}_\mathsf{T}, \lfloor - \rfloor_W$, and the properties of $\bullet$ and $\bullet_\mathbb{M}$ we have:
\begin{align}
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W) =\
		&\tsem{\mathds{C}}_\mathsf{C}(\lfloor w_1 \bullet w \rfloor_W) \\
		\label{tsound:2} =\ &\tsem{\mathds{C}}_\mathsf{C}\left( \lfloor (l_1 \oplus g_1)_\mathsf{M} \bullet_\mathbb{M} (w_\mathsf{L})_\mathsf{M} \rfloor_\mathbb{M} \right)
\end{align}

From (\ref{tsound:1}) and the definition of $\Rrightarrow$ we know there exists $m_1 \in M_1$ and $m' \in \mathbb{M}$ such that:
\begin{gather}
\label{tsound:3} m_1 \bullet_\mathbb{M} m' = (l_1 \oplus g_1)_\mathsf{M} \land \\
\label{tsound:4} \forall m_2 \in M_2 \ldotp \exists w_2 = (l_2, g_2, \mathcal{J}_2) \in W_2 \ldotp m_2 \bullet_\mathbb{M} m' = (l_2 \oplus g_2)_\mathsf{M} \land (w_1, w_2) \in G
\end{gather}

From (\ref{tsound:2}) and (\ref{tsound:3}) we get:
\begin{gather}\label{tsound:5}
\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W) =
\tsem{\mathds{C}}_\mathsf{C}(\lfloor m_1 \bullet_\mathbb{M} m' \bullet_\mathbb{M} (w_\mathsf{L})_\mathsf{M} \rfloor_\mathbb{M})
\end{gather}

From (\ref{tsound:1}) and the soundness of commands shown in Theorem \ref{thm:cSound}, we can rewrite (\ref{tsound:5}) as:
\[
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W)
	\subseteq
	\lfloor M_2 \bullet_\mathbb{M} \{m' \bullet_\mathbb{M} (w_\mathsf{L})_\mathsf{M}\} \rfloor_\mathbb{M}
\]

Which means that there exists a $m_2 \in M_2$ such that:
\begin{gather}\label{tsound:6}
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W)
	=
	\lfloor m_2 \bullet_\mathbb{M} m' \bullet_\mathbb{M} (w_\mathsf{L})_\mathsf{M} \rfloor_\mathbb{M}
\end{gather}

From (\ref{tsound:4}) we know that there exists $w_2 \in \mathsf{World}$ such that:
\begin{gather}
\label{tsound:8} w_2 = (l_2, g_2, \mathcal{J}_2) \in W_2 \land m_2 \bullet_\mathbb{M} m' = (l_2 \oplus g_2)_\mathsf{M} \\
\label{tsound:7} \land\ (w_1, w_2) \in G
\end{gather}

From the definition of $\lfloor - \rfloor_W$ and the properties of $\bullet_\mathbb{M}$ and $\bullet$ we can rewrite (\ref{tsound:6}) as:
\begin{gather}\label{tsound:9}
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W)
	=
	\lfloor (l_2 \circ w_\mathsf{L}, g_2, \mathcal{J}_2) \rfloor_W
\end{gather}

From (\ref{tsound:7}) and Lemma \ref{lem:R} we know that there exists a $w' \in \mathsf{World}$ such that:
\begin{gather}\label{tsound:10}
	w' = (w_\mathsf{L}, g_2, \mathcal{J}_2) \land w' \in R(w)
\end{gather}

From (\ref{tsound:8}), (\ref{tsound:9}) and (\ref{tsound:10}) we know that there exists a $w_2 \in W_2$ and $w' \in R(w)$ such that:
\[
	\tsem{\ptdef{\mathds{C}}}_\mathsf{T}(\lfloor w_1 \bullet w \rfloor_W) = \lfloor w_2 \bullet R(w) \rfloor_W
\]
\end{proof}
}

\begin{thm}
	(Soundness).
	For all predicate axioms $\Delta \in \mathsf{Ax}$, assertions $P, Q \in \mathsf{Assn}$ and program $\mathds{P} \in \mathsf{Prog}$, if $\Delta \vdash \triple{P}{\mathds{P}}{Q}$ then $\Delta \vDash \triple{P}{\mathds{P}}{Q}$.
\end{thm}