\subsection{Update Atomic \( \UA \)}
\label{sec:sound-complete-ua}

Given abstract execution \( \aexec \), we define write-write relation for a key \( \ke \) as the following:
\[ 
    \WW(\aexec,\ke) \defeq \Setcon{(\txid, \txid')}{\txid \toEdge{\AR_\aexec} \txid' \land (\otW,\ke, \stub ) \in \txid \land (\otW,\ke, \stub ) \in \txid'  } 
\]
Then, the notation \( \WW_\aexec \defeq \bigcup_{\ke \in \Keys} \WW(\aexec, \ke) \).
Note that for a key-value store \( \mkvs \) such that \( \mkvs = \mkvs_\aexec \),
by the definition of  \(  \mkvs = \mkvs_\aexec \), 
the following holds:
\[
    \WW_\aexec = \Setcon{(\txid, \txid')}{\exsts{\ke, i,j } \txid = \WTx(\mkvs(\ke, i)) \land \txid' = \WTx(\mkvs(\ke, j)) \land i < j}
\]
Also the \( \WW_\aexec \) coincides with \( \WW_\Gr \) and \( \WW_\mkvs \).

The execution test $\ET_\UA$ is sound with respect to the axiomatic specification \( (\RP_{\LWW}, \Set{\lambda \aexec. \WW_\aexec }) \).
We pick the invariant as \( I( \aexec, \cl ) = \emptyset \), given the fact of no constraint on the final view.
Assume a key-value store $\hh$, an initial and a final view $\vi, \vi'$  a fingerprint $\opset$ 
such that $\ET_{\UA} \vdash (\hh, \vi) \csat \opset: (\hh', \vi')$. 
Also choose an arbitrary $\cl$, a transaction identifier $\txid \in \nextTxId(\hh, \cl)$, 
and an abstract execution $\aexec$ such that $\hh_{\aexec} = \hh$ and 
\( I(\aexec, \cl) =  \emptyset \subseteq \Tx(\hh, \vi) \).
Let \( \aexec' = \extend(\aexec, \txid, \Tx(\mkvs, \vi), \f ) \).
Note that since the invariant is empty set, it remains to prove the following:
\[
    \begin{array}{@{}l@{}}
        \fora{ \txid' } \txid' \toEdge{\WW_{\aexec'}} \txid \implies \txid' \in \Tx(\mkvs, \vi)
    \end{array}
\]
Assume a transaction \( \txid' \) that writes to a key \( \ke \) as \( \txid \), \ie \( \txid' \toEdge{\WW_{\aexec'}} \txid \).
Since that \( \txid' \) is a transaction already existing in \( \mkvs\),
we have \( \WTx(\mkvs(\ke, i)) = \txid' \) for some index \( i \).
By the execution test of \( \UA \), we know \( i \in \vi(\ke) \) therefore \( \txid' \in \Tx(\mkvs, \vi) \).

The execution test $\ET_\UA$ is complete with respect to 
the axiomatic specification \( (\RP_{\LWW}, \Set{\lambda \aexec. \WW_\aexec }) \).
Assume i-\emph{th} transaction \( \txid_i \) in the arbitrary order,
and let view \( \vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}) ) \).
We also pick any final view such that \( \vi'_{i} \subseteq \getView(\aexec, (\AR^{-1}_{\aexec})?(\txid_{i}) ) \).
Note that there is nothing to prove for \( \vi'_i \),
so it is sufficient to prove the following:
\[
    \fora{\ke} (\otW, \ke, \stub) \in \TtoOp{T}_{\aexec}(\txid_{i}) 
    \implies 
    \fora{j : 0 \leq j < \abs{\mkvs_{\cut(\aexec, i-1)}(\ke)}} j \in \vi_i(\ke)
\]
Let consider a key \( \ke \) that have been overwritten by the transaction \( \txid_i \).
By the constraint of \( \aexec \) that \( \WW_\aexec \subseteq \VIS_\aexec \),
for any transaction \( \txid \) that writes to the same key \( \ke \) and committed before \( \txid_i \), 
they are included in the visible set \(\txid \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
Note that \( \txid \toEdge{\WW_\aexec} \txid_i \implies \txid \toEdge{\AR_\aexec} \txid_i \implies \txid \in \mkvs_{\cut(\aexec,i-1)}\).
Since that the transaction \( \txid \) write to the key \( \ke \),
it means \( \WTx(\mkvs_{\cut(\aexec, i-1)}(\ke,j)) = \txid \) for some index \( j \).
Then by the definition of \( \getView \), we have \( j \in \vi_i(\ke)\).
