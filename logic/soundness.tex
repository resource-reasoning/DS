The \cref{thm:transaction-soundness} is the soundness of for transactions, where the most interesting two rules \rl{TRLookup} and \rl{TRMutate} can be derived from the \cref{lem:fingerprint-op}.

\begin{theorem}[Transaction soundness]
\label{thm:transaction-soundness}
The transaction soundness is as follows:
\[
    \begin{array}{@{}l@{}}
        \fora{ \lpre, \trans, \lpost } \tripleL{\lpre}{\trans}{\lpost}
        \implies 
        \fora{\lenv, \stk, \stk', \h, \h', \opset, \opset' }  \\
        \quad (\h, \opset) \in \evalLS[\lenv, \stk]{\lpre}
        \land \vdash (\stk, \h, \opset ), \trans \toL^{*}  (\stk', \h', \opset' ), \pskip 
        \implies (\h', \opset') \in \evalLS[\lenv, \stk']{\lpost}
    \end{array}
\]
\end{theorem}

\begin{lemma}
\label{lem:fingerprint-op}
For \( \mathtt{O} \in \Set{\otR, \otW} \), the relation \( \toFP{\mathtt{O}(\ke,\val')}\) is sound with respect to the operator \( \addO \):
\[
\begin{array}{@{}l}
    \fora{\lpre, \lpost, \lenv, \stk, \stk', \opset, \opset', \mathtt{O}, \ke, \val} \\
    \quad \mathtt{O} \in \Set{\otR, \otW} 
    \land \lpre \toFP{\mathtt{O}(\ke,\val)} \lpost
    \land (\stub, \opset) \in \evalLS{\lpre}
    \land (\stub, \opset') \in \evalLS{\lpost}
    \implies \opset' = \opset \addO (\mathtt{O}, \ke, \val)
\end{array}
\]
\end{lemma}

The soundness for program includes the soundness for single client and for the parallel rule.
\cref{cmd:soundness-judgement-cmd} is the soundness for a single client.
The soundness says that for any terminated trace defined by \( \pred{stepc}{\nat, \w, \w', \stk, \stk', \cmd, \et} \) predicate,
if the initial state \( \w \) satisfies the precondition \( \gpre \), if every step in the trace is either a rely step from the environment, 
or the command runs one step, the final world \( \w' \) should satisfy the postcondition \( \gpost \).

\begin{definition}[soundness judgement for commands]
\label{def:soundness-judgement-cmd}
\label{def:semantic-triple}
\label{def:triple-semantic}
\label{def:semantic-steps}
The \( \predn{stepc} \) predicate is defined as the follows:
\[
\begin{rclarray}
    \pred{stepc}{0,\w, \w', \stk, \stk',\pskip, \como} & \defeq & 
    \begin{array}[t]{@{}l}
    \stk = \stk' \land \w = \w'
    \end{array} \\
    \pred{stepc}{\nat + 1,\w, \w', \stk, \stk', \cmd, \como} & \defeq &
    \begin{array}[t]{@{}l}
        \exsts{ \hh, \hh'', \w''}  
        (\w,\w'') \in \Rely  
        \land (\hh, \stub ) = \clpsW{\w}
        \land (\hh'', \stub ) = \clpsW{\w''} \\
        \quad {} \land (\hh, \hh'') \in \como 
        \land \pred{stepc}{\nat, \w'', \w', \stk, \stk', \cmd, \como} \\
    \end{array} \\
    \pred{stepc}{\nat + 1,\w, \w', \stk, \stk', \cmd, \como} & \defeq &
    \begin{array}[t]{@{}l}
        \exsts{\cl, \w'', \stk'', \thid, \cmd'}
        \land (\clpsW{\w}, \stk), \cmd \toT{\como} ( \clpsW{\w''}, \stk'' ), \cmd' \\
        \quad {} \land (\w, \w'') \in \Guar
        \land \pred{stepc}{\nat, \w'', \w', \stk'', \stk', \cmd', \como} \\
    \end{array}
\end{rclarray}
\]
The \emph{soundness judgement for commands} is as the follows:
\[
\begin{rclarray}
    \como \tripleSemG{\gpre}{\cmd}{\gpost} & \defeq &
    \begin{array}[t]{@{}l@{}}
        \fora{ \w,\w', \stk, \stk', \lenv, \nat }  
        \w \in \evalW[\lenv, \stk]{\gpre} 
        \land \pred{stepc}{\nat, \w, \w', \stk, \stk', \cmd, \como}
        \implies \w' \in \evalW[\lenv, \stk']{\gpost} 
    \end{array}
\end{rclarray}
\]
\end{definition}                                         

To prove \cref{def:soundness-judgement-cmd}, especially for the \rl{PRFrame} rule, we need \cref{lem:locality-update} and \cref{lem:mono-view}.
The \emph{locality of update} (\cref{lem:locality-update}) assures that the stable frame \( \gframe \) always holds in a sense that the states of kv-stores match.
Note that the view of the frame does not change with respect to the update.
Yet because of \emph{the monotonicity of view} (\cref{lem:mono-view}), and the view after update will eventually matches views of the frame because of the view shift rely.


\begin{lemma}[Locality of update]
\label{lem:locality-update}
When a client executes a transaction allowed by guarantee, the effect to the key-value store is included in the rely of other clients.
\[
\begin{array}{@{}l}
    \fora{\w_g, \w_g', \w_r, \mkvs} (\w_g\projection{1} \composeC \w_r\projection{1} )\isdef \land (\mkvs, \stub) = \clpsW{\w_g} \land  (\mkvs, \stub) = \clpsW{\w_r} \land (\w_g, \w_g') \in \Guar  \\
    \quad \implies \exsts{\w_r', \mkvs'} (\w_g'\projection{1} \composeC \w_r'\projection{1})\isdef \land (\mkvs', \stub) = \clpsW{\w_g'} \land  (\mkvs', \stub) = \clps{\w_r'} \land (\w_r, \w_r') \in \Rely 
\end{array} 
\]
\end{lemma}

\begin{lemma}[Monotonicity of view]
\label{lem:mono-view}
The view monotonically increases with respect to the operational semantic for commands:
\[
    \begin{array}{@{}l}
        \fora{\mkvs, \mkvs', \stk, \stk', \vi, \vi', \cmd, \cmd'} (\mkvs, \vi, \stk), \cmd \toT{\et} (\mkvs', \vi', \stk'), \cmd' \implies \vi \leq \vi'
    \end{array}
\]
\end{lemma}

Last, the soundness for \rl{PRPar} asserts that when one client commits a transaction, there exists corresponding rely steps for all other clients so that the state of key-value stores match;
and when all clients reach \( \pskip \), the final key-value stores and views are the same.
Note that the views for clients does not need to be same in the intermediate steps.
The proof can be derived from locality of update (\cref{lem:locality-update}) and monotonicity of view (\cref{lem:mono-view}).

