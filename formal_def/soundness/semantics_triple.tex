\subsection{Triple Semantics}

\sx{How to deal with the stack? }

\begin{defn}[Soundness Judgement]
\label{def:semantic-triple}
\label{def:triple-semantic}
\label{def:semantic-steps}
\label{def:soundness-judgement}
%The collapse of update rely, written \( \clpsR{\relyU} \), is defined with respect to pointwise collapsing each elements of pairs and the second abstract executions in a pair must be reachable from the first one.
%\[
%\begin{rclarray}
    %\clpsR{\relyU} & \defeq & 
    %\Setcon{
        %(\aexec, \aexec')
    %}{
        %\exsts{\w, \w', \evset}  
        %\aexec \in \clpsW{\w}
        %\land \aexec' \in \clpsW{\w'}
        %\land ( \w, \w' ) \in \relyU
        %\land (\aexec, \evset, \aexec') \in \func{transinv}{\w}
    %}
%\end{rclarray}
%\]
%Therefore the collapse of rely is \( (\aexec,\aexec') \in \clpsR{\Rely} \iffdef ( \aexec, \aexec' ) \in \closure{(\clpsR{\relyU})} \).
%The collapse of guarantee, \( \clpsG{\Guar}\), is defined in a similar way.
The \( \predn{step} \) predicate is defined as the follows,
\sx{To define \( \w, \w' \in \como\) which is straightforward. }
\[
\begin{rclarray}
    \pred{step}{0,\w, \w', \stk, \stk',\pskip, \como} & \defeq & 
    \begin{array}[t]{@{}l}
    \for{\hh, \hh', \vi, \vi'} \stk = \stk' \land {} \\
    \quad  ( (\hh, \vi, \stub) \in \clpsW{\w} \land (\hh', \vi', \stub) \in \clpsW{\w'}  \implies \hh = \hh' \land \vi = \vi' ) \\
    \end{array} \\
    \pred{step}{\nat + 1,\w, \w', \stk, \stk', \cmd, \como} & \defeq & \exsts{ \w''} (\w,\w'') \in \Rely \land (\w, \w') \in \como \land \pred{step}{\nat, \w'', \w', \stk, \stk', \cmd} \\
    \pred{step}{\nat + 1,\w, \w', \stk, \stk', \cmd, \como} & \defeq &
    \begin{array}[t]{@{}l}
        \for{\hh, \hh'', \vi, \vi'', \stk'', \lb, \thid, \cmd'}
        (\hh,\vi, \stub) \in \clpsW{\w} \\
        \quad {} \land \como, \thid \vdash (\hh, \vi, \stk), \cmd \toT{\lb} (\hh'', \vi'', \stk'', \como), \cmd' \\
        \quad {} \implies \exsts{\w''}
        (\hh'',\vi'', \stub) \in \clpsW{\w''} 
        \land (\w, \w'') \in \Guar
        \land \pred{step}{\nat, \w'', \w', \stk'', \stk', \cmd', \como} \\
    \end{array}
\end{rclarray}
\]
Given above the semantics of the triple is as the follows,                                                  
\[
\begin{rclarray}
    \como \tripleSemG{\gpre}{\cmd}{\gpost} & \defeq &
    \begin{array}[t]{@{}l@{}}
        \for{ \w,\w', \stk, \stk', \lenv, \nat }  
        \w \in \evalW[\lenv, \stk]{\gpre} 
        \land \pred{step}{\nat, \w, \w', \stk, \stk', \cmd, \como}
        \implies \w' \in \evalW[\lenv, \stk']{\gpost} 
    \end{array}
\end{rclarray}
\]
\end{defn}                                         

Here it is a over approximation of the view environment that assumes the view environment does not intertwine with the current view.
For many consistency models this judgement is good enough, because the specifications do not mentioned the view environment.
Yet the soundness judgement for SI, for example, is not very strong since it includes some cases that are allowed locally but might be disallowed when the view environment comes in.
