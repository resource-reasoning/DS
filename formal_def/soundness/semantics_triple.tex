\subsection{Triple Semantics}

\sx{How to deal with the stack? }

\begin{defn}[Triple semantics]
\label{def:semantic-triple}
\label{def:triple-semantic}
\label{def:semantic-steps}
%The collapse of update rely, written \( \clpsR{\relyU} \), is defined with respect to pointwise collapsing each elements of pairs and the second abstract executions in a pair must be reachable from the first one.
%\[
%\begin{rclarray}
    %\clpsR{\relyU} & \defeq & 
    %\Setcon{
        %(\aexec, \aexec')
    %}{
        %\exsts{\w, \w', \evset}  
        %\aexec \in \clpsW{\w}
        %\land \aexec' \in \clpsW{\w'}
        %\land ( \w, \w' ) \in \relyU
        %\land (\aexec, \evset, \aexec') \in \func{transinv}{\w}
    %}
%\end{rclarray}
%\]
%Therefore the collapse of rely is \( (\aexec,\aexec') \in \clpsR{\Rely} \iffdef ( \aexec, \aexec' ) \in \closure{(\clpsR{\relyU})} \).
%The collapse of guarantee, \( \clpsG{\Guar}\), is defined in a similar way.
The \( \predn{step} \) predicate is defined as the follows,
\[
\begin{rclarray}
    \pred{step}{0,\w, \w', \prog} & \defeq & \True \\
    \pred{step}{\nat + 1,\w, \w', \prog} & \defeq & (\w,\w'') \in \Rely \land \pred{step}{\nat, \w'', \w', \prog} \\
    \pred{step}{\nat + 1,\w, \w', \prog} & \defeq &
    \begin{array}[t]{@{}l}
        \for{\hh, \hh'', \cu, \cu'', \thcu, \thcu'', \thstk, \thstk'', \lb, \thid}
        (\hh,\cu) \in \clpsW{\w}
        \land \thcu(\thid) = \cu \\
        \quad {} \land \func{como}{\w}, \thid \vdash (\hh, \thcu, \thstk), \prog \toT{\lb} (\hh'', \thcu'', \thstk''), \prog' \\
        \quad {} \implies \exsts{\w''}
        (\hh'',\cu'') \in \clpsW{\w''}
        \land \thcu''(\thid) = \cu'' \\
        \qquad {} \land (\w, \w'') \in \Guar
        \land \pred{step}{\nat - 1, \w'', \w', \prog'} \\
    \end{array}
\end{rclarray}
\]
Given above the semantics of the triple is as the follows,                                                  
\[
\begin{rclarray}
    \tripleSemG{\gpre}{\prog}{\gpost} & \defeq &
    \begin{array}[t]{@{}l@{}}
        \for{ \w_{p},\w_{q}, \stk_{p}, \stk_{q}, \lenv, \nat }  
        \w_{p} \in \evalW[\lenv, \stk_{p}]{\gpre} 
        \land \pred{step}{\nat, \w_{p}, \w_{q}, \prog}
        \implies \w_{q} \in \evalW[\lenv, \stk_{q}]{\gpost} 
    \end{array}
\end{rclarray}
\]
\end{defn}                                         
