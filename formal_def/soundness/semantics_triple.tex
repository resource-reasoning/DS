\subsection{Triple Semantics}

\sx{How to deal with the stack? }

\begin{defn}[Soundness Judgement]
\label{def:semantic-triple}
\label{def:triple-semantic}
\label{def:semantic-steps}
\label{def:soundness-judgement}
%The collapse of update rely, written \( \clpsR{\relyU} \), is defined with respect to pointwise collapsing each elements of pairs and the second abstract executions in a pair must be reachable from the first one.
%\[
%\begin{rclarray}
    %\clpsR{\relyU} & \defeq & 
    %\Setcon{
        %(\aexec, \aexec')
    %}{
        %\exsts{\w, \w', \evset}  
        %\aexec \in \clpsW{\w}
        %\land \aexec' \in \clpsW{\w'}
        %\land ( \w, \w' ) \in \relyU
        %\land (\aexec, \evset, \aexec') \in \func{transinv}{\w}
    %}
%\end{rclarray}
%\]
%Therefore the collapse of rely is \( (\aexec,\aexec') \in \clpsR{\Rely} \iffdef ( \aexec, \aexec' ) \in \closure{(\clpsR{\relyU})} \).
%The collapse of guarantee, \( \clpsG{\Guar}\), is defined in a similar way.
The \( \predn{step} \) predicate is defined as the follows,
\sx{To define \( \w, \w' \in \como\) which is straightforward.}
\[
\begin{rclarray}
    \pred{step}{0,\w, \w', \pskip, \como} & \defeq & \True \\
    \pred{step}{\nat + 1,\w, \w', \cmd, \como} & \defeq & (\w,\w'') \in \Rely \land (\w, \w') \in \como \land \pred{step}{\nat, \w'', \w', \cmd} \\
    \pred{step}{\nat + 1,\w, \w', \cmd, \como} & \defeq &
    \begin{array}[t]{@{}l}
        \for{\hh, \hh'', \vi, \vi'', \vienv, \vienv'', \stk, \stk'', \lb, \thid}
        (\hh,\vi, \stub) \in \clpsW{\w}
        \land \thcu(\thid) = \cu \\
        \quad {} \land \como, \thid \vdash (\hh, \vienv, \stk), \cmd \toT{\lb} (\hh'', \vienv'', \stk''), \cmd' \\
        \quad {} \implies \exsts{\w''}
        (\hh'',\vi'', \stub) \in \clpsW{\w''}
        \land \vienv''(\thid) = \cu'' \\
        \qquad {} \land (\w, \w'') \in \Guar
        \land \pred{step}{\nat, \w'', \w', \cmd'} \\
    \end{array}
\end{rclarray}
\]
Given above the semantics of the triple is as the follows,                                                  
\[
\begin{rclarray}
    \tripleSemG{\gpre}{\cmd}{\gpost} & \defeq &
    \begin{array}[t]{@{}l@{}}
        \for{ \w_{p},\w_{q}, \stk_{p}, \stk_{q}, \lenv, \nat }  
        \w_{p} \in \evalW[\lenv, \stk_{p}]{\gpre} 
        \land \pred{step}{\nat, \w_{p}, \w_{q}, \cmd}
        \implies \w_{q} \in \evalW[\lenv, \stk_{q}]{\gpost} 
    \end{array}
\end{rclarray}
\]
\end{defn}                                         
