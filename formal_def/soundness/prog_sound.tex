\subsection{Program Soundness}
\begin{thm}[Program soundness]
The program soundness is the follows,
\[
    \for{\gpre, \prog, \gpost}
    \tripleG{\gpre}{\prog}{\gpost} 
    \implies 
    \tripleSemG{\gpre}{\prog}{\gpost} 
\]
\end{thm}
\begin{proof}
Induction on the rules of programs.
\caseB{\rl{PRCommit}}
We have \( \prog \equiv \ptrans{\trans} \).
Because a transaction is reduced by one step in the semantic and the rely \( \Rely \) is transitive, it is sufficient to prove for any \( \w,\w''',\thid, \thstk, \thstk', \aexecrun,\aexecrun', \aexecrun'', \aexecrun''', \txid \),
\[
\begin{array}{l}
    \w \in \evalW{\gpre} 
    \land \aexecrun \in \clpsW{\w} \\
    \quad \land \thid, \como \vdash (\thstk, \aexecrun), \ptrans{\trans} 
    \toT{\lbRELY} (\thstk, \aexecrun'), \ptrans{\trans}
    \toT{\lbC{\txid}} (\thstk', \aexecrun''), \pskip
    \toT{\lbRELY} (\thstk', \aexecrun'''), \pskip  \\
    \quad \implies  \w''' \in \evalW{\gpost} 
    \land \aexecrun''' \in \clpsW{\w'''}
\end{array}
\]
For the first step, by the \rl{PRely} rule, it has \( (\eraseAEX{\aexecrun}, \eraseAEX{\aexecrun'} ) \in \clpsR{\Rely} \).
Given the definition of \( \clpsR{\Rely} \), there must exist \( \w' \) such that \( \eraseAEX{ \aexecrun' } \in \clpsW{\w'} \).
While in the \rl{PRCommit} rule, the pre-condition is stable, provided by \( \stable{ \gpre } \), so \( ( \w, \w' ) \in \Rely \), which means that the world \( \w' \) is also included in the interpretation of pre-condition, \ie,
\begin{equation}
    \label{equ:stable-pre-condition-and-the-graph}
    \w' \in \evalW{\gpre} \land \eraseAEX{ \aexecrun' } \in \clpsW{\w'}
\end{equation}
To commit a new transaction \( \txid \) that transfers machine state from \( \aexecrun' \) to \( \aexecrun'' \), by the \rl{PCommit} rule (\figref{fig:thread_semantics}), it is known that,
\sx{ Lemma saying any \( \aexecrun'' \) is inside invariant }
\begin{equation}
    \label{equ:commit-new-transaction}
    \aexecrun'' = \newaexec{\aexecrun', \thid, \evset, \txid, A, \conguar } 
\end{equation}
where \( \evset \) is a set of events corresponding to the code inside transaction, \( \txidset \) is  a set of transactions that are visible by the new transaction \( \txid \) and \( \conguar \) relates to the consistency model deciding whether the events \( \evset \) can happen and can be committed with respect to the visible transactions \( \txidset \).
Since \( \aexecrun'' \) is defined and by the \rl{PCommit} rule (\figref{fig:thread_semantics}), we know the following for some \( \h, \h', \thstk \),
\begin{equation}
    \label{equ:local-transfer}
    \h \in \obsstate{\aexecrun, \txidset, \respo}
    \land \thstk \vdash (\emptyset, \h, \emptyset) , \trans \ \toL^{*} \  (\txstk, \h', \evset) , \pskip 
\end{equation}
By the transaction soundness theorem (\thmref{thm:transaction-soundness}), there exist \( \lpre, \fp, \lpost \) such that
\[ 
\tripleL{\lpre \sep \emptyset}{\trans}{\lpost \sep \fp} \land (\h, \emptyset) \in \evalLS{\lpre \sep \emptyset} \land (\h', \evset) \in \evalLS{\lpost \sep \fp}
\]
By the interpretation of assertions, it has,
\begin{equation}
(\h', \unitE) \in \evalLS{\lpost} \land (\unitH, \evset) \in \evalLS{\fp}
\end{equation}
\end{proof}
