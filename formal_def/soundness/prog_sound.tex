\subsection{Program Soundness}
\begin{thm}[Program soundness]
The program soundness is the follows,
\[
    \for{\gpre, \prog, \gpost}
    \tripleG{\gpre}{\prog}{\gpost} 
    \implies 
    \tripleSemG{\gpre}{\prog}{\gpost} 
\]
\end{thm}
\begin{proof}
Induction on the derivations.
\caseB{\rl{PRCommit}}
We have \( \prog \equiv \ptrans{\trans} \).
Because a transaction \( \ptrans{\trans} \) is reduced by one step in the semantics, it is sufficient to prove the follows,
\[
\begin{array}{l}
    \begin{B}
        \stable{\gpre} 
        \land \gpre \snap \bar{\lpre}
        \land \tripleL{\bar{\lpre} \sep \fpEMP}{\trans}{\lpost \sep \fpF}
        \land \rpt{\gpre}{\gpost}{\fp} 
        \land \stable{\gpost}
    \end{B} \\
    \implies 
    \for{\w, \w', \w'', \w''', \hh', \hh'', \cu', \cu'', \thcu', \thcu'', \thid, \lenv, \thstk, \thstk''} \\
    \quad \begin{B}
        \w \in \evalW[\lenv, \thstk]{\gpre} 
        \land (\w, \w') \in \Rely^{*} 
        \land (\hh', \cu') \in \clpsW{\w'}
        \land \thcu'(\thid) = \cu' \\
        {} \land \thid, \func{como}{\w'} \vdash (\thstk, \hh', \cu'), \ptrans{\trans} 
        \toT{\lbC{\txid}} (\thstk'', \hh'', \cu''), \pskip  \\
        {} \land \thcu''(\thid) = \cu''
        \land (\hh'', \cu'') \in \clpsW{\w''} 
        \land (\w'', \w''') \in \Rely^{*} 
    \end{B} \\
    \quad \implies  \w''' \in \evalW[\lenv, \thstk'']{\gpost} 
\end{array}
\]
\textbf{Stable pre-condition.} 
Given that \( \stable{\gpre} \), for any world \( \w \) satisfies the pre-condition \( \gpre \) if the world can transfer to another world \( \w' \) through any steps of rely, the new world \( \w' \) also satisfies the pre-condition.
This is, 
\begin{equation}
    \label{equ:stable-pre-condition}
    \for{\w, \w',\lenv, \thstk} 
    \stable{\gpre} 
    \land \w \in \evalW[\lenv, \thstk]{\gpre} 
    \land (\w, \w') \in \Rely^{*}
    \implies \w' \in \evalW[\lenv, \thstk]{\gpre}
\end{equation}
\textbf{Commit.}
Given the \equref{equ:stable-pre-condition}, we want to prove the follows,
\begin{equation}
\label{equ:commit-new-transaction}
    \begin{array}{@{}l}
    \begin{B}
        \gpre \snap \bar{\lpre}
        \land \tripleL{\bar{\lpre} \sep \fpEMP}{\trans}{\lpost \sep \fpF}
        \land \rpt{\gpre}{\gpost}{\fp} 
    \end{B} \\
    \implies 
    \for{\w, \w', \hh, \hh', \cu, \cu', \thcu, \thcu', \thid, \lenv, \thstk, \thstk'} \\
    \quad \begin{B}
        \w \in \evalW[\lenv, \thstk]{\gpre}
        \land (\hh, \cu) \in \clpsW{\w}
        \land \thcu(\thid) = \cu \\
        {} \land \thid, \func{como}{\w} \vdash (\thstk, \hh, \cu), \ptrans{\trans} 
        \toT{\lbC{\txid}} (\thstk', \hh', \cu'), \pskip  \\
        {} \land \thcu'(\thid) = \cu'
        \land (\hh', \cu') \in \clpsW{\w'} 
    \end{B} \\
    \quad \implies  \w' \in \evalW[\lenv, \thstk']{\gpost} 
    \end{array}
\end{equation}
For any \( \w, \hh, \cu, \lenv, \thstk \) such that \( \w \in \evalW{\gpre} \) and \( (\hh, \cu) \in \clpsW{\w} \), by the predicate \( \gpre \snap \bar{\lpre} \) we know \( \clpsHH{\hh, \cu} \in \evalLS[\lenv,\thstk]{\bar{\lpre}} \), so that,
\begin{equation}
\label{equ:local-pre-condition}
(\clpsHH{\hh, \cu}, \unitO) \in \evalLS[\lenv,\thstk]{\bar{\lpre} \sep \fpEMP}
\end{equation}
Because of the soundness of transaction (\thmref{thm:transaction-soundness}), given a thread stack \( \thstk \) and logical environment \( \lenv \), if a initial configuration \( (\txstk_{0}, \h, \unitO), \trans \) satisfies the pre-condition, \ie \( (\h, \unitO) \in \evalLS[\lenv,\thstk \uplus \txstk_{0}]{\bar{\lpre} \sep \fpEMP} \), and a final configuration \( (\txstk, \h', \opset), \pskip \) is semantics reachable from the initial configuration, this final configuration will satisfy the post-condition \( \lpost \sep \fpF \).

\sx{HERE}

\begin{equation}
\label{equ:reachable}
\begin{array}{@{}l}
    \pred{reachable}{\eraseAEX{\aexecrun'}, \eraseAEX{\aexecrun''}, \txid, \evset, \como} \\
    \quad {} \land \h \in \obsstate{\aexecrun', \txidset, \respo} \land \thstk \vdash (\txstk, \h, \emptyset), \trans \toL^{*} (\txstk', \h', \evset ), \pskip
\end{array}
\end{equation}
\begin{equation}
\label{equ:local-transfer}
    (\h, \unitE) \in \evalLS{\lpre} 
    \land (\h', \unitE) \in \evalLS{\lpost} 
    \land (\unitH, \evset ) \in \evalLS{\fp}
    \land \tripleL{\lpre \sep \emptyset}{\trans}{\lpost \sep \fp}
\end{equation}
Since the new abstract execution \( \eraseAEX{\aexecrun''} \) is reachable from \( \eraseAEX{\aexecrun'} \) provided the set of events \( \evset \) (\equref{equ:reachable}) that is an interpretation of the fingerprint assertion \( \fp \) (\equref{equ:local-transfer}), it means there exists \(  \w'' \) satisfying the following because of the reapportion  \( \rpt{ \gpre }{ \gpost }{ \fp }\),
\[
    \w'' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun'' } \in \clpsW{\w''}
\]
\textbf{Stable post-condition} Similar to the stable pre-condition, we know
\[
    \w''' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun''' } \in \clpsW{\w'''}
\]
\sx{ Below is temporarily  }
\begin{equation}
    \aexecrun'' = \newaexec{\aexecrun', \thid, \evset, \txid, A, \conguar } 
\end{equation}
where \( \evset \) is a set of events corresponding to the code inside transaction, \( \txidset \) is  a set of transactions that are visible by the new transaction \( \txid \) and \( \conguar \) relates to the consistency model deciding whether the events \( \evset \) can happen and can be committed with respect to the visible transactions \( \txidset \).
Since \( \aexecrun'' \) is defined and by the \rl{PCommit} rule (\figref{fig:thread_semantics}), we know the following for some \( \h, \h', \thstk \),
\begin{equation}
    \h \in \obsstate{\aexecrun', \txidset, \respo}
    \land \thstk \vdash (\emptyset, \h, \emptyset) , \trans \ \toL^{*} \  (\txstk, \h', \evset) , \pskip 
\end{equation}
By the transaction soundness theorem (\thmref{thm:transaction-soundness}), there exist \( \lpre, \fp, \lpost \) such that
\[ 
\tripleL{\lpre \sep \emptyset}{\trans}{\lpost \sep \fp} \land (\h, \unitE) \in \evalLS{\lpre \sep \emptyset} \land (\h', \evset) \in \evalLS{\lpost \sep \fp}
\]
By the interpretation of assertions, it has,
\begin{equation}
\label{equ:interpretation-local-post}        
(\h', \unitE) \in \evalLS{\lpost} \land (\unitH, \evset) \in \evalLS{\fp}
\end{equation}
Combining \equref{equ:stable-pre-condition-and-the-graph}, \equref{equ:commit-new-transaction} and \equref{equ:interpretation-local-post}, we need to prove the follows,
\[
    \begin{array}[t]{@{}l@{}}
    \w' \in \evalW{\gpre} 
    \land \eraseAEX{ \aexecrun' } \in \clpsW{\w'}
    \land (\unitH, \evset) \in \evalLS{\fp} \\
    {} \land \aexecrun'' = \newaexec{\aexecrun', \thid, \evset, \txid, A, \conguar } 
    \land \rpt{\gpre}{\gpost}{\fp} \\
    \quad {} \implies 
    \exsts{\w''}
    \w'' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun'' } \in \clpsW{\w''}
    \end{array}
\]
\end{proof}

\begin{lem}
\label{lem:reachable}
Given a runtime abstract execution \( \aexecrun \), if it can reach anther runtime abstract execution \( \aexecrun'\) through the \rl{PCommit}, the former can reach the later statically, \ie
\[
\begin{array}{@{}l}
    \for{\aexecrun, \aexecrun', \thstk, \thstk', \como, \txid, \thid}
    \como, \thid \vdash (\thstk, \aexecrun), \ptrans{\trans}
    \toT{\lbC{\txid}} (\thstk', \aexecrun'), \pskip \\
    \quad {} \implies \pred{reachable}{\eraseAEX{\aexecrun}, \eraseAEX{\aexecrun'}, \txid, \evset, \como}
\end{array}
\]  
where \( \evset \) satisfies the conditions the of the \rl{PRCommit},
\[
    \exsts{\txidset, \h, \h', \txstk, \txstk'} \h \in \obsstate{\aexecrun, \txidset, \respo} \land \thstk \vdash (\txstk, \h, \emptyset), \trans \toL^{*} (\txstk', \h', \evset ), \pskip
\]
\end{lem}
\begin{proof}
It is implied by the soundness of the semantics (\thmref{thm:soundness-semantics}).
\end{proof}
