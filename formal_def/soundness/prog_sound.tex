\subsection{Program Soundness}
\begin{thm}[Program soundness]
The program soundness is the follows,
\[
    \for{\gpre, \prog, \gpost}
    \tripleG{\gpre}{\prog}{\gpost} 
    \implies 
    \tripleSemG{\gpre}{\prog}{\gpost} 
\]
\end{thm}
\begin{proof}
Induction on the derivations.
\caseB{\rl{PRCommit}}
We have \( \prog \equiv \ptrans{\trans} \).
Because a transaction is reduced by one step in the semantic and the rely \( \Rely \) is transitive, it is sufficient to prove for any \( \w,\w''',\thid, \thstk, \thstk', \aexecrun,\aexecrun', \aexecrun'', \aexecrun''', \txid \),
\[
\begin{array}{l}
    \w \in \evalW{\gpre} 
    \land \aexecrun \in \clpsW{\w} \\
    \quad \land \thid, \como \vdash (\thstk, \aexecrun), \ptrans{\trans} 
    \toT{\lbRELY} (\thstk, \aexecrun'), \ptrans{\trans}
    \toT{\lbC{\txid}} (\thstk', \aexecrun''), \pskip
    \toT{\lbRELY} (\thstk', \aexecrun'''), \pskip  \\
    \quad \implies  \w''' \in \evalW{\gpost} 
    \land \aexecrun''' \in \clpsW{\w'''}
\end{array}
\]
\textbf{Stable pre-condition.} For the first step, by the \rl{PRely} rule, it has \( (\eraseAEX{\aexecrun}, \eraseAEX{\aexecrun'} ) \in \clpsR{\Rely} \).
Given the definition of \( \clpsR{\Rely} \), there must exist \( \w' \) such that \( \eraseAEX{ \aexecrun' } \in \clpsW{\w'} \).
While in the \rl{PRCommit} rule, the pre-condition is stable, provided by \( \stable{ \gpre } \), so \( ( \w, \w' ) \in \Rely \), which means that the world \( \w' \) is also included in the interpretation of pre-condition, \ie,
\begin{equation}
    \label{equ:stable-pre-condition-and-the-graph}
    \w' \in \evalW{\gpre} \land \eraseAEX{ \aexecrun' } \in \clpsW{\w'}
\end{equation}
\sx{too short the prove}
\textbf{Commit.} Given the \equref{equ:stable-pre-condition-and-the-graph} and the \rl{PCommit} rule (\figref{fig:thread_semantics}), we need to prove the follows,
\[
\begin{array}{@{}l}
    (\thstk, \aexecrun'), \ptrans{\trans}
    \toT{\lbC{\txid}} (\thstk', \aexecrun''), \pskip
    \land \w' \in \evalW{\gpre} 
    \land \eraseAEX{ \aexecrun' } \in \clpsW{\w'} \\
    \quad {} \implies \exsts{\w''} 
    \w'' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun'' } \in \clpsW{\w''}
\end{array}
\]
\sx{we need to connect \( \evset \) }
By the \lemref{lem:reachable}, there exist \( \evset,\txidset, \h, \h', \txstk, \txstk' \)
\begin{equation}
\label{equ:reachable}
\begin{array}{@{}l}
    \pred{reachable}{\eraseAEX{\aexecrun'}, \eraseAEX{\aexecrun''}, \txid, \evset, \como} \\
    \quad {} \land \h \in \obsstate{\aexecrun', \txidset, \respo} \land \thstk \vdash (\txstk, \h, \emptyset), \trans \toL^{*} (\txstk', \h', \evset ), \pskip
\end{array}
\end{equation}
Because of the soundness of transaction (\thmref{thm:transaction-soundness}), it must exist \( \lpre, \lpost \) and \( \fp \) such that,
\begin{equation}
\label{equ:local-transfer}
    (\h, \unitE) \in \evalLS{\lpre} 
    \land (\h', \unitE) \in \evalLS{\lpost} 
    \land (\unitH, \evset ) \in \evalLS{\fp}
    \land \tripleL{\lpre \sep \emptyset}{\trans}{\lpost \sep \fp}
\end{equation}
Since the new abstract execution \( \eraseAEX{\aexecrun''} \) is reachable from \( \eraseAEX{\aexecrun'} \) provided the set of events \( \evset \) (\equref{equ:reachable}) that is an interpretation of the fingerprint assertion \( \fp \) (\equref{equ:local-transfer}), it means there exists \(  \w'' \) satisfying the following because of the reapportion  \( \rpt{ \gpre }{ \gpost }{ \fp }\),
\[
    \w'' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun'' } \in \clpsW{\w''}
\]
\textbf{Stable post-condition} Similar to the stable pre-condition, we know
\[
    \w''' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun''' } \in \clpsW{\w'''}
\]
\sx{ Below is temporarily  }
\begin{equation}
    \label{equ:commit-new-transaction}
    \aexecrun'' = \newaexec{\aexecrun', \thid, \evset, \txid, A, \conguar } 
\end{equation}
where \( \evset \) is a set of events corresponding to the code inside transaction, \( \txidset \) is  a set of transactions that are visible by the new transaction \( \txid \) and \( \conguar \) relates to the consistency model deciding whether the events \( \evset \) can happen and can be committed with respect to the visible transactions \( \txidset \).
Since \( \aexecrun'' \) is defined and by the \rl{PCommit} rule (\figref{fig:thread_semantics}), we know the following for some \( \h, \h', \thstk \),
\begin{equation}
    \h \in \obsstate{\aexecrun', \txidset, \respo}
    \land \thstk \vdash (\emptyset, \h, \emptyset) , \trans \ \toL^{*} \  (\txstk, \h', \evset) , \pskip 
\end{equation}
By the transaction soundness theorem (\thmref{thm:transaction-soundness}), there exist \( \lpre, \fp, \lpost \) such that
\[ 
\tripleL{\lpre \sep \emptyset}{\trans}{\lpost \sep \fp} \land (\h, \unitE) \in \evalLS{\lpre \sep \emptyset} \land (\h', \evset) \in \evalLS{\lpost \sep \fp}
\]
By the interpretation of assertions, it has,
\begin{equation}
\label{equ:interpretation-local-post}        
(\h', \unitE) \in \evalLS{\lpost} \land (\unitH, \evset) \in \evalLS{\fp}
\end{equation}
Combining \equref{equ:stable-pre-condition-and-the-graph}, \equref{equ:commit-new-transaction} and \equref{equ:interpretation-local-post}, we need to prove the follows,
\[
    \begin{array}[t]{@{}l@{}}
    \w' \in \evalW{\gpre} 
    \land \eraseAEX{ \aexecrun' } \in \clpsW{\w'}
    \land (\unitH, \evset) \in \evalLS{\fp} \\
    {} \land \aexecrun'' = \newaexec{\aexecrun', \thid, \evset, \txid, A, \conguar } 
    \land \rpt{\gpre}{\gpost}{\fp} \\
    \quad {} \implies 
    \exsts{\w''}
    \w'' \in \evalW{\gpost} 
    \land \eraseAEX{ \aexecrun'' } \in \clpsW{\w''}
    \end{array}
\]
\end{proof}

\begin{lem}
\label{lem:reachable}
Given a runtime abstract execution \( \aexecrun \), if it can reach anther runtime abstract execution \( \aexecrun'\) through the \rl{PCommit}, the former can reach the later statically, \ie
\[
\begin{array}{@{}l}
    \for{\aexecrun, \aexecrun', \thstk, \thstk', \como, \txid, \thid}
    \como, \thid \vdash (\thstk, \aexecrun), \ptrans{\trans}
    \toT{\lbC{\txid}} (\thstk', \aexecrun'), \pskip \\
    \quad {} \implies \pred{reachable}{\eraseAEX{\aexecrun}, \eraseAEX{\aexecrun'}, \txid, \evset, \como}
\end{array}
\]  
where \( \evset \) satisfies the conditions the of the \rl{PRCommit},
\[
    \exsts{\txidset, \h, \h', \txstk, \txstk'} \h \in \obsstate{\aexecrun, \txidset, \respo} \land \thstk \vdash (\txstk, \h, \emptyset), \trans \toL^{*} (\txstk', \h', \evset ), \pskip
\]
\end{lem}
\begin{proof}
It is implied by the soundness of the semantics (\thmref{thm:soundness-semantics}).
\end{proof}
