\section{Examples\label{sec:example}}

\input{./formal_def/litmus.tex}

\sx{game inventory, auction system, key-value benchmark }

\subsection{Single increment and multi-reader.}

\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub}{\V{x} \pt \stub}{\lrid}{\intass} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]

\subsubsection{SER}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n}), (\otW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
    \end{array}
\]


\[
\begin{session}
\specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 \sep \fpEMP} \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\otW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} \sep } \\
    \begin{transaction}
        \specline{ \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\otW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{\boxass{\vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} \sep } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}} \boxass{\vx \pt \V{n}}{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \begin{transaction}
        \specline{ \vx \pt \V{n} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{n} \sep \fpass{(\otR, \vx, \V{n})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}} \boxass{\vx \pt \V{n}}{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \end{session}
\end{parl} \\
\specline{\boxass{\vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]
\subsubsection{SI/PSI}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n}), (\otW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n, k}} \V{x} \pt \V{k} \land \V{k} \geq \V{n} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]

The { \color{purple}purple } indicates no strong session constraint.

\[
\begin{session}
\specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\otW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1}{ \vx \pt \Set{0,1}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0} \lor \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ { \color{purple} \vx \pt 0 \sep \fpass{(\otR, \vx, 0)} }  \\
                    {} \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1}{\vx \pt \Set{0,1}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0 } \lor \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ 
            { \color{purple} \vx \pt 1 \sep \fpass{(\otR, \vx, 0), (\otW, \vx, 1)} } \\
            {} \lor \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\otW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 2 }{\vx \pt \Set{0,1,2}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\boxass{\vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{n} \geq \V{v} \geq 0 }{\lrid}{\intass} } \\
    \begin{transaction}
        \specline{ \vx \pt \V{v} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{v} \sep \fpass{(\otR, \vx, \V{v})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{n} \geq \V{v} \geq 0 }{\lrid}{\intass} } \\
    \end{session}
\end{parl} \\
\specline{ \color{purple} \sptboxass{\vx \pt 2 }{\vx \pt \Set{0,1,2}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\specline{\boxass{\vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]

\subsubsection{Causal}

\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}, \V{k}} \V{x} \pt \V{k} \mat \Set{(\otR, \V{x}, \V{n}), (\otW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n}, \V{k}} \V{x} \pt \V{k} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]

\[
\begin{session}
\specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\boxass{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\otW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1}{\vx \pt \Set{0,1}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0} \lor \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ { \color{purple} \vx \pt 0 \sep \fpass{(\otR, \vx, 0)} }  \\
                    {} \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1}{\vx \pt \Set{0,1}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\boxass{\vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0 } \lor \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ 
            { \color{purple} \vx \pt 1 \sep \fpass{(\otR, \vx, 0), (\otW, \vx, 1)} } \\
            {} \lor \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\otW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{ {\color{purple} \sptboxass{\vx \pt 2}{\vx \pt \Set{0,1,2}}{\lrid}{\intass} \lor {} } \\
            {\color{purple} \sptboxass{\vx \pt 1}{\vx \pt \Set{0,1}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } } \\
    \specline{\boxass{\vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{n} \geq \V{v} \geq 0 }{\lrid}{\intass} } \\
    \specline{ \color{purple} \exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{v} \geq 0 }{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \begin{transaction}
        \specline{ \vx \pt \V{v} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{v} \sep \fpass{(\otR, \vx, \V{v})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{n} \geq \V{v} \geq 0 }{\lrid}{\intass} } \\
    \specline{ \color{purple} \exsts{\V{n}} \sptboxass{\vx \pt \V{n} }{ \exsts{\V{v}} \vx \pt \V{v} \land \V{v} \geq 0 }{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \end{session}
\end{parl} \\
\specline{ \color{purple} \sptboxass{\vx \pt 1}{\vx \pt \Set{0,1}}{\lrid}{\intass} \lor \sptboxass{\vx \pt 2}{\vx \pt \Set{0,1,2}}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]

\subsection{Multiple increments}

\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub }{ \V{x} \pt \stub}{\lrid}{\intass} \\
        \C{Inc} \text{ is the unit element} \\
    \end{array}
\]

\subsubsection{SER}
\subsubsection{Causal}

\subsection{Two associated bank accounts}
\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub \sep \V{y} \pt \stub }{ \V{x} \pt \stub \sep \V{y} \pt \stub }{\lrid}{\intass} \\
        \C{L} \composeK \C{L} \text{ is undefined} \\
        \C{R} \composeK \C{R} \text{ is undefined} \\
        \C{Rd} \text{ is the unit} \\
    \end{array}          
\]

\subsubsection{SER}
\sx{Need to support using a capability multiple times}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{L} & : & \exsts{\V{v}, \V{k}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{k}), (\otW, \V{x}, \V{v} - \V{u})}{\V{v} + \V{k} \geq \V{u} \geq 0} \\
        \C{R} & : & \exsts{\V{v}, \V{k}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{k}), (\otW, \V{y}, \V{k} - \V{u})}{\V{v} + \V{k} \geq \V{u} \geq 0} \\
        \C{Rd} & : & \exsts{\V{v}, \V{a}} \V{a} \in \Set{\V{x}, \V{y}} \land \V{a} \pt \V{v} \mat \Set{(\otR, \V{a}, \V{v})} \\
        \end{rclarray} \\
    \end{array}
\]

\[
\begin{session}
\specline{ \boxass{\vx \pt 60 \sep \vy \pt 60 }{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \boxass{\vx \pt 60 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \specline{\vx \pt 60 \sep \vy \pt 60 \lor \vx \pt 60 \sep \vy \pt -40} \\
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vx}{\pvar{a} - 100} ; \\
            \pife \\
            \specline{ \asstrue \sep \fpass{(\otR, \vx, 60), (\otR, \vy, -40)} \lor {} \\
            \fpass{(\otR, \vx, 60), (\otR, \vy, 60), (\otW, \vx, -40)} } \\ 
        \end{transaction} \\
        \specline{ \boxass{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
        \specline{ \boxass{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt 60 \sep \vy \pt 60}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vy}{\pvar{b} - 100} ; \\
            \pife 
        \end{transaction} \\
        \specline{ \boxass{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
    \end{session}
\end{parl} \\
\specline{ \boxass{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]

\subsubsection{SI/PSI}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{L} & : & \exsts{\V{v}, \V{k}, \V{m}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} 
        \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{m}), (\otW, \V{x}, \V{v} - \V{u})}{\V{v} + \V{m} \geq \V{u} \geq 0 \land \V{m} \geq \V{k}  } \\
        \C{R} & : & \exsts{\V{v}, \V{k}, \V{m}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} 
       \mat \Setcon{(\otR, \V{x}, \V{m}), (\otR, \V{y}, \V{k}), (\otW, \V{y}, \V{k} - \V{u})}{\V{v} + \V{m} \geq \V{u} \geq 0 \land \V{m} \geq \V{v}} \\
        \C{Rd} & : & \exsts{\V{v}, \V{m}, \V{a}} \V{a} \in \Set{\V{x}, \V{y}} \land \V{a} \pt \V{v} \mat \Setcon{(\otR, \V{a}, \V{m})}{\V{m} \geq \V{v}} \\
        \end{rclarray} \\
    \end{array}
\]

\[
\begin{session}
\specline{ \boxass{\vx \pt 60 \sep \vy \pt 60}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \exsts{ \V{k} } \sptboxass{\vx \pt 60 \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt 60 \sep \vy \pt \V{m} \land \V{k} \leq \V{m} \leq 60}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \specline{ \vx \pt 60 \sep \vy \pt \V{m} } \\
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } \\
                        {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} } \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } \\
                            {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} \land \pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vx}{\pvar{a} - 100} ; \\
            \quad \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep {} \\
                            \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}), (\otW, \vx, -40) } \\
                            {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} \land \pvar{a} + \pvar{b} \geq 100} \\
            \pife \\
            \comment{Weaken the assertion by } \\
            \comment{throwing away program variables.} \\
            \comment{use \( \asstrue \) for heap.} \\
            \specline{ \asstrue \sep 
                        \begin{B}
                        \V{m} < 40 \land 
                        \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } 
                        \end{B} \lor {} \\
                        \begin{B}
                        \V{m} \geq 40 \land 
                        \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}), (\otW, \vx, -40) } \\
                        \end{B} \\
                    } \\
        \end{transaction} \\
        \specline{ \exsts{ \V{v}, \V{k} } \sptboxass{\vx \pt \V{v} \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt \V{v} \sep \vy \pt \V{m} \land \V{k} \leq \V{m} \leq 60}{\lrid}{\intass} \\ {} \sep \cass{\C{L}}{\lrid} \land 
        \begin{B}
            ( 40 \leq \V{k} \leq 60 \land \V{v} = -40 ) \lor {} \\ ( \V{k} \leq 40 \land ( \V{v} = 60  \lor \V{v} = -40 ) ) 
        \end{B}
        } \\
    \end{session}
    &
    \begin{session}
        \specline{ \exsts{ \V{v} } \sptboxass{\vx \pt \V{v} \sep \vy \pt 60 }{ \exsts{\V{m}} \vx \pt \V{m} \sep \vy \pt 60 \land \V{v} \leq \V{m} \leq 60}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vy}{\pvar{b} - 100} ; \\
            \pife 
        \end{transaction} \\
        \specline{ \exsts{ \V{v}, \V{k} } \sptboxass{\vx \pt \V{v} \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt \V{m} \sep \vy \pt \V{k} \land \V{v} \leq \V{m} \leq 60}{\lrid}{\intass} \\ {} \sep \cass{\C{R}}{\lrid} \land 
        \begin{B}
            ( 40 \leq \V{v} \leq 60 \land \V{k} = -40 ) \lor {} \\ ( \V{v} \leq 40 \land ( \V{k} = 60  \lor \V{k} = -40 ) ) 
        \end{B}
        } \\
    \end{session}
\end{parl} \\
\specline{ \boxass{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \lor \boxass{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor \boxass{\vx \pt -40 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]


\subsection{Litmus Test For SI}
\[
    \boxass{ \V{x} \pt \V{n} \sep \V{y} \pt \V{m} }{\lrid}{\intass} 
\]

\[
\intass :
\begin{rclarray}[t]
    \C{R} & : & \V{x} \pt \Set{0,1} \sep \V{y} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\otW, \V{y}, 1)} \\
    \C{L} & : & \V{x} \pt \stub \sep \V{y} \pt \Set{0,1} \mat \Set{(\otR, \V{y}, 0), (\otW, \V{x}, 1)} \\
    \C{Rd} & : & \exsts{ \V{a} \in \Set{\V{x}, \V{y}}, \V{v}, \V{k}} \V{a} \pt \V{k} \land \V{k} = \V{v} = 0 \lor \V{k} = 1 \land \V{v} \in \Set{0,1} \mat \Set{(\otR, \V{a}, \V{v})} \\
\end{rclarray}
\]

\[
\begin{session}
\specline{\boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
\begin{session}
    \specline{\cass{\C{L}}{\lrid} \sep 
            \boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \lor
            \sptboxass{\vx \pt 0 \sep \vy \pt 1}{\vx \pt 0 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} 
    } \\
    \begin{transaction}
        \specline{\vx \pt 0 \sep ( \vy \pt 0 \lor \vy \pt 1 )} \\
        \pderef{\pvar{b}}{\vy} ; \\
        \specline{\vx \pt 0 \sep {} \\
                    \begin{B}
                        \vy \pt 0 \sep \fpass{(\otR, \vy, 0)} \land \pvar{b} = 0 \\ 
                        {} \lor \vy \pt 1 \sep \fpass{(\otR, \vy, 1)} \land \pvar{b} = 1 \\
                    \end{B} } \\
        \pifs{\pvar{b} = 0} 
        \pmutate{\vx}{1} ;
        \pife \\
        \comment{ weaken the assertion } \\
        \specline{\asstrue \sep \fpass{(\otR, \vy, 0), (\otW, \vx, 1)} \lor \fpass{(\otR, \vy, 1)} } \\

    \end{transaction} \\
    \specline{\cass{\C{L}}{\lrid} \sep 
            \boxass{\vx \pt 1 \sep \vy \pt 0}{\lrid}{\intass} \lor 
            \sptboxass{\vx \pt 0 \sep \vy \pt 1}{\vx \pt 0 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} \lor \\
            \sptboxass{\vx \pt 1 \sep \vy \pt 1}{\vx \pt 1 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} } \\
\end{session}
&
\begin{session}
    \specline{\cass{\C{R}}{\lrid} \sep 
            \boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
            \sptboxass{\vx \pt 1 \sep \vy \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 0}{\lrid}{\intass} } \\
    \begin{transaction}
        \pderef{\pvar{a}}{\vx} ; 
        \quad \pifs{\pvar{a} = 0} 
        \pmutate{\vy}{1} ; 
        \pife 
    \end{transaction} \\
    \specline{\cass{\C{R}}{\lrid} \sep 
            \boxass{\vx \pt 0 \sep \vy \pt 1}{\lrid}{\intass} \lor {} \\
            \sptboxass{\vx \pt 1 \sep \vy \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
            \sptboxass{\vx \pt 1 \sep \vy \pt 1}{\vx \pt \Set{0,1} \sep \vy \pt 1}{\lrid}{\intass}  } \\
\end{session}
\end{parl} \\
\specline{ \boxass{\vx \pt 0 \sep \vy \pt 1}{\lrid}{\intass} \sep
           \boxass{\vx \pt 1 \sep \vy \pt 0}{\lrid}{\intass} \sep
           \boxass{\vx \pt 1 \sep \vy \pt 1}{\lrid}{\intass} 
           \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]


\subsection{Litmus Test For SI, Long fork}

\[
    \boxass{ \V{x} \pt \stub \sep \V{y} \pt \stub \sep \V{w} \pt \stub \sep \V{z} \pt \stub }{\lrid}{\intass} 
\]

\[
\intass :
\begin{rclarray}[t]
    \C{L} & : & \V{x} \pt \stub \mat \Set{(\otW, \V{x}, 1)} \\
    \C{L} & : & \V{x} \pt 1 \sep \V{y} \pt \Set{0,1} \sep \V{w} \pt \stub \mat \Set{(\otR, \V{x}, 1), (\otR, \V{y}, 0), (\otW, \V{w}, 1) } \\
    { \color{purple} \C{L} } & : & { \color{purple} \V{x} \pt 1 \sep \V{y} \pt \Set{0,1} \sep \V{w} \pt \stub \sep \V{z} \pt 0 \mat \Set{(\otR, \V{x}, 1), (\otR, \V{y}, 0), (\otW, \V{w}, 1) } } \\
    \C{R} & : & \V{y} \pt \stub \mat \Set{(\otW, \V{y}, 1)} \\
    \C{R} & : & \V{x} \pt \Set{0,1} \sep \V{y} \pt 1 \sep \V{z} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\otR, \V{y}, 1), (\otW, \V{z}, 1) } \\
    { \color{purple} \C{R} } & : & { \color{purple} \V{x} \pt \Set{0,1} \sep \V{y} \pt 1 \sep \V{w} \pt 0 \sep \V{z} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\otR, \V{y}, 1), (\otW, \V{z}, 1) } } \\
    \C{Rd} & : & \exsts{ \V{a} \in \Set{ \V{x}, \V{y} }, \V{v}, \V{k} } \V{a} \pt \V{k} \land (\V{k} = 1 \land \V{v} \in \Set{0,1}) \lor \V{k} = \V{v} = 0 \mat \Set{(\otR, \V{a}, \V{v})} \\
\end{rclarray}
\]

\[
\begin{session}
\specline{ \boxass{\vx \pt 0 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 0 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 0 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 0 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt 0 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt \Set{0,1}}{\lrid}{\intass} } \\
        \begin{transaction}
            \pmutate{\vx}{1};
        \end{transaction} \\
        \specline{ \cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 1 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt \Set{0,1}}{\lrid}{\intass} } \\
        \begin{transaction}
            \specline{\exsts{\V{m}} \V{m} \in \Set{0,1} \land \vx \pt 1 \\ {} \sep \vy \pt \V{m} \sep \vw \pt 0} \\
            \pderef{\pvar{a}}{\vx}; 
            \quad \pderef{\pvar{b}}{\vy}; \\
            \specline{\exsts{\V{m}} \V{m} \in \Set{0,1} \land \vx \pt 1 \sep \vy \pt \V{m} \sep {} \\
                        \vw \pt 0 \sep \fpass{(\otR, \vx, 1),(\otR, \vy, \V{m})} \\
                        {} \land \pvar{a} = 1 \land \pvar{b} = \V{m} 
                        } \\
            \pifs{\pvar{a} = 1 \ \&\& \ \pvar{b} = 0} 
            \pmutate{\pvar{w}}{1} 
            \pife \\
            \specline{ \asstrue \sep \fpass{(\otR, \vx, 1),(\otR, \vy, 1)} \lor {} \\
                        \fpass{(\otR, \vx, 1),(\otR, \vy, 0), (\otW, \vw, 1) } } \\
        \end{transaction}  \\
        \specline{ \cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 1 \sep \vy \pt 0 \sep \vw \pt 1 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 1 \sep \vz \pt 0}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 1 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 0 \sep \vz \pt \Set{0,1}}{\lrid}{\intass} \lor {}\\
                { \color{purple} \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 1 \sep \vz \pt 1}{\vx \pt 1 \sep \vy \pt \Set{0,1} \\ {} \sep \vw \pt 1 \sep \vz \pt \Set{0,1}}{\lrid}{\intass} } } \\
    \end{session} 
    &
    \begin{session}
        \specline{ \cass{\C{R}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 1 \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 0 \\ {} \sep \vw \pt 1 \sep \vz \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 0 \\ {} \sep \vw \pt \Set{0,1} \sep \vz \pt 0 }{\lrid}{\intass} } \\
        \begin{transaction}
            \pmutate{\vy}{1};
        \end{transaction} \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; 
            \quad \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} = 0 \ \&\& \ \pvar{b} = 1} 
            \pmutate{\pvar{z}}{1} 
            \pife \\
        \end{transaction}  \\
        \specline{ \cass{\C{R}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 1 \sep \vw \pt 0 \sep \vz \pt 1}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt \Set{0,1} \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 1 \sep \vz \pt 0}{\vx \pt \Set{0,1} \sep \vy \pt 1 \\ {} \sep \vw \pt \Set{0,1} \sep \vz \pt 0 }{\lrid}{\intass} \lor {} \\
                { \color{purple} \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 1 \sep \vz \pt 1}{\vx \pt \Set{0,1} \sep \vy \pt 1 \\ {} \sep \vw \pt \Set{0,1} \sep \vz \pt 1 }{\lrid}{\intass} } } \\
    \end{session}
\end{parl} \\
\specline{ \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} \sep \boxass{\vx \pt 1 \sep \vy \pt 1 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor
        \boxass{\vx \pt 1 \sep \vy \pt 1 \sep \vw \pt 0 \sep \vz \pt 1}{\lrid}{\intass} \lor {} \\  
        \boxass{\vx \pt 1 \sep \vy \pt 1 \sep \vw \pt 1 \sep \vz \pt 0}{\lrid}{\intass} \lor 
        { \color{purple} \boxass{\vx \pt 1 \sep \vy \pt 1 \sep \vw \pt 1 \sep \vz \pt 1}{\lrid}{\intass} } } \\
\end{session}
\]
Here the interference is also valid under parallel snapshot isolation.
But if we use the {\color{purple} purple interference} that strictly satisfies snapshot isolation, the post-condition in {\color{purple} purple} will be eliminated.

\subsection{An example for SI}

\[
    \sptboxass{\V{x} \pt \stub \sep \V{y} \pt \stub}{\V{x} \pt \stub \sep \V{y} \pt \stub}{\lrid}{\intass} 
\]

\[
\intass :
\begin{rclarray}[t]
    \C{L} & : & \V{x} \pt \Set{0,3} \sep \V{y} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\otW, \V{y},1)} \\
    \C{L} & : & \V{x} \pt \Set{0,3} \sep \V{y} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\otW, \V{y},2)} \\
    \C{R} & : & \V{x} \pt \stub \sep \V{y} \pt \Set{0,1,2} \mat \Set{(\otR, \V{y}, 0), (\otW, \V{x},3)} \\
    \C{Rd} & : & ... \\
\end{rclarray}
\]

\[
\begin{session}
    \specline{\boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid}} \\
    \begin{parl}
        \begin{session}
            \specline{\cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 0}{\vx \pt \Set{0,3} \sep \vy \pt 0}{\lrid}{\intass}
            } \\
            \begin{transaction}
                \pifs{\vx = 0} 
                \pmutate{\vy}{1};
                \pife
            \end{transaction} \\
            \specline{\cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 1}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 0}{\vx \pt \Set{0,3} \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 1}{\vx \pt \Set{0,3} \sep \vy \pt 1}{\lrid}{\intass}
            } \\
            \begin{transaction}
                \pifs{\vx = 0} 
                \pmutate{\vy}{2};
                \pife
            \end{transaction}  \\
            \specline{\cass{\C{L}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 2}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 0}{\vx \pt \Set{0,3} \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 1}{\vx \pt \Set{0,3} \sep \vy \pt 1}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 2}{\vx \pt \Set{0,3} \sep \vy \pt 2}{\lrid}{\intass} 
            } \\
        \end{session} &
        \begin{session}
            \specline{\cass{\C{R}}{\lrid} \sep \boxass{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 0 \sep \vy \pt 1}{ \vx \pt 0 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 0 \sep \vy \pt 2}{ \vx \pt 0 \sep \vy \pt \Set{0,1,2}}{\lrid}{\intass} 
            } \\
            \begin{transaction}
                \pifs{\vy = 0} 
                \pmutate{\vx}{3};
                \pife
            \end{transaction} \\
            \specline{\cass{\C{R}}{\lrid} \sep \boxass{\vx \pt 3 \sep \vy \pt 0}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 0 \sep \vy \pt 1}{ \vx \pt 0 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 1}{ \vx \pt 3 \sep \vy \pt \Set{0,1}}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 0 \sep \vy \pt 2}{ \vx \pt 0 \sep \vy \pt \Set{0,1,2}}{\lrid}{\intass} \lor {} \\
                    \sptboxass{\vx \pt 3 \sep \vy \pt 2}{ \vx \pt 3 \sep \vy \pt \Set{0,1,2}}{\lrid}{\intass} 
            } \\
        \end{session} 
    \end{parl} \\
    \specline{\boxass{\vx \pt 0 \sep \vy \pt 2}{\lrid}{\intass} \lor \boxass{\vx \pt 3 \sep \vy \pt 0}{\lrid}{\intass} \lor \boxass{\vx \pt 3 \sep \vy \pt 1}{\lrid}{\intass} \lor \boxass{\vx \pt 3 \sep \vy \pt 2}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid}} \\
\end{session}
\]
