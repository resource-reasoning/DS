\section{Examples\label{sec:example}}

\input{./formal_def/litmus.tex}

\sx{game inventory, auction system, key-value benchmark }

\subsection{Single increment and multi-reader.}
\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub}{\V{x} \pt \stub}{\lrid}{\intass} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]
\subsubsection{SER}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n}), (\etW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
    \end{array}
\]


\[
\begin{session}
\specline{\sptboxass{\vx \pt 0}{\vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\sptboxass{\vx \pt 0 }{ \vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 \sep \fpEMP} \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\etW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} \sep } \\
    \begin{transaction}
        \specline{ \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\etW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} \sep } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}}\sptboxass{\vx \pt \V{n} }{ \vx \pt \V{n}}{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \begin{transaction}
        \specline{ \vx \pt \V{n} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{n} \sep \fpass{(\otR, \vx, \V{n})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}}\sptboxass{\vx \pt \V{n} }{ \vx \pt \V{n}}{\lrid}{\intass} \land \V{n} \geq 0 } \\
    \end{session}
\end{parl} \\
\specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]
\subsubsection{SI/PSI}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}} \V{x} \pt \V{n} \mat \Set{(\otR, \V{x}, \V{n}), (\etW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n, k}} \V{x} \pt \V{k} \land \V{k} \geq \V{n} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]

The { \color{purple}purple } indicates no strong session constraint.

\[
\begin{session}
\specline{\sptboxass{\vx \pt 0 }{ \vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\sptboxass{\vx \pt 0 }{ \vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\etW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1 }{ \vx \pt 0 \lor \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0} \lor \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ { \color{purple} \vx \pt 0 \sep \fpass{(\otR, \vx, 0)} }  \\
                    {} \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1 }{ \vx \pt 0 \lor \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0 } \lor \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ 
            { \color{purple} \vx \pt 1 \sep \fpass{(\otR, \vx, 0), (\etW, \vx, 1)} } \\
            {} \lor \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\etW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 2 }{ \vx \pt 0 \lor \vx \pt 1 \lor \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}, \V{v}} \sptboxass{\vx \pt \V{n} }{ \vx \pt \V{v}}{\lrid}{\intass} \land \V{n} \geq \V{v} \geq 0 } \\
    \begin{transaction}
        \specline{ \vx \pt \V{v} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{v} \sep \fpass{(\otR, \vx, \V{v})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}, \V{v}} \sptboxass{\vx \pt \V{n} }{ \vx \pt \V{v}}{\lrid}{\intass} \land \V{n} \geq \V{v} \geq 0 } \\
    \end{session}
\end{parl} \\
\specline{ \color{purple} \sptboxass{\vx \pt 2 }{ \vx \pt 0 \lor \vx \pt 1 \lor \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]

\subsubsection{Causal}

\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{Inc} & : & \exsts{\V{n}, \V{k}} \V{x} \pt \V{k} \mat \Set{(\otR, \V{x}, \V{n}), (\etW, \V{x}, \V{n} + 1)} \\
        \C{Rd}  & : & \exsts{\V{n}, \V{k}} \V{x} \pt \V{k} \mat \Set{(\otR, \V{x}, \V{n})} \\ 
        \end{rclarray} \\
        \C{Inc} \composeK \C{Inc} \text{ is undefined} \\
        \C{Rd} \text{ is the unit element} \\
    \end{array}
\]

\[
\begin{session}
\specline{\sptboxass{\vx \pt 0 }{ \vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\begin{parl}
    \begin{session}
    \specline{\sptboxass{\vx \pt 0 }{ \vx \pt 0}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ \vx \pt 0 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \specline{ \vx \pt 0 \land \pvar{a} = 0 \sep \fpass{(\otR, \vx, 0)} } \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ \vx \pt 1 \land \pvar{a} = 0 \\
                {} \sep \fpass{(\otR, \vx, 0), (\etW, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1 }{ \vx \pt 0 \lor \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0} \lor \vx \pt 1 } \\
        \pderef{\pvar{b}}{\vx} ; \\
        \specline{ { \color{purple} \vx \pt 0 \sep \fpass{(\otR, \vx, 0)} }  \\
                    {} \lor \vx \pt 1 \sep \fpass{(\otR, \vx, 1)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1 }{ \vx \pt 0 \lor \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 1 }{ \vx \pt 1}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \begin{transaction}
        \specline{ {\color{purple} \vx \pt 0 } \lor \vx \pt 1 } \\
        \pderef{\pvar{a}}{\vx} ; \\
        \pmutate{\vx}{\pvar{a} + 1} ; \\
        \specline{ 
            { \color{purple} \vx \pt 1 \sep \fpass{(\otR, \vx, 0), (\etW, \vx, 1)} } \\
            {} \lor \vx \pt 2 \sep \fpass{(\otR, \vx, 1), (\etW, \vx, 2)} } \\
    \end{transaction} \\
    \specline{ \color{purple} \sptboxass{\vx \pt 1 \lor \vx \pt 2 }{ \vx \pt 0 \lor \vx \pt 1 \lor \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
    \specline{\exsts{\V{n}, \V{v}} \sptboxass{\vx \pt \V{n} }{ \vx \pt \V{v}}{\lrid}{\intass} \land \V{n} \geq \V{v} \geq 0 } \\
    \begin{transaction}
        \specline{ \vx \pt \V{v} } \\
        \pderef{\pvar{c}}{\vx} ; \\
        \specline{ \vx \pt \V{v} \sep \fpass{(\otR, \vx, \V{v})} } \\
    \end{transaction} \\
    \specline{\exsts{\V{n}, \V{v}} \sptboxass{\vx \pt \V{n} }{ \vx \pt \V{v}}{\lrid}{\intass} \land \V{n} \geq \V{v} \geq 0 } \\
    \end{session}
\end{parl} \\
\specline{ \color{purple} \sptboxass{\vx \pt 1 \lor \vx \pt 2 }{ \vx \pt 0 \lor \vx \pt 1 \lor \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\specline{\sptboxass{\vx \pt 2 }{ \vx \pt 2}{\lrid}{\intass} \sep \cass{\C{Inc}}{\lrid} } \\
\end{session}
\]

\subsection{Multiple increments}

\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub }{ \V{x} \pt \stub}{\lrid}{\intass} \\
        \C{Inc} \text{ is the unit element} \\
    \end{array}
\]

\subsubsection{SER}
\subsubsection{Causal}

\subsection{Two associated bank accounts}
\[
    \begin{array}{@{}l@{}}
        \sptboxass{\V{x} \pt \stub \sep \V{y} \pt \stub }{ \V{x} \pt \stub \sep \V{y} \pt \stub }{\lrid}{\intass} \\
        \C{L} \composeK \C{L} \text{ is undefined} \\
        \C{R} \composeK \C{R} \text{ is undefined} \\
        \C{Rd} \text{ is the unit} \\
    \end{array}          
\]

\subsubsection{SER}
\sx{Need to support using a capability multiple times}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{L} & : & \exsts{\V{v}, \V{k}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{k}), (\etW, \V{x}, \V{v} - \V{u})}{\V{v} + \V{k} \geq \V{u} \geq 0} \\
        \C{R} & : & \exsts{\V{v}, \V{k}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{k}), (\etW, \V{y}, \V{k} - \V{u})}{\V{v} + \V{k} \geq \V{u} \geq 0} \\
        \C{Rd} & : & \exsts{\V{v}, \V{a}} \V{a} \in \Set{\V{x}, \V{y}} \land \V{a} \pt \V{v} \mat \Set{(\otR, \V{a}, \V{v})} \\
        \end{rclarray} \\
    \end{array}
\]

\[
\begin{session}
\specline{ \sptboxass{ \vx \pt 60 \sep \vy \pt 60 }{ \vx \pt 60 \sep \vy \pt 60 }{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \sptboxass{ \vx \pt 60 \sep \vy \pt 60}{\vx \pt 60 \sep \vy \pt 60}{\lrid}{\intass} \lor {} \\ \sptboxass{\vx \pt 60 \sep \vy \pt -40}{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \specline{\vx \pt 60 \sep \vy \pt 60 \\ {} \lor \vx \pt 60 \sep \vy \pt -40} \\
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vx}{\pvar{a} - 100} ; \\
            \pife \\
            \specline{\vx \pt-40 \sep \vy \pt 60 \sep {} \\
            \fpass{(\otR, \vx, 60), (\otR, \vy, 60), (\etW, \vx, -40)} \\ 
            {} \lor \vx \pt 60 \sep \vy \pt -40 \sep {} \\
            \fpass{(\otR, \vx, 60), (\otR, \vy, -40)} }
        \end{transaction} \\
        \specline{ \sptboxass{ \vx \pt -40 \sep \vy \pt 60}{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor {} \\ \sptboxass{\vx \pt 60 \sep \vy \pt -40}{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
    \end{session}
    &
    \begin{session}
        \specline{ \sptboxass{ \vx \pt -40 \sep \vy \pt 60}{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor {} \\ \sptboxass{\vx \pt 60 \sep \vy \pt 60}{\vx \pt 60 \sep \vy \pt 60}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vy}{\pvar{b} - 100} ; \\
            \pife 
        \end{transaction} \\
        \specline{ \sptboxass{ \vx \pt -40 \sep \vy \pt 60}{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor {} \\ \sptboxass{\vx \pt 60 \sep \vy \pt -40}{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
    \end{session}
\end{parl} \\
\specline{ \sptboxass{ \vx \pt -40 \sep \vy \pt 60}{\vx \pt -40 \sep \vy \pt 60}{\lrid}{\intass} \lor {} \\ \sptboxass{\vx \pt 60 \sep \vy \pt -40}{\vx \pt 60 \sep \vy \pt -40}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]

\subsubsection{SI/PSI}
\[
    \begin{array}{@{}l@{}}
        \intass : 
        \begin{rclarray}[t]
        \C{L} & : & \exsts{\V{v}, \V{k}, \V{m}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} 
        \mat \Setcon{(\otR, \V{x}, \V{v}), (\otR, \V{y}, \V{m}), (\etW, \V{x}, \V{v} - \V{u})}{\V{v} + \V{m} \geq \V{u} \geq 0 \land \V{m} \geq \V{k}  } \\
        \C{R} & : & \exsts{\V{v}, \V{k}, \V{m}, \V{u}} \V{x} \pt \V{v} \sep \V{y} \pt \V{k} 
       \mat \Setcon{(\otR, \V{x}, \V{m}), (\otR, \V{y}, \V{k}), (\etW, \V{y}, \V{k} - \V{u})}{\V{v} + \V{m} \geq \V{u} \geq 0 \land \V{m} \geq \V{v}} \\
        \C{Rd} & : & \exsts{\V{v}, \V{m}, \V{a}} \V{a} \in \Set{\V{x}, \V{y}} \land \V{a} \pt \V{v} \mat \Setcon{(\otR, \V{a}, \V{m})}{\V{m} \geq \V{v}} \\
        \end{rclarray} \\
    \end{array}
\]

\[
\begin{session}
\specline{ \sptboxass{\vx \pt 60 \sep \vy \pt 60 }{\vx \pt 60 \sep \vy \pt 60 }{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \exsts{ \V{k} } \sptboxass{\vx \pt 60 \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt 60 \sep \vy \pt \V{m} \land \V{k} \leq \V{m} \leq 60}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \specline{ \vx \pt 60 \sep \vy \pt \V{m} } \\
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } \\
                        {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} } \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } \\
                            {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} \land \pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vx}{\pvar{a} - 100} ; \\
            \quad \specline{ \vx \pt 60 \sep \vy \pt \V{m} \sep {} \\
                            \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}), (\otW, \vx, -40) } \\
                            {} \land \pvar{a} = 60 \land \pvar{b} = \V{m} \land \pvar{a} + \pvar{b} \geq 100} \\
            \pife \\
            \comment{Weaken the assertion by } \\
            \comment{throwing away program variables.} \\
            \comment{use \( \asstrue \) for heap.} \\
            \specline{ \asstrue \sep \\
                        \begin{formulea}
                        \V{m} \geq 40 \land 
                        \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}), (\etW, \vx, -40) } \\
                        \end{formulea} \\
                        {} \lor 
                        \begin{formulea}
                        \V{m} < 40 \land 
                        \fpass{ (\otR, \vx, 60), (\otR, \vx, \V{m}) } 
                        \end{formulea}
                    } \\
        \end{transaction} \\
        \specline{ \exsts{ \V{v}, \V{k} } \sptboxass{\vx \pt \V{v} \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt \V{v} \sep \vy \pt \V{m} \land \V{k} \leq \V{m} \leq 60}{\lrid}{\intass} \\ {} \sep \cass{\C{L}}{\lrid} \land 
        \begin{formulea}
            ( 40 \leq \V{k} \leq 60 \land \V{v} = -40 ) \lor {} \\ ( \V{k} \leq 40 \land ( \V{v} = 60  \lor \V{v} = -40 ) ) 
        \end{formulea}
        } \\
    \end{session}
    &
    \begin{session}
        \specline{ \exsts{ \V{v} } \sptboxass{\vx \pt \V{v} \sep \vy \pt 60 }{ \exsts{\V{m}} \vx \pt \V{m} \sep \vy \pt 60 \land \V{v} \leq \V{m} \leq 60}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} + \pvar{b} \geq 100} \\
            \quad \pmutate{\vy}{\pvar{b} - 100} ; \\
            \pife 
        \end{transaction} \\
        \specline{ \exsts{ \V{v}, \V{k} } \sptboxass{\vx \pt \V{v} \sep \vy \pt \V{k} }{ \exsts{\V{m}} \vx \pt \V{m} \sep \vy \pt \V{k} \land \V{v} \leq \V{m} \leq 60}{\lrid}{\intass} \\ {} \sep \cass{\C{R}}{\lrid} \land 
        \begin{formulea}
            ( 40 \leq \V{v} \leq 60 \land \V{k} = -40 ) \lor {} \\ ( \V{v} \leq 40 \land ( \V{k} = 60  \lor \V{k} = -40 ) ) 
        \end{formulea}
        } \\
    \end{session}
\end{parl} \\
\specline{ \exsts{ \V{v}, \V{k} } \sptboxass{\vx \pt \V{v} \sep \vy \pt \V{k}}{\vx \pt \V{v} \sep \vy \pt \V{k}}{\lrid}{\intass} \land (\V{v}, \V{k}) \in \Set{(60,-40),(-40,60),(-40,-40)} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]


\subsection{Litmus Test For SI}
\[
    \boxass{ \V{x} \pt \V{n} \sep \V{y} \pt \V{m} }{\lrid}{\intass} 
\]

\[
\intass :
\begin{rclarray}[t]
    \C{R} & : & \exsts{ \V{k} \in \Set{0,1} } \V{x} \pt \V{k} \sep \V{y} \pt \stub \mat \Set{(\otR, \V{x}, 0), (\etW, \V{y}, 1)} \\
    \C{L} & : & \exsts{ \V{v} \in \Set{0,1} } \V{x} \pt \stub \sep \V{y} \pt \V{v} \mat \Set{(\otR, \V{y}, 0), (\etW, \V{x}, 1)} \\
    \C{Rd} & : & \exsts{ \V{a} \in \Set{\V{x}, \V{y}}, \V{v}, \V{k}} \V{a} \pt \V{k} \land \V{k} = \V{v} = 0 \lor \V{k} = 1 \land \V{v} \in \Set{0,1} \mat \Set{(\otR, \V{a}, \V{v})} \\
\end{rclarray}
\]

\[
\begin{session}
\specline{\sptboxass{\vx \pt 0 \sep \vy \pt 0}{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
\begin{session}
    \specline{\sptboxass{\vx \pt 0 \sep \vy \pt 1}{\vx \pt 0 \sep \vy \pt 0 \lor \vy \pt 1}{\lrid}{\intass} \\
            \lor \sptboxass{\vx \pt 0 \sep \vy \pt 0}{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
    \begin{transaction}
        \specline{\vx \pt 0 \sep ( \vy \pt 0 \lor \vy \pt 1 )} \\
        \pderef{\pvar{b}}{\vy} ; \\
        \specline{\vx \pt 0 \sep {} \\
                    \begin{formulea}
                        \vy \pt 0 \sep \fpass{(\otR, \vy, 0)} \land \pvar{b} = 0 \\ 
                        {} \lor \vy \pt 1 \sep \fpass{(\otR, \vy, 1)} \land \pvar{b} = 1 \\
                    \end{formulea} } \\
        \pifs{\pvar{b} = 0} \\ 
        \quad \pmutate{\vx}{1} ; \\
        \pife \\
        \comment{ weaken the assertion } \\
        \specline{\vx \pt 1 \sep \vy \pt 0 \sep \fpass{(\otR, \vy, 0), (\etW, \vx, 1)} \\
                        {} \lor \vx \pt 0 \sep \vy \pt 1 \sep \fpass{(\otR, \vy, 1)} } \\

    \end{transaction} \\
    \specline{\sptboxass{\vx \pt 0 \sep \vy \pt 1}{\vx \pt 0 \sep \vy \pt 0 \lor \vy \pt 1}{\lrid}{\intass} \\ 
            {} \lor \sptboxass{\vx \pt 1 \sep \vy \pt 1}{\vx \pt 1 \sep \vy \pt 0 \lor \vy \pt 1}{\lrid}{\intass} \\
            {} \lor \sptboxass{\vx \pt 1 \sep \vy \pt 0}{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} } \\
\end{session}
&
\begin{session}
    \specline{\sptboxass{\vx \pt 1 \sep \vy \pt 0}{\vx \pt 0 \lor \vx \pt 1 \sep \vy \pt 0}{\lrid}{\intass} \\
            \lor \sptboxass{\vx \pt 0 \sep \vy \pt 0}{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
    \begin{transaction}
        \pderef{\pvar{a}}{\vx} ; \\
        \pifs{\pvar{a} = 0} \\ 
        \quad \pmutate{\vy}{1} ; \\
        \pife \\
    \end{transaction} \\
    \specline{\sptboxass{\vx \pt 1 \sep \vy \pt 0}{\vx \pt 0 \lor \vx \pt 1 \sep \vy \pt 0}{\lrid}{\intass} \\
            {} \lor \sptboxass{\vx \pt 1 \sep \vy \pt 1}{\vx \pt 0 \lor \vx \pt 1 \sep \vy \pt 1}{\lrid}{\intass} \\ 
            {} \lor \sptboxass{\vx \pt 0 \sep \vy \pt 0}{\vx \pt 0 \sep \vy \pt 0}{\lrid}{\intass} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\end{parl} \\
\specline{\exsts{\V{v}, \V{n}} 
            \sptboxass{\vx \pt \V{v} \sep  \vy \pt \V{n}}{\vx \pt \V{v} \sep  \vy \pt \V{n}}{\lrid}{\intass} 
            \land (\V{v}, \V{n}) \in \Set{(1,0),(0,1),(1,1)}
            \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\end{session}
\]


\subsection{Litmus Test For SI, Long fork}

\[
    \boxass{ \V{x} \pt \stub \sep \V{y} \pt \stub \sep \V{w} \pt \stub \sep \V{z} \pt \stub }{\lrid}{\intass} 
\]

\[
\intass :
\begin{rclarray}[t]
    \C{L} & : & \V{x} \pt \stub \mat \Set{(\etW, \V{x}, 1)} \\
    \C{L} & : & \exsts{ \V{n} } \V{x} \pt 1 \sep \V{y} \pt \V{n} \sep \V{w} \pt \stub \land \V{n} \in \Set{0,1} \mat \Set{(\otR, \V{x}, 1), (\otR, \V{y}, 0), (\etW, \V{w}, 1) } \\
    \C{R} & : & \V{y} \pt \stub \mat \Set{(\etW, \V{y}, 1)} \\
    \C{R} & : & \exsts{ \V{k} } \V{x} \pt \V{k} \sep \V{y} \pt 1 \sep \V{z} \pt \stub \land \V{k} \in \Set{0,1} \mat \Set{(\otR, \V{x}, 0), (\otR, \V{y}, 1), (\etW, \V{z}, 1) } \\
    \C{Rd} & : & \exsts{ \V{a} \in \Set{ \V{x}, \V{y} }, \V{v}, \V{k} } \V{a} \pt \V{k} \land (\V{k} = 1 \land \V{v} \in \Set{0,1}) \lor \V{k} = \V{v} = 0 \mat \Set{(\otR, \V{a}, \V{v})} \\
\end{rclarray}
\]

\[
\begin{session}
\specline{ \sptboxass{\vx \pt 0 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 0 \sep \vy \pt 0 \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \sep \cass{\C{L}}{\lrid} \sep \cass{\C{R}}{\lrid} } \\
\begin{parl}
    \begin{session}
        \specline{ \sptboxass{\vx \pt 0 \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 0 \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 0 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 0 \sep ( \vy \pt 0 \lor \vy \pt 1 ) \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 0 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt 0 \sep ( \vy \pt 0 \lor \vy \pt 1 ) \\ {} \sep \vw \pt 0 \sep ( \vz \pt 0 \lor \vz \pt 1 )}{\lrid}{\intass} \\  
                {} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \pmutate{\vx}{1};
        \end{transaction} \\
        \specline{ \sptboxass{\vx \pt 1 \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 1 \sep \vy \pt 0 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\ 
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\vx \pt 1 \sep ( \vy \pt 0 \lor \vy \pt 1 ) \\ {} \sep \vw \pt 0 \sep \vz \pt 0}{\lrid}{\intass} \lor {} \\  
                \sptboxass{\vx \pt 1 \sep \vy \pt 1 \\ {} \sep \vw \pt 0 \sep \vz \pt 1}{\vx \pt 1 \sep ( \vy \pt 0 \lor \vy \pt 1 ) \\ {} \sep \vw \pt 0 \sep ( \vz \pt 0 \lor \vz \pt 1 )}{\lrid}{\intass} \\  
                {} \sep \cass{\C{L}}{\lrid} } \\
        \begin{transaction}
            \specline{\exsts{\V{m}} \V{m} \in \Set{0,1} \land \vx \pt 1 \\ {} \sep \vy \pt \V{m} \sep \vw \pt 0} \\
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \specline{\exsts{\V{m}} \V{m} \in \Set{0,1} \land \vx \pt 1 \\ {} \sep \vy \pt \V{m} \sep \vw \pt 0 \\
                        {} \sep \fpass{(\otR, \vx, 1),(\otR, \vy, \V{m})} \\
                        {} \land \pvar{a} = 1 \land \pvar{b} = \V{m} } \\
            \pifs{\pvar{a} = 1 \ \&\& \ \pvar{b} = 0} \\
            \quad \pmutate{\pvar{w}}{1} \\
            \pife \\
            \specline{ \asstrue \sep \fpass{(\otR, \vx, 1),(\otR, \vy, 1)} \lor {} \\
                        \fpass{(\otR, \vx, 1),(\otR, \vy, 0), (\etW, \vw, 1) } } \\
        \end{transaction}  \\
        \comment{If x is 1, it means} \\
        \comment{the global value is 1.} \\
        \comment{If y is 0, it means} \\
        \comment{the global value might be 0 or 1.} \\
        \specline{ \boxass{ \vx \pt 1 \sep \vw \pt 1 \sep \vy \pt 0 \sep \vz \pt 0 \\
                {} \lor \vx \pt 1 \sep \vw \pt 0 \sep \vy \pt 1 \sep \vz \pt 0  \\
                {} \lor \vx \pt 1 \sep \vw \pt 0 \sep \vy \pt 1 \sep \vz \pt 1  \\
                {} \lor \vx \pt 1 \sep \vw \pt 1 \sep \vy \pt 1 \sep \vz \pt 0  \\
                {} { \color{purple} \lor \vx \pt 1 \sep \vw \pt 1 \sep \vy \pt 1 \sep \vz \pt 1 }  \\
            }{\lrid}{\intass}
        } \\
    \end{session} 
    &
    \begin{session}
        \begin{transaction}
            \pmutate{\vy}{1};
        \end{transaction} \\
        \begin{transaction}
            \pderef{\pvar{a}}{\vx}; \\
            \pderef{\pvar{b}}{\vy}; \\
            \pifs{\pvar{a} = 0 \ \&\& \ \pvar{b} = 1} \\
            \quad \pmutate{\pvar{z}}{1} \\
            \pife
        \end{transaction}  \\
        \specline{ \boxass{ 
                        \vy \pt 1 \sep \vz \pt 1 \sep \vx \pt 0 \sep \vw \pt 0 \\
                {} \lor \vy \pt 1 \sep \vz \pt 0 \sep \vx \pt 1 \sep \vw \pt 0  \\
                {} \lor \vy \pt 1 \sep \vz \pt 0 \sep \vx \pt 1 \sep \vw \pt 1  \\
                {} \lor \vy \pt 1 \sep \vz \pt 1 \sep \vx \pt 1 \sep \vw \pt 0  \\
                {} { \color{purple} \lor \vx \pt 1 \sep \vw \pt 1 \sep \vy \pt 1 \sep \vz \pt 1 }  \\
            }{\lrid}{\intass}
        } \\
    \end{session}
\end{parl}
\end{session}
\]
The { \color{purple} purple } part means, from the rule which is a semantics checking it is impossible, since the invariant computed from the interference actually rule out this case.
But syntactically it is not able to see that.
We can reintroduce some ghost state to cheat on this example in a syntactic way.
%A dummy bank transfer example that is not serialisable.
%\[
    %\begin{rclarray}
        %\intass(\rid) & = &
        %\begin{cases}
            %\unitelem{} : \exsts{x, m, k} x \fpt{\fp} n \sep \cass{S(m)}{\rid} \transfersto x \fpt{\addFPW{\fp}} n \pm k \sep  \cass{S(m \pm k)}{\rid} \\
            %\unitelem{} : \exsts{x} x \fpt{\fp} n \transfersto x \fpt{\addFPR{\fp}} n 
        %\end{cases} \\
        %S(m) \composeK S(n) & = & S(m+n) \\
        %S(0) & \in & \unitK \\
    %\end{rclarray}
%\]
%A dummy bank transfer example that is serialisable even under snapshot isolation.
%\[
    %\begin{rclarray}
        %\intass & = &
        %\begin{cases}
            %\unitelem{} : \exsts{x, y, m, k} x \fpt{\fp} n \sep  y \fpt{\fp'} m \transfersto x \fpt{\addFPW{\fp}} n - k \sep \fpt{\addFPW{\fp}} m + k  \\
            %\unitelem{} : \exsts{x} x \fptEMP n \transfersto x \fptR n 
        %\end{cases}
    %\end{rclarray}
%\]
%If x write y and if y write x example.
%\[
    %\begin{rclarray}
        %\intass(x,y) & = &
        %\begin{cases}
            %\perm{L} : x \fptEMP 0 \sep y \fptEMP 0 \transfersto x \fptW 1 \sep y \fptR 0 \\
            %\perm{R} : x \fptEMP 0 \sep y \fptEMP 0 \transfersto x \fptR 0 \sep y \fptW 1 \\
        %\end{cases}
    %\end{rclarray}
%\]
