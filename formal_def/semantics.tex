
\section{Semantics}
\label{sec:semantics}

\sx{
    For Philippa and others who read Andrea's report, this is a re-edit version of the semantics, mainly for the reason of properly definition blocks, references, etc.
    Steal many words from that report and add more explanation.
    Few notations difference,
    \begin{itemize}
        \item address \( \addr \) .
            At some point we use \( l \)  for heap/history heap locations, yet there is a variable clash so using \( \addr \).
        \item Transaction identifier \( \txid \).
        \item \( \hh \)  history heap, and we assume index starts from 1 instead of 0.
            We use superscripts \( \hhV(\addr)(3) \), \( \hhW(\addr)(3) \) and \( \hhR(\addr)(3) \) for the value, write, and reads of the version corresponding to the third version of the address \( \addr \) in the history \( \hh \).
        \item \( \stk \) per-thread stack, and no transaction stack.
        \item \( \vi \) single view, as \( \val \) is for value and \( V \) looks like a set.
        \item \( (\otR, \addr, \val ) \) denotes a operation read address \( \addr \) with value is \( \val \) and similarly the write \( (\otW, \addr, \val ) \)
            Also we use, for example \( \opset \addO (\otR, \stub, \stub) \) instead of \( \oplus \), as the latter looks like a commutative operator??
        \item We call \( \funcn{op}\) instead of \( \funcn{Fprint} \) for the function extract the operation/fingerprint from the primitive commands.
            Because we use \emph{fingerprint} to refer the \emph{fingerprint assertion} later in the logic.
        \item We call \( \func{localHp}{\hh, \vi} \) instead of \( \func{snapshot}{\hh, \vi} \) as the latter is a bit misleading.
        \item \( \func{updHisHp}{\hh, \vi, \txid, \opset} \) instead of \( \funcn{HHupdate}_{\txid}(\hh, \vi, \opset)\).
        \( \func{updView}{\hh, \vi, \opset}\) instead of  \( \func{ViewUpdate}{\hh, \vi, \opset} \), but we also assume the \( \hh \) here is the new one not the old one.
        \item Consistency model \( \como \) as it is a set of quadruples and \( C \) is used for command, so we pick a capital \( \como \).
    \end{itemize}
    \ac{
        \( \hh(\addr, 3).\texttt{val} \) instead of \( \hhV(\addr)(3) \) 

        \( \vartriangleleft \) to \( \addO \) so that not clash with \( \csat \)
        
        \emph{Heaps} in general are not sure, maybe \emph{key-value stores}. Just a terminology change.

        Commit tests/Execution tests \( \como \) than consistency models.
        }
    }

\sx{The small intro is stolen from Andrea :)}
We focus on an abstract computational model for database where multi-threaded programs can access and update addresses in a heap through atomic transactions. 
Transactions in our model execute atomically, though they have different effect on database depending on the consistency model that does not necessarily correspond to \emph{serialisability}. 
This means that, at the moment of executing, a transaction may not observe the most up-to-date value of an address. 
To overcome this issue, we model the state of the database using \emph{history heaps}. 
A history heap keeps track of all the versions written for any address, as well as the information about the transactions that read and wrote such versions. 
To model the potential out-of-date observation, we use \emph{views}.
A view decides the observable versions of addresses for a thread.
When executing, a transaction extracts a local state from the history heap and the view, and afterwards the transaction commits a set of operations that might change the history heap and the view, if the change is allowed by the consistency model.

We starts with the syntax of programs followed by the semantics of transaction.
Then we will formally define history heaps and views, and how we specify consistency models.
Finally, we will give the semantics for the entire programs.


\input{./formal_def/semantics/trans.tex}
%\input{./formal_def/semantics/graph.tex}
\input{./formal_def/semantics/history.tex}
\input{./formal_def/semantics/example.tex}
