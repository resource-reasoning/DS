\subsection{Update Atomic}
%\begin{figure}
%\begin{tabular}{|c|c|}
%\hline
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $T_0$ \\
  %{a} & $\emptyset$ \\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $T_0$ \\
  %{a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $T_0$ \\
  %{a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v0.north east) node (tid1start) {} -- 
%% ([xshift=-2pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-2pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v0.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v0.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v0.north east) node (tid3start) {}-- 
%% ([xshift=-16pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-16pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-16pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}
%%
%&
%%
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};
%\node[version node, fit=(locxcells-1-3) (locxcells-2-3), fill=white, inner sep= 0cm, font=\Large] (locx-v1) {$1$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};
%\node[version node, fit=(locf1cells-1-3) (locf1cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf1-v1) {$1$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $T_0$ \\
  %{a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v0.north east) node (tid1start) {} -- 
%% ([xshift=-2pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-2pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v0.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v0.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v1.north east) node (tid3start) {}-- 
%% ([xshift=-16pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-16pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}
%\\
%{\small (a)} & {\small (b)}\\
%\hline
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, column 2/.style = {text width=14mm}, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$ & {a} & $\tsid_2$\\
  %{a} & $\{\tsid_1, \tsid_2\}$ & {a} & $\emptyset$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};
%\node[version node, fit=(locxcells-1-3) (locxcells-2-3), fill=white, inner sep= 0cm, font=\Large] (locx-v1) {$1$};
%\node[version node, fit=(locxcells-1-5) (locxcells-2-5), fill=white, inner sep= 0cm, font=\Large] (locx-v2) {$1$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};
%\node[version node, fit=(locf1cells-1-3) (locf1cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf1-v1) {$1$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_2$\\
  %{a} & $\{\tsid_2\}$ & {a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};
%\node[version node, fit=(locf2cells-1-3) (locf2cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf2-v1) {$1$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v0.north east) node (tid1start) {} -- 
%% ([xshift=-2pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-2pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v2.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locx-v2.south east) --
 %([xshift=-5pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locf1-v0.south east) --
 %([xshift=-5pt, yshift=5pt]locf2-v1.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v1.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v1.north east) node (tid3start) {}-- 
 %([xshift=-16pt, yshift=-5pt]locx-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf1-v1.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}
%%
%&
%%
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, column 2/.style = {text width=14mm}, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$ & {a} & $\tsid_2$\\
  %{a} & $\{\tsid_1, \tsid_2\}$ & {a} & $\emptyset$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};
%\node[version node, fit=(locxcells-1-3) (locxcells-2-3), fill=white, inner sep= 0cm, font=\Large] (locx-v1) {$1$};
%\node[version node, fit=(locxcells-1-5) (locxcells-2-5), fill=white, inner sep= 0cm, font=\Large] (locx-v2) {$1$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};
%\node[version node, fit=(locf1cells-1-3) (locf1cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf1-v1) {$1$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_2$\\
  %{a} & $\{\tsid_2\}$ & {a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};
%\node[version node, fit=(locf2cells-1-3) (locf2cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf2-v1) {$1$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v2.north east) node (tid1start) {} -- 
 %([xshift=-2pt, yshift=-7pt]locx-v2.south east) --
 %([xshift=-2pt, yshift=3pt]locf1-v1.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-2pt, yshift=5pt]locf2-v1.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v1.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v2.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locx-v2.south east) --
 %([xshift=-5pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locf1-v0.south east) --
 %([xshift=-5pt, yshift=5pt]locf2-v1.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v1.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v1.north east) node (tid3start) {}-- 
 %([xshift=-16pt, yshift=-5pt]locx-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf1-v1.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}\\
%{\small (c)} & {\small (d)} \\
%\hline
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};
%\node[version node, fit=(locxcells-1-3) (locxcells-2-3), fill=white, inner sep= 0cm, font=\Large] (locx-v1) {$1$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};
%\node[version node, fit=(locf1cells-1-3) (locf1cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf1-v1) {$1$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $T_0$ \\
  %{a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v0.north east) node (tid1start) {} -- 
%% ([xshift=-2pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-2pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v1.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-5pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v0.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v1.north east) node (tid3start) {}-- 
%% ([xshift=-16pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-16pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}
%&
%\begin{tikzpicture}[font=\large]

%\begin{pgfonlayer}{foreground}
%%Uncomment line below for help lines
%%\draw[help lines] grid(5,4);

%%Location x
%\node(locx) at (1,3) {$[\loc_x] \mapsto$};

%\matrix(locxcells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locx.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$ & {a} & $\tsid_2$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\{\tsid_2\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locxcells-1-1) (locxcells-2-1), fill=white, inner sep= 0cm, font=\Large] (locx-v0) {$0$};
%\node[version node, fit=(locxcells-1-3) (locxcells-2-3), fill=white, inner sep= 0cm, font=\Large] (locx-v1) {$1$};
%\node[version node, fit=(locxcells-1-5) (locxcells-2-5), fill=white, inner sep= 0cm, font=\Large] (locx-v2) {$2$};

%%Location y
%\path (locx.south) + (0,-1.5) node (locf1) {$[\loc_{f_1}] \mapsto$};
%\matrix(locf1cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf1.east) {
 %{a} & $\tsid_0$ & {a} & $\tsid_1$\\
  %{a} & $\{\tsid_1\}$ & {a} & $\emptyset$\\
%};
%\node[version node, fit=(locf1cells-1-1) (locf1cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf1-v0) {$0$};
%\node[version node, fit=(locf1cells-1-3) (locf1cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf1-v1) {$1$};

%%Location y
%\path (locf1.south) + (0,-1.5) node (locf2) {$[\loc_{f_2}] \mapsto$};
%\matrix(locf2cells) [version list, text width=7mm, anchor=west]
   %at ([xshift=10pt]locf2.east) {
 %{a} & $T_0$ & {a} & $\tsid_2$\\
  %{a} & $\emptyset$ & {a} & $\emptyset$ \\
%};
%\node[version node, fit=(locf2cells-1-1) (locf2cells-2-1), fill=white, inner sep= 0cm, font=\Large] (locf2-v0) {$0$};
%\node[version node, fit=(locf2cells-1-3) (locf2cells-2-3), fill=white, inner sep= 0cm, font=\Large] (locf2-v1) {$1$};

%% \draw[-, red, very thick, rounded corners] ([xshift=-5pt, yshift=5pt]locx-v1.north east) |- 
%%  ($([xshift=-5pt,yshift=-5pt]locx-v1.south east)!.5!([xshift=-5pt, yshift=5pt]locy-v0.north east)$) -| ([xshift=-5pt, yshift=5pt]locy-v0.south east);

%%blue view - I should  check whether I can use pgfkeys to just declare the list of locations, and then add the view automatically.
%\draw[-, blue, very thick, rounded corners=10pt]
 %([xshift=-2pt, yshift=20pt]locx-v0.north east) node (tid1start) {} -- 
%% ([xshift=-2pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf1-v0.north east) -- 
%% ([xshift=-2pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-2pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-2pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid1start) node[anchor=south, rectangle, fill=blue!20, draw=blue, font=\small, inner sep=1pt] {$\thid_3$};

%%red view
%\draw[-, red, very thick, rounded corners = 10pt]
 %([xshift=-5pt, yshift=5pt]locx-v2.north east) -- 
 %([xshift=-5pt, yshift=-5pt]locx-v2.south east) --
 %([xshift=-5pt, yshift=5pt]locf1-v1.north east) -- 
%% ([xshift=-5pt, yshift=-5pt]locf1-v0.south east) --
%% ([xshift=-5pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-5pt, yshift=-10pt]locf2-v1.south east) node (tid2start) {};
 
%\path (tid2start) node[anchor=north, rectangle, fill=red!20, draw=red, font=\small, inner sep=1pt] {$\thid_2$};
 
 %%green view
%\draw[-, DarkGreen, very thick, rounded corners = 10pt]
 %([xshift=-16pt, yshift=8pt]locx-v1.north east) node (tid3start) {}-- 
%% ([xshift=-16pt, yshift=-5pt]locx-v0.south east) --
%% ([xshift=-16pt, yshift=5pt]locf1-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf1-v1.south east) --
 %([xshift=-16pt, yshift=5pt]locf2-v0.north east) -- 
 %([xshift=-16pt, yshift=-5pt]locf2-v0.south east);
 
 %\path (tid3start) node[anchor=south, rectangle, fill=DarkGreen!20, draw=DarkGreen, font=\small, inner sep=1pt] {$\thid_1$};

%\end{pgfonlayer}
%\end{tikzpicture}\\
%{\small(e)} & {\small(f)}\\
%\hline
%\end{tabular}
%\caption{History heaps obtained in a execution of $\prog_3$.}
%\label{fig:cu.exec}
%\end{figure}
\ac{This Consistency Model shows why the notion of consistent views must 
depend on the set of operations that need to be executed.}

The next consistency model that we consider is \emph{Update Atomic}. 
Although we did not find any implementation of this model, it has been proposed in \cite{framework-concur} as a strengthening to Read Atomic to avoid write-write conflicts.
This model states that: \textbf{(i)} transactions satisfy atomic visibility (\defref{def:readatomic}); and \textbf{(ii)} transactions writing to one same addressees cannot be executed concurrently.
\sx{ This appears too earlier:
Update Atomic is also needed to specify more sophisticated consistency models, 
such as \emph{Parallel Snapshot Isolation} and \emph{Snapshot Isolation}.}
\ac{Check: Nobi said he was interested in implementing Update Atomic 
at some point, maybe he ended up doing something.}

Programs under Update Atomic do not exhibit the \emph{lost update} anomaly: two or more transactions update the same address, for example , both increment its value by $1$, but only one of them will be observed by future transactions, for example, only one of the increments takes effect.
To illustrate the lost update anomaly, consider the following program where two transactions concurrently increment $\vx$ and the third transaction read the value. 
Note that the \( \pvar{f1} \) and \( \pvar{f2} \) are two flags indicating the corresponding transactions has been committed.
\ac{Intuitive behaviour of the litmus test: two transactions concurrently increment $[\loc_x]$. 
 A third transaction observes that the first two transactions have been executed. 
 However, it only observes one of the two increments taking place.
 }
\[
    \prog_3 \equiv \begin{session}
        \begin{array}{@{}c || c || c@{}}
        \txid_1 : 
        \begin{transaction} 
            \pmutate{\pvar{f1}}{1};\\
            \pderef{\pvar{a}}{\vx};\\
            \pmutate{\vx}{a + 1};\\
        \end{transaction} & 
        \txid_2 : 
        \begin{transaction}
            \pmutate{\pvar{f2}}{1};\\
            \pderef{\pvar{a}}{\vx};\\
            \pmutate{\vx}{a + 1};\\
        \end{transaction} &
        \txid_3 : 
        \begin{transaction}
            \pderef{\pvar{a}}{\vx};\\
            \pderef{\pvar{b}}{\pvar{f1}};\\
            \pderef{\pvar{c}}{\pvar{f2}};\\
            \pifs{\pvar{a}=1 \wedge \pvar{b}=1 \wedge \pvar{c} = 1}\\ 
                \quad \passign{\retvar}{\Large \frownie{}}
            \pife
        \end{transaction}
        \end{array}
    \end{session}
 \]

\sx{Did not check the example explanation}
We consider an execution in which the transactions contained in the code of threads 
$\thid_1, \thid_2$ both execute w.r.t. the snapshot determined by the initial view. 
Initially, the configuration of the program coincides with the one given in 
Figure \ref{fig:cu.exec}(a). After executing the transaction of $\thid_1$, the resulting 
configuration is the one depicted in Figure \ref{fig:cu.exec}(b). Next, after $\thid_2$ executed 
its own transaction, we obtain the configuration in \ref{fig:cu.exec}(c). Note that 
in this configuration, both transactions $\txid_1, \txid_2$ read the initial version 
for location $[\loc_x]$. Finally, thread $\thid_3$ updates its view to include the most recent 
version for all the locations $[\loc_x], [\loc_{f_1}], [\loc_{f_2}]$. When executing the 
transaction in its code, all the locations will be found to have value $1$, and 
the return variable will be set to ${\Large \frownie{}}$.

The program $\prog_3$ might exhibit the lost-update anomaly because when the second transaction $\txid_2$ starts, its view did not include the most up-to-date version for address $\vx$ provided that \( \txid_{2}\) will update the address \( \vx \).
\sx{
However, the same transaction installed a new version for $[\loc_x]$. That is, 
}
As consequence, the database \emph{lost the update} of a version of \( \vx \) installed by the transaction $\txid_1$, in a sense that no transaction will observe such the version.
To forbid this anomaly, the \emph{update atomic} requires that if a transaction writes to an address, the transactions must start with a view including the most recent version for the address.
\sx{
then it must have been executed 
in a snapshot obtained from a view including the most recent version of 
$[\loc_x]$.
}

\begin{defn}
\label{def:update-atomic}
\emph{Update atomic} is stronger than then read atomic (\defref{def:readatomic}) by further requiring for all addresses written, it should starts with including the most recent version for those addresses,
\[
\begin{rclarray}
 (\hh, \vi) \csat[\mathsf{UA}] \opset: \vi' & \defeq &
 \begin{array}[t]{@{}l}
 (\hh, \vi) \csat[\mathsf{RA}] \opset: \vi' \land \fora{\addr} \\ 
 \quad (\otW, \addr, \stub) \in \opset \implies \vi(\addr)  = \left| \hh(\addr) \right|
 \end{array} \\
\end{rclarray}
\]
\sx{
$(\hh, V) \triangleright_{\mathsf{UA}} \mathcal{O}: V'$ iff 
$(\hh, V) \triangleright_{\mathsf{RA}} \mathcal{O}: V'$, and 
for all locations $[\loc_x]$ such that $(\otW\; [\loc_x] : \_ \in \mathcal{O})$ 
then $V([\loc_{x}]) = \lvert \hh([\loc_x]) \rvert - 1$. 
}
\end{defn}

Note that in $prog_3$, under $\mathsf{UA}$, 
we cannot execute the transaction of $\thid_2$ starting from 
the configuration depicted in Figure \ref{fig:cu.exec}(b). This 
is because the view of $\thid_2$, in such a configuration, does 
not include the most recent version for location $[\loc_x]$. 
Instead, before executing its transaction $\thid_2$ must update 
its view to include the most recent version of $[\loc_x]$. The 
resulting configuration is depicted in Figure \ref{fig:cu.exec}(e). 
After executing its transaction using the snapshot obtained 
from the view of $\thid_2$ in this configuration, the resulting 
configuration is the one obtained in Figure \ref{fig:cu.exec}(f). 
There are now three different possible configurations in which 
$\thid_3$ can execute its transaction: 
\begin{itemize}
\item the initial one, in which case the value $0$ will be observed 
for the three locations $[\loc_x], [\loc_{f1}]$ and $[\loc_{f_2}]$. 
In this case the transaction will not return value ${\Large \frownie{}}$, 
\item one in which the view of $\thid_3$ for $[\loc_x]$ points to the 
version $(1, \tsid_1, \{\tsid_2\})$. Because of atomic visibility, 
it must also be the case that the same view for location $[\loc_{f_2}]$ 
does not include the update performed by $\tsid_2$ (otherwise, 
the view for $[\loc_x]$ should point to its most recent version, which 
was also installed by $\tsid_2$. Thus in this case the transaction executes 
w.r.t a snapshot where $\loc_{f_2} = 0$, and the value ${\Large \frownie{}}$ 
will not be returned, 
\item one in which the view of $\thid_3$ for $[\loc_x]$ points to 
its most recent version $(2, \tsid_2, \emptyset)$; also in this case, 
the value ${\Large \frownie{}}$ will not be returned from the transaction.
\end{itemize}

