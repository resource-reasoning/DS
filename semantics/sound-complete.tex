\subsection{soundness and completeness of the specification}

\subsubsection{\( \MRd \)}

\label{sec:sound-complete-mr}

We now show how to employ the proof technique from \cref{def:et_sound} to prove that the execution 
test $\ET_\MRd$ is sound with respect to the axiomatic specification $(\RP_{\LWW}, \{\lambda \aexec. \VIS_{\aexec} ; \PO_{\aexec} \})$. 
As a consequence of \cref{thm:et_soundness}, it follows that $\CMs(\ET_{\MRd}) \subseteq \{ \hh_{\aexec} \mid \aexec \in \CMa(\RP_{\LWW}, 
\{\lambda \aexec. \VIS_{\aexec} ; \PO_{\aexec})\} \}$. 

As an invariant condition for the execution test $\ET_{\MRd}$, we choose 
\[
    I(\aexec, \cl) = \left( \bigcup_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^n_\cl) \right) \setminus \T_\rd
\]
where \( \T_\rd \) is all the read-only transactions in \( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^n_\cl) \) 
Let now $\hh, \vi, \vi', \opset$ be such that $\ET_{\MRd} \vdash (\hh, \vi) \triangleright \opset: \vi'$. 
Choose an arbitrary $\cl$, a transaction identifier $\txid \in \nextTxId(\hh, \cl)$, 
and an abstract execution $\aexec$ such that $\hh_{\aexec} = \hh$ such that 
\begin{equation}
I(\aexec, \cl) \subseteq \Tx(\hh, \vi)
\label{eq:mr_invariant}
\end{equation}
Let 
\[ 
\aexec' = \extend(\aexec, \txid, \opset, \Tx(\hh, \vi) \cup \T_\rd) 
\]
We can derive the following facts:
\begin{itemize}
\item $\{\txid' \mid (\txid', \txid) \in \VIS_{\aexec'} ; \PO_{\aexec'} \} \subseteq \Tx(\hh, \vi) \cup \T_\rd$. 
To see why this is true, suppose that $\txid' \xrightarrow{\VIS_{\aexec'}} \txid'' \xrightarrow{\PO_{\aexec'}} \txid$ 
for some $\txid', \txid''$. We show that $\txid' \in I(\aexec, \cl)$, and then \cref{eq:mr_invariant} ensures 
that $\txid' \in \Tx(\hh, \vi) \cup \T_{\mathsf{rd}}$. 

If $\txid'' \xrightarrow{\AR_{\aexec'}} \txid$, then $\txid'' = \txid_{\cl}^{n}$ for some $n \in \Nat$, 
and because $\txid'' \neq \txid$, and $\T_{\aexec'} \setminus \T_{\aexec} = \{ \txid \}$, we also 
have that $\txid'' \in \aexec$. By the definition of $I(\aexec, \cl)$, we have that $\VIS^{-1}_{\aexec}(\cl) \subseteq 
I(\aexec, \cl)$: because $\txid' \xrightarrow{\VIS_{\aexec'}} \txid''$ and $\txid'' \neq \txid$, we have 
that $\txid' \xrightarrow{\VIS_{\aexec}} \txid''$, and therefore $\txid' \in I(\aexec, \cl)$. 

\item $I(\aexec', \cl) \subseteq \Tx(\aexec', \vi') = \Tx(\hh', \vi')$. 
In this case, because $\ET_{\MRd} \vdash (\hh, \vi) \triangleright \opset: \vi'$, 
then it must be the case that $\vi \viewleq \vi'$. 
A trivial consequence of this fact is that $\Tx(\hh, \vi) \subseteq \Tx(\hh, \vi')$.
Also, because $\aexec' = \extend(\aexec, \txid, \Tx(\hh, \vi) \cup \T_{\mathsf{rd}})$, 
we have that $\Tx(\hh_{\aexec}, \vi) = \Tx(\hh_{\aexec'}, \vi)$. 
{\color{red} to infer this there should be a Lemma that states that if $\vi \in \Views(\hh)$, 
then $\Tx(\updateKV(\hh, \vi', \txid, \opset), \vi) = \Tx(\hh, \vi)$.}
Finally, note that $\{\txid_{\cl}^{n} \in \aexec' \mid n \in \Nat\} = 
\{ \txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\} \cup \txid$, that for any 
$\txid_{\cl}^{n} \in \T_{\aexec}$ we have that $\VIS^{-1}_{\aexec'}(\txid_{\cl}^{n}) = 
\VIS^{-1}_{\aexec}(\txid_{\cl}^{n})$, and that 
$\VIS_{\aexec'}^{-1}(\txid) = \Tx(\hh, \vi) \cup \T_{\mathsf{rd}}$. 
Using all these facts, we obtain 
\[
\begin{rclarray}
I(\aexec', \cl) &=& \left( \bigcup_{\{\txid_{\cl}^{n} \in \aexec' \mid n \in \Nat\}} \VIS_{\aexec'}^{-1}(\txid_{\cl}^{n}) \right) \setminus \T_\rd \\
                &=& \left( \left( \bigcup_{\{\txid_{\cl}^{n} \in \aexec \mid n \in \Nat\}} \VIS_{\aexec}^{-1}(\txid_{\cl}^{n}) \right) \setminus \T_\rd  \right) \cup \left( \VIS^{-1}_{\aexec'}(\txid) \setminus \T_\rd  \right) \\
&=& I(\aexec, \cl) \cup \Tx(\hh, \vi) \\
&\stackrel{\eqref{eq:mr_invariant}}{\subseteq}& \Tx(\hh, \vi) \\
&=& \Tx(\hh_\aexec, \vi) \\
&=& \Tx(\hh_{\aexec'}, \vi) \\
&\subseteq& \Tx(\hh_{\aexec'}, \vi')
\end{rclarray}
\]
\end{itemize}

We show that the execution test $\ET_{\MRd}$ is complete 
with respect to the axiomatic specification $(\RP_{\LWW}, \{\lambda \aexec.(\VIS_{\aexec};\PO_{\aexec})\})$. 
To this end, let $\aexec$ be an abstract execution that satisfies the specification
$\CMa(\RP_{\LWW}, \{\lambda \aexec.(\VIS_{\aexec};\PO_{\aexec})\})$, 
and consider a transaction $\txid \in \T_{\aexec}$. 
Suppose that $\T_{\aexec} = \{\txid_{i}\}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let $\vi'_{i-1} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
We have two possible cases: 
\begin{itemize}
\item the transaction $\txid'_{i} = \min_{\PO_{\aexec}}\{\txid' \mid \txid_{i} \xrightarrow{\PO_{\aexec}} \txid'\}$ is 
defined. In this case let $\vi_{i} =\getView(\aexec, (\AR^{-1}_{\aexec})?(\txid_{i}) \cap \VIS^{-1}_{\aexec}(\txid'_{i}))$. 
Note that $\txid_{i} \xrightarrow{\PO_{\aexec}} \txid'_{i}$, and because $\aexec \models \VIS_{\aexec} ; \PO_{\aexec}$, 
it follows that $\VIS^{-1}_{\aexec}(\txid_{i}) \subseteq \VIS^{-1}_{\aexec}(\txid'_{i})$. 
We also have that $\VIS^{-1}_{\aexec}(\txid_{i}) \subseteq (\AR^{-1}_{\aexec})?(\txid_{i})$ because of 
the definition of abstract execution. It follows that 
\[
\VIS^{-1}_{\aexec}(\txid_{i}) \subseteq (\AR^{-1}_{\aexec})?(\txid_{i}) \cap \VIS^{-1}_{\aexec}(\txid'_{i}),
\]
Recall that  $\vi'_{i-1} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$, 
and $\vi_{i} =\getView(\aexec, (\AR^{-1}_{\aexec})?(\txid_{i}) \cap \VIS^{-1}_{\aexec}(\txid'_{i}))$. 
Thus we have that $\vi'_{i-1} \viewleq \vi_{i}$, and therefore $\ET_{\MRd} \vdash (\hh_{\cut(\aexec, i)}, \vi'_{i-1}) 
\triangleright \TtoOp{T}_{\aexec}(\txid_{i}) : \vi_{i}$. 
\item the transaction $\txid'_{i} = \min_{\PO_{\aexec}}\{\txid' \mid \txid_{i} \xrightarrow{\PO_{\aexec}} \txid_{i}\}$ 
is not defined. In this case, let $\vi_{i} = \getView(\aexec, (\AR^{-1}_{\aexec})?(\txid_{i}))$. 
As for the case above, we have that $\vi'_{i-1} \viewleq \vi_{i}$, and therefore 
$\ET_{\MRd} \vdash (\hh_{\cut(\aexec, i)}, \vi'_{i-1}) \triangleright \TtoOp{T}_{\aexec}(\txid_{i}) : \vi_{i}$. 
\end{itemize}

\subsection{\( \MW \)}

\label{sec:sound-complete-mw}

The execution test $\ET_\MW$ is sound with respect to the axiomatic specification 
$(\RP_{\LWW}, \Set{\lambda \aexec. \PO_{\aexec} ; \VIS_{\aexec} })$.
We pick the invariant as \( I( \aexec, \cl ) = \emptyset \), given the fact of no constraint on the view after update.
Assume a key-value store \( \mkvs \) and its corresponding abstract execution \( \aexec \) so that \( \mkvs = \mkvs_\aexec \).
Given an update on the key-value store that satisfies \( \MW \), \ie \( \MW \vdash (\mkvs, \vi) \csat \f : \vi' \),
by the \cref{def:et_sound}, it remains to prove that there exists another set of read-only transactions \( \T_{\rd} \) such that
\[
    \begin{array}{@{}l@{}}
        \fora{ \aexec', \txid, \txid' } \aexec' = \extend(\aexec, \txid, \Tx(\mkvs, \vi) \cup \T_\rd, \f ) \land (\txid' ,\txid)  \in \PO_{\aexec'} ; \VIS_{\aexec'}  \\
        \qquad {} \implies \txid' \in \Tx(\mkvs, \vi) \cup \T_\rd
    \end{array}
\]
Initially we take \( \T_\rd = \emptyset \), 
by closing the \( \Tx(\mkvs, \vi) \) with respect to \( \PO_{\aexec'} ; \VIS_{\aexec'} \)
we will add more read-only transactions into the set \( \T_\rd\).
Suppose \( (\txid' ,\txid)  \in \PO_{\aexec'} ; \VIS_{\aexec'} \), 
that is, \( \txid' \toEdge{\SO_{\aexec'}} \txid'' \toEdge{\VIS_{\aexec'}} \txid \).
If the transaction \( \txid'' \) writes to a key.
For the new abstract execution \( \aexec' \), the visible transactions for \( \txid \) must come from \( \Tx(\mkvs, \vi) \cup \T_\rd \).
It means \( \txid'' \in \Tx(\mkvs, \vi) \cup \T_\rd  \),
and then given that \( \txid'' \) is not a read-only transaction, we have \( \txid'' \in \Tx(\mkvs, \vi) \).
Now there are two cases: \textbf{(i)} \( \txid' \) is a read-only transaction, or \textbf{(ii)} \( \txid' \) has at least one write.
For the first case, we include \( \txid' \in \T_{\rd} \).
For the second case, it is easy to see \( \txid' \in \Tx(\mkvs, \vi) \) since \( j \in \vi(\ke) \wedge \WTx(\hh(\ke', i)) \xrightarrow{\PO?} \WTx(\hh(\ke, j)) \implies i \in \vi(\ke') \).
If the transaction \( \txid'' \) is a read-only transaction, 
there must exist a later transaction \( \txid''' \) from the same client that writes to a key,
and the transaction \( \txid''' \) is included in \( \Tx(\mkvs, \vi) \).
Since \( \SO \) is transitive, 
meaning \( \txid' \toEdge{\SO_{\aexec'}} \txid'' \toEdge{\SO_{\aexec'}} \txid''' \toEdge{\VIS_{\aexec'}} \txid \), 
we can prove \( \txid' \in \Tx(\mkvs, \vi) \) or we will include \( \txid' \) in \( \T_\rd \).
Since there are finite transactions from a client in a trace, there must exist a \( \T_\rd \) in the end.


The execution test $\ET_{\MW}$ is complete with respect to 
the axiomatic specification $(\RP_{\LWW}, \{\lambda \aexec.(\PO_{\aexec} ; \VIS_{\aexec})\})$. 
Let $\aexec$ be an abstract execution that satisfies the specification
$\CMa(\RP_{\LWW}, \{\lambda \aexec.(\PO_{\aexec} ; \VIS_{\aexec})\})$.
Suppose that $\T_{\aexec} = \{\txid_{i}\}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$, $\txid_{i} \xrightarrow{\AR_{\aexec}} 
\txid_{i+1}$.
Let views \( \vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}) ) \) and \( \vi'_{i} \subseteq \getView(\aexec, (\AR^{-1}_{\aexec})?(\txid_{i}) ) \).
It suffices to prove \( \ET_\MW \vdash (\hh_{\cut(\aexec, i-1)}, \vi_i ) \csat  \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i} \).
It means to prove the follows:
\begin{equation}
\label{equ:mw-complete}
\begin{array}{@{}l@{}}
    \fora{i,j,\ke, \ke' } j \in \vi(\ke)
    \wedge \WTx(\hh(\ke', i)) \xrightarrow{\PO?} \WTx(\hh(\ke, j)) 
    \implies i \in \vi(\ke')
\end{array}
\end{equation}
Assume \( j \) and \( \ke' \) such that \( j \in \vi(\ke')\), which means \( \WTx(\hh_{\cut(\aexec, i-1)}(\ke', j)) \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
Now let consider transaction \( \txid \) that commits before \( \txid \) from the same session, \ie \( \txid \toEdge{\SO} \WTx(\hh_{\cut(\aexec, i-1)}(\ke', j)) \).
By the constraint \( \lambda \aexec.(\PO_{\aexec} ; \VIS_{\aexec}) \), the transaction \( \txid \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
It means that in the kv-store \(  \hh_{\cut(\aexec, i-1)} \) every version written by \( \txid \) should be included in the view \( \vi_i \).
Thus we have the proof of \cref{equ:mw-complete}.

\subsection{ \( \RYW \) }

\label{sec:sound-complete-ryw}

The execution test $\ET_\RYW$ is sound with respect to the axiomatic specification 
$(\RP_{\LWW}, \{\lambda \aexec. \PO_{\aexec} \})$.
We pick an invariant for the \( \ET_\RYW \) as the following:
\[
    I(\aexec, \cl) = \left( \bigcup_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^n_\cl) \right) \setminus \T_\rd
\]
where \( \T_\rd \) is all the read-only transactions in \( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^n_\cl) \).
Suppose a kv-store \( \mkvs \), an abstract execution \( \aexec \) and a view \( \vi \)
such that \( \mkvs_\aexec = \mkvs \) and \( I(\aexec, \cl) \subseteq \Tx(\mkvs, \vi) \).
Assume that a fresh transaction identifier \( \txid_\cl^n \) with fingerprint \( \f \) commits to 
the kv-store \( \mkvs \) under view \( \vi \) and the view after is updated to \( \vi' \), that is, 
\( \ET_\RYW \vdash (\mkvs, \vi) \csat \f : \vi' \).
Let a new abstract execution \( \aexec' = \extend(\aexec, \txid_\cl^n, \f, \Tx(\mkvs, \vi) \cup \T_\rd) \).
We need to prove the following:
\begin{gather}
    \fora{\txid} \txid \toEdge{\SO_{\aexec'}} \txid_\cl^n \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \label{equ:ryw-sound-update}\\
    I(\aexec',\cl) \subseteq \Tx(\mkvs_{\aexec'}, \vi')\label{equ:ryw-sound-inv} 
\end{gather}
Assume a transaction \( \txid \) such that \( \txid \toEdge{\SO_{\aexec'}} \txid_\cl^n \).
It immediately implies that \( \txid = \txid_\cl^m\) where \( m < n \) and \( \txid_\cl^m \in \aexec \).
Thus we prove \cref{equ:ryw-sound-update} as \( \txid \in \left( \bigcup_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^n_\cl) \right) \subseteq \Tx(\mkvs,\vi) \cup \T_\rd\).
To prove \cref{equ:ryw-sound-inv}, let \( \T'_\rd = \T_\rd \) if the new transaction \( \txid_\cl^n\) has writes, otherwise \( \T'_\rd = \T_\rd \cup \Set{\txid_\cl^n}\).
First we have \( I(\aexec', \cl) = \left(\bigcup\limits_{\{\txid_{\cl}^{m} \in \T_{\aexec'} \mid m \in \Nat\}} (\SO_{\aexec'}^{-1})?(\txid^m_\cl) \right) \setminus \T'_{\rd} = \left( (\SO_{\aexec'}^{-1})?(\txid^n_\cl) \right) \setminus \T'_\rd \)
since that  \( \txid^n_\cl \) is the latest transaction committed by the client \( \cl \).
For any transaction \( \txid \in (\SO_{\aexec'}^{-1})?(\txid^n_\cl) \) that has write,
because \( \WTx( \mkvs_{\aexec'}(\ke, i) ) \leq \txid \implies i \in \vi'(\ke) \),
then \( \txid \in \Tx(\mkvs_{\aexec'}, \vi') \).
Thus we have the proof of \cref{equ:ryw-sound-inv}.


The execution test $\ET_{\RYW}$ is complete with respect to 
the axiomatic specification $(\RP_{\LWW}, \Set{\lambda \aexec.\PO_{\aexec} })$. 
Let $\aexec$ be an abstract execution that satisfies the specification
$\CMa(\RP_{\LWW}, \Set{\lambda \aexec.\PO_{\aexec} })$.
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
We construct the view after update \( \vi'_i\) depending on whether \( \txid_i \) is the last transaction from the client.
If the transaction \( \txid'_i = \min_{\SO_\aexec}(\Setcon{\txid'}{\txid_i \toEdge{\SO_\aexec} \txid' } ) \)  is defined,
then \( \vi'_i = \getView(\aexec, \T_i) \) where \( \T_i \subseteq (\AR_{\aexec}^{-1})?(\txid_i) \cap \VIS_\aexec^{-1}(\txid'_i) \) for some \( \T_i \).
Given the specification \( \lambda \aexec.\PO_{\aexec} \), 
we know \( \SO_\aexec^{-1}(\txid'_i) \subseteq \VIS_\aexec^{-1}(\txid'_i) \).
We pick \( \T_i = \AR_\aexec^{-1})?(\txid_i) \cap \SO_\aexec^{-1}(\txid'_i) = (\SO_\aexec^{-1})?(\txid_i) \).
Since \( \vi'_i = \getView(\aexec, \T_i) \), therefore \( \ET_\RYW \vdash (\hh_{\cut(\aexec, i-1)}, \vi_i) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i} \).
If there is no other transaction after \( \txid_i \) from the same client,
we pick \( \vi'_i = \getView(\aexec, \T_i) \) where \( \T_i = (\SO_\aexec^{-1})?(\txid_i) \),
so \( \ET_\RYW \vdash (\hh_{\cut(\aexec, i-1)}, \vi_i) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i} \).

\subsection{ \( \WFR \) }

\label{sec:sound-complete-wfr}

The write-read relation  on \( \aexec \) is defined as the following:
\[
\WR(\aexec, \ke) \defeq \Setcon{ (\txid, \txid') }{ \exsts{\val} (\otW, \ke, \val) \in_\aexec \txid \land (\otR, \ke, \val) \in_\aexec \txid' \land \txid = \max_\AR(\VIS^{-1}(\txid')) }
\]
The notation \( \WR_\aexec \) is defined as \( \WR_\aexec \defeq \bigcup\limits_{\ke \in \Keys} \WR(\aexec, \ke) \).
Note that for a key-value store \( \mkvs \) such that \( \mkvs = \mkvs_\aexec \),
by the definition of  \(  \mkvs = \mkvs_\aexec \), 
the following holds:
\[
    \WR_\aexec = \Setcon{(\txid, \txid')}{\exsts{\ke, i } \mkvs(\ke, i) = (\stub, \txid, \txid'\cup \stub)}
\]

The execution test $\ET_\MW$ is sound with respect to the axiomatic specification 
\( (\RP_{\LWW}, \Set{\lambda \aexec. \WR_\aexec ; (\PO_{\aexec})? ; \VIS_{\aexec} })\).
We pick the invariant as \( I( \aexec, \cl ) = \emptyset \), given the fact of no constraint on the view after update.
Assume a key-value store \( \mkvs \) and its corresponding abstract execution \( \aexec \) so that \( \mkvs = \mkvs_\aexec \).
Given an update on the key-value store that satisfies \( \WFR \), \ie \(\ET_\MW \vdash (\mkvs, \vi) \csat \f : \vi' \),
by the \cref{def:et_sound}, it remains to prove that
\[
    \begin{array}{@{}l@{}}
        \fora{ \aexec', \txid, \txid' } 
        \aexec' = \extend(\aexec, \txid, \Tx(\mkvs, \vi) , \f ) 
        \land (\txid' ,\txid)  \in \WR(\aexec',\ke) ; (\PO_{\aexec'})? ; \VIS_{\aexec'}   \\
        \qquad {} \implies \txid' \in \Tx(\mkvs, \vi) 
    \end{array}
\]
Suppose \( (\txid' ,\txid)  \in \WR(\aexec', \ke) ; (\PO_{\aexec'})? ; \VIS_{\aexec'} \) for some key \( \ke \),
that is, \( \txid' \toEdge{\WR(\aexec', \ke)} \txid'' \toEdge{\SO_{\aexec'}?} \txid''' \toEdge{\VIS_{\aexec'}} \txid \) for some transaction \( \txid''' \).
It immediately implies that \( \txid''' \in \Tx(\mkvs, \vi)  \).
Because \( \txid' \toEdge{\WR(\aexec', \ke)} \txid'' \), there exists an index \( i \) such that \( \mkvs(\ke, i) = (\stub, \txid', \txid'' \cup \stub) \).
By the execution test \( \ET_\WFR \), we have \( \i \in \vi( \ke ) \), thus \( \txid' \in \Tx(\mkvs, \vi ) \).


The execution test $\ET_\WFR$ is complete with respect to the axiomatic specification 
\( (\RP_{\LWW}, \{\lambda \aexec. \WR(\aexec', \ke) ; (\PO_{\aexec'})? ; \VIS_{\aexec'} \})\).
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
It is sufficient to prove the following:
\[
    \fora{\ke, \ke', i, j, \txid'} j \in \vi(\ke) \land \txid' \in \RTx(\hh(\ke', i)) \land \txid' {\xrightarrow{\PO?}} \WTx(\ke, j) ) \implies i \in \vi(\ke')
\]
Given a key \( \ke \) and an index \( j \) such that \( j \in \vi(\ke) \), 
it means that the writer \( \txid \) of the version is visible, \ie \( \txid \in \VIS_{\aexec'}^{-1}(\txid_i) \).
Assume some \( \txid' \) such that \( (\txid', \txid) \in (\PO_{\aexec'})? \) and reads a version of some key \( \mkvs(\ke',i) \).
Therefore, we know the writer of the key \( \txid'' = \WTx(\mkvs(\ke',i)) \) has a write-read edge to \( \txid' \), 
\ie \( (\txid'', \txid') \in \WR(\aexec', \ke)  \).
By the constraint on abstract execution \( \aexec \), we know \( \txid'' \in \VIS^{-1}_{\aexec'}(\txid_{i}) \),
which means \( i \in \vi(\ke')\) by the definition of \( \getView \).

\subsection{\( \CC \)}

\begin{lemma}
    \label{lem:aexec-spec-cc}
    For any abstract execution \( \aexec \) under last-write-win, if it satisfies the following:
    \[
        (\WR_\aexec \cup \SO_\aexec)^{+} ; \VIS_\aexec \subseteq \VIS_\aexec \quad \WR_\aexec \subseteq \VIS_\aexec \quad \SO_\aexec \subseteq \VIS_\aexec
    \]
    There exists a new abstract execution \( \aexec' \) where \( \T_\aexec = \T_{\aexec'} \), \( \AR_\aexec = \AR_{\aexec'} \),
    \( \VIS_{\aexec'} ; \VIS_{\aexec'} \subseteq \VIS_{\aexec'} \), and
    under last-write-win, \( \fora{\txid} \TtoOp{T}_{\aexec}(\txid) = \TtoOp{T}_{\aexec'}(\txid) \).
\end{lemma}
\begin{proof}
    To recall, the write-read relation under a key \( \WR(\aexec, \ke) \) is defined as 
    \( \WR(\aexec, \ke) \defeq \Setcon{ (\txid, \txid') }{ \exsts{\val} (\otW, \ke, \val) \in_\aexec \txid \land (\otR, \ke, \val) \in_\aexec \txid' \land \txid = \max_\AR(\VIS^{-1}(\txid')) }\).
    Given an \( \aexec \) that satisfies the following
    \[
        (\WR_\aexec \cup \SO_\aexec )^{+} ; \VIS_\aexec \subseteq \VIS_\aexec \quad \WR_\aexec \subseteq \VIS_\aexec \quad \SO_\aexec \subseteq \VIS_\aexec
    \]
    we erase some visibility relation for each transaction following the order of arbitration \( \AR \) until the visibility is transitive.
    Let \( R_i \) denote the new visibility for transaction \( \txid_i \) such that
    the visibility relation before (including) the i-\emph{th} transaction \( \txid_i \) is transitive, 
    thus \( R_i\projection{2} = \Set{\txid_i}\).

    Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
    $\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
    Let \( \aexec_i = \mkvs_\cut(\aexec, i) \) and \( \VIS_i = \bigcup\limits_{ 0 \leq k \leq i} R_i \).
    For each step, says i-\emph{th} step, we  preserve the following:
    \begin{gather}
        \VIS_i ; \VIS_i \subseteq \VIS_i \label{equ:vis-i-transitive} \\
        \fora{\txid} (\txid,\txid_i) \in R_i \implies (\txid, \txid_i) \in (\WR_i \cup \SO_i)^{+}
        \label{equ:last-read-correct}
    \end{gather}
    
    Let start with \( i = 1 \) and \( R_1 = \emptyset \).
    Assume it is from client \( \cl \).
    There is no transaction committed before, so \( \VIS_1 = \emptyset \) and \( \VIS_1 ; \VIS_1 \subseteq \VIS_1 \) as \cref{equ:vis-i-transitive}.

    Suppose the (i-1)-\emph{th} step satisfies \cref{equ:vis-i-transitive} and \cref{equ:last-read-correct}.
    Let consider i-\emph{th} step and the transaction \( \txid_i \).
    Initially we take \( R_i \) as empty set.
    We first extend \( R_i \) by closing with respect to \( \WR_i \)
    and prove that it does not affect any read from the transaction \( \txid_i \).
    Then we will do the same for \( \SO_i \).

    For any read \( (\otR, \ke, \val ) \in \txid_i \),
    there must be a transaction \( \txid_j \) that \( \txid_j \toEdge{\WR(\aexec_i,\ke), \AR} \txid_i \) and \( j < i \).
    We include \( (\txid_j, \txid_i) \in R_i \).
    Let consider all the visible transactions of \( \txid_j \).
    Assume a transaction \( \txid' \in \VIS_{i-1}^{-1}(\txid_j) \), 
    thus \( \txid' \in \VIS_{j}^{-1}(\txid_j) = R_j^{-1}(\txid_j) \).
    It is safe to include \( (\txid', \txid_i) \in R_i \) without affecting the read result.
    Because those transaction \( \txid' \) is visible for \( \txid_i \)  in \( \aexec \),
    as by \cref{equ:last-read-correct} we know \( R_j \subseteq (\WR_j \cup \SO_j)^{+} \subseteq (\WR_\aexec \cup \SO_\aexec)^{+}\),
    and by the definition of \( \WR(\aexec_i,\ke) \), we know \( \WR(\aexec_i,\ke) \subseteq \VIS_\aexec\).

    Given \( \SO_\aexec \subseteq \VIS_\aexec \), we include \( (\txid_j,\txid_i) \) for some \( \txid_j \)
    such that \( \txid_j \toEdge{\SO_\aexec} \txid_i\).
    For the similar reason as \( \WR \),
    it is safe to includes all the visible transactions \( \txid' \) for \( \txid_j \), \ie \( \txid' \in R_j^{-1}\).
    It means to include \( (\txid', \txid_i) \in R_i \).
    
    By the contraction, both \cref{equ:mw-complete} and \cref{equ:last-read-correct} are preserved.
    Thus we have the proof.
\end{proof}

The execution test $\ET_\CC$ is sound with respect to the axiomatic specification 
\( (\RP_{\LWW}, \Set{\lambda \aexec. \VIS_{\aexec} ; \VIS_{\aexec}, \lambda \aexec \ldotp \SO_\aexec })\).
By \cref{lem:aexec-spec-cc}, 
It is sufficient to prove soundness with respect to 
\( (\RP_{\LWW}, \Set{\lambda \aexec. ( \SO_{\aexec} \cup \WR_{\aexec} )^{+} ; \VIS_{\aexec}, \lambda \aexec \ldotp \SO_\aexec })\).
We pick an invariant for the \( \ET_\CC \) as the union of those for \( \MRd\) and \( \RYW \) shown in the following:
\[  
\begin{rclarray}
    I_1(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^n_\cl) \right) \setminus \T_\rd \\
    I_2(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^n_\cl) \right) \setminus \T_\rd
\end{rclarray}
\]
where \( \T_\rd \) is all the read-only transactions included in both 
\( \left( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^n_\cl) \right)\) 
and \( \left( \bigcup\limits_{\{\txid_{\cl}^{n} \in \T_{\aexec} \mid n \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^n_\cl) \right) \).
Suppose a kv-store \( \mkvs \), an abstract execution \( \aexec \) and a view \( \vi \)
such that \( \mkvs_\aexec = \mkvs \) and \( I_1(\aexec, \cl) \cup I_2(\aexec, \cl) \subseteq \Tx(\mkvs, \vi) \).
Assume that a fresh transaction identifier \( \txid_\cl^n \) with fingerprint \( \f \) commits to 
the kv-store \( \mkvs \) under view \( \vi \) and the view after is updated to \( \vi' \), that is, 
\( \ET_\CC \vdash (\mkvs, \vi) \csat \f : \vi' \).
Let a new abstract execution \( \aexec' = \extend(\aexec, \txid_\cl^n, \f, \Tx(\mkvs, \vi) \cup \T_\rd) \).
We are about to prove there exists an extra set of read-only transaction \( \T'_\rd \) such that:
\begin{gather}
    \fora{\txid} (\txid, \txid_\cl^n) \in \SO_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:cc-sound-update-so}\\
    \fora{\txid} (\txid, \txid_\cl^n) \in ( \SO_{\aexec'} \cup \WR_{\aexec'} )^{+} ; \VIS_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:cc-sound-update-visvis}\\
    I_1(\aexec',\cl) \cup I_2(\aexec',\cl) \subseteq \Tx(\mkvs_{\aexec'}, \vi') \label{equ:cc-sound-inv} 
\end{gather}
The invariant \( I_2 \) implies \cref{equ:cc-sound-update-so} as the same in \cref{sec:sound-complete-ryw}.
To prove \cref{equ:cc-sound-update-visvis}, let \( \T'_\rd = \emptyset \) initially,
and more more read-only transactions will be added in \( \T'_\rd \) until the \cref{equ:cc-sound-update-visvis} holds.
Assume transaction \( \txid \) such that \( ((\txid, \txid_\cl^n) \in ( \SO_{\aexec'} \cup \WR_{\aexec'} )^{+} ; \VIS_{\aexec'}) \).
That is, there exists some transaction \( \txid' \) such that
\( \txid \toEdge{( \SO_{\aexec'} \cup \WR_{\aexec'} )^+}  \txid' \toEdge{\VIS_{\aexec'}} \txid_\cl^n\).
We consider two cases for \( \txid' \): \textbf{(i)} \( \txid' \) is also visible by previous transactions from the same client; 
\textbf{(ii)} \( \txid' \) is a newly visible transaction for the client.
For the first case, it means \( \txid' \toEdge{\VIS_{\aexec'}} \txid_\cl^m \) for some \( m < n \).
The edge already exists before, therefore \( \txid' \toEdge{\VIS_\aexec} \txid_\cl^m \).
Since \( \txid \toEdge{( \SO_{\aexec} \cup \WR_{\aexec} )^{+}}  \txid' \) and \( ( \SO_{\aexec} \cup \WR_{\aexec} )^{+} ; \VIS_{\aexec} \subseteq \VIS_{\aexec} \),
we know \( \txid \toEdge{ \VIS_{\aexec} }  \txid_\cl^m  \).
Because of \( I_1 \) and \( \txid_\cl^m \toEdge{\SO} \txid_\cl^n \), then \( \txid \in I_1 \cup \T_\rd \subseteq \Tx(\mkvs, \vi) \cup \T_\rd \).
For the second case where \( \txid' \) is a newly visible transaction for the client \( \cl \).
It suffices to prove \( ( \SO_{\aexec'} \cup \WR_{\aexec'} )^{+} ; \VIS_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \).
Since \( \txid' \toEdge{\VIS_{\aexec'}} \txid_\cl^n \) so \( \txid' \in Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd\).
More specifically, \( \txid' \) is not visible for the client before, we know \( \txid' \in Tx(\mkvs, \vi) \cup \T'_\rd\).
If \( \txid' \) writes to some keys, \ie \( \txid' \in Tx(\mkvs, \vi) \), 
by the execution tests for \( \MW \) and \( \WFR \) (the proofs follows \cref{sec:sound-complete-mw} and \cref{sec:sound-complete-wfr}),
the \( \txid \) is either already in \( \Tx(\mkvs, \vi) \), 
or \( \txid \) is a read-only and we include it in \( \T'_\rd \).
If \( \txid' \) is a read-only transaction,
given that \( \T'_\rd \) initially is empty set,
we know there exists a third transaction \( \txid'' \) that at least writes to some key
and it satisfies \( \txid \toEdge{( \SO_{\aexec'} \cup \WR_{\aexec'} )}  \txid' \toEdge{( \SO_{\aexec'} \cup \WR_{\aexec'} )}  \txid'' \toEdge{\VIS_{\aexec'}} \txid_\cl^n \).
Since \( \txid'' \) has a write, it means 
\( \txid \toEdge{( \SO_{\aexec'} \cup \WR_{\aexec'} )}  \txid' \toEdge{( \SO_{\aexec'} )}  \txid'' \toEdge{\VIS_{\aexec'}} \txid_\cl^n \).
Because \( \SO \) is transitive, we have \( \txid \toEdge{( \SO_{\aexec'} \cup \WR_{\aexec'} )} \txid'' \toEdge{\VIS_{\aexec'}} \txid_\cl^n \).
By previous case we already know \( \txid \in \Tx(\mkvs, \vi) \cup \T'_\rd \).
Finally the new abstract execution preserves the invariant \( I_1 \) and \( I_2 \) 
because  \( \CC \) satisfies \( \MW \) and \( \RYW \).
The proofs are the same as those in \cref{sec:sound-complete-mr} and \cref{sec:sound-complete-ryw}.

The execution test $\ET_\CC$ is complete with respect to the axiomatic specification 
\( (\RP_{\LWW}, \Set{\lambda \aexec. \VIS_{\aexec} ; \VIS_{\aexec}, \lambda \aexec \ldotp \SO_\aexec })\).

For \( \MRd \), since \(  \VIS_\aexec ; \SO_\aexec \subseteq  \VIS_\aexec ; \VIS_{\aexec} \subseteq \VIS_\aexec \),
the proof is as the same proof as in \cref{sec:sound-complete-mw}.
For \( \MW \), since \( \SO_\aexec ; \VIS_\aexec \subseteq  \VIS_\aexec ; \VIS_{\aexec} \subseteq \VIS_\aexec \),
the proof is as the same proof as in \cref{sec:sound-complete-mw}.
For \( \RYW \), since \( \SO_\aexec \subseteq \VIS_\aexec \),
the proof is as the same proof as in \cref{sec:sound-complete-ryw}.
For \( \WFR \), since \( \WR_\aexec ; \SO_\aexec? ; \VIS_\aexec \subseteq \VIS_\aexec ; \VIS_{\aexec}? ; \VIS_\aexec \subseteq \VIS_\aexec \),
the proof is as the same proof as in \cref{sec:sound-complete-wfr}.


\subsection{\( \UA \)}
\label{sec:sound-complete-ua}

Given abstract execution \( \aexec \), we define write-write relation for a key \( \ke \) as the following:
\[ 
    \WW(\aexec,\ke) \defeq \Setcon{(\txid, \txid')}{\txid \toEdge{\AR_\aexec} \txid' \land (\otW,\ke, \stub ) \in \txid \land (\otW,\ke, \stub ) \in \txid'  } 
\]
Then, the notation \( \WW_\aexec \defeq \bigcup\limits_{\ke \in \Keys} \WW(\aexec, \ke) \).
Note that for a key-value store \( \mkvs \) such that \( \mkvs = \mkvs_\aexec \),
by the definition of  \(  \mkvs = \mkvs_\aexec \), 
the following holds:
\[
    \WW_\aexec = \Setcon{(\txid, \txid')}{\exsts{\ke, i,j } \txid = \WTx(\mkvs(\ke, i)) \land \txid' = \WTx(\mkvs(\ke, j)) \land i < j}
\]

The execution test $\ET_\UA$ is sound with respect to the axiomatic specification 
\[ 
    (\RP_{\LWW}, \Set{\lambda \aexec. \WW_\aexec })
\]
We pick the invariant as \( I( \aexec, \cl ) = \emptyset \), given the fact of no constraint on the view after update.
Assume a key-value store \( \mkvs \) and its corresponding abstract execution \( \aexec \) so that \( \mkvs = \mkvs_\aexec \).
Given an update on the key-value store that satisfies \( \UA \), \ie \(\ET_\UA \vdash (\mkvs, \vi) \csat \f : \vi' \),
by the \cref{def:et_sound}, it remains to prove the following:
\[
    \begin{array}{@{}l@{}}
        \fora{ \aexec', \txid, \txid', \ke } 
        \aexec' = \extend(\aexec, \txid, \Tx(\mkvs, \vi), \f ) 
        \land \txid', \txid \in \WW_\aexec' 
        \implies \txid' \in \Tx(\mkvs, \vi)
    \end{array}
\]
Given a new transaction \( \txid \) and some transaction \( \txid' \),
assume both of them write to a key \( \ke \), and \( \txid' \toEdge{\AR_{\aexec'}} \txid \).
We have \( \WTx(\mkvs(\ke, i)) = \txid \) for some index \( i \).
By the execution test of \( \UA \), we know \( i \in \vi(\ke) \) therefore \( \txid' \in \Tx(\mkvs, \vi) \).

The execution test $\ET_\UA$ is complete with respect to the axiomatic specification 
\[ 
    (\RP_{\LWW}, \Set{\lambda \aexec. \WW_\aexec })
\]
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
It is sufficient to prove the following:
\[
    \ET_\UA \vdash ( \mkvs_{\cut(\aexec, i-1)}, \vi_i ) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i}
\]
for some \( \vi'_i \) such that \( \vi' \subseteq (\AR^{-1}_\aexec)?(\txid_i) \).
By the constraint of \( \aexec \), 
for any transaction \( \txid \) that writes to the same key as \( \txid_i \) and committed before \( \txid_i \), 
they are included in the visible set \(\txid \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
Note that \( \txid \toEdge{\AR_\aexec} \txid_i \iff \txid \in \mkvs_{\cut(\aexec,i-1)}\).
It means 
\[ 
    \fora{\ke, i} \mkvs_{\cut(\aexec,i-1)}(\ke, i) \text{ is defined } \land  (\otW, \ke, \stub) \in \TtoOp{\T}_\aexec(\txid_i) \implies i \in \vi_i(\ke)
\]
thus we have the proof.

\subsection{ \( \CP \) }
An abstract execution \( \aexec \) satisfies consistency prefix (\(\CP\)), 
if it satisfies \( \AR_\aexec ; \VIS_\aexec \subseteq \VIS_\aexec \) and \( \SO_\aexec \subseteq \VIS_\aexec \).
Given the specification, there is a corresponding specification on dependency graph by solve the following inequalities:
\[
    \begin{array}{@{}l@{}}
        \WR \subseteq \VIS \\
        \WW \subseteq \AR \\
        \VIS \subseteq \AR \\
        \VIS ; \RW \subseteq \AR \\
        \AR ; \AR \subseteq \AR  \\
        \SO \subseteq \VIS \\
        \AR ; \VIS \subseteq \VIS
    \end{array}
\]
By solving the inequalities the visibility and arbitration relations are:
\[
    \begin{rclarray}
        \AR & \defeq & \left( (\SO \cup \WR ) ; \RW? \cup \WW \cup R \right)^+ \\
        \VIS & \defeq & \left( (\SO \cup \WR ) ; \RW? \cup \WW \cup R \right)^* ; (\SO \cup \WR )
    \end{rclarray}
\]
for some relation \( R \subseteq \AR \).
When \( R = \emptyset \), it is the smallest solution therefore the minimum visibility required.

Then, to prove soundness and completeness of \( \ET_\CP \), it is sufficient to use the specification:
\[
    (\RP_{\LWW}, \Set{\lambda \aexec. \left( (\SO \cup \WR ) ; \RW? \cup \WW \right)^* ; \VIS_\aexec, \lambda \aexec \ldotp \SO_\aexec }) 
\]
Now recall the specification on key-value store for \( \CP \):
\[
    \Setcon{(\mkvs, \vi, \f, \vi')}{\ddagger}  \cap \MRd \cap \RYW
\]
where the \( \ddagger \) (and auxiliary relation under key-value store \( \mkvs\)) is defined as the following:
\[
    \begin{rclarray}
        \func{RW^{-1}}{\mkvs, \ke, i} & \defeq & \Setcon{\txid}{\exsts{ j \leq i } \txid \in \RTx(\mkvs(\ke,j))} \\
        \ddagger & \equiv &
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, \ke', i, j, m, \txid, \txid', \txid''} \\
            \left( \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \land {} \\
            \quad \left(
                \begin{array}{@{}l @{}}
                    \left( \begin{array}{@{}l@{}}
                        \txid' \in \func{SO^{-1}}{\txid}
                        \land \txid' \in \Set{\WTx(\mkvs(\ke',j))} \cup  \RTx(\mkvs(\ke',j))
                    \end{array} \right)  \lor {} \\
                    \left( \begin{array}{@{}l@{}}
                            \txid \in \RTx(\mkvs(\ke',j)) \land \txid' = \WTx(\mkvs(\ke',j))
                    \end{array} \right)
                    \end{array} \right) 
                \end{array}
                \right)  \\
                {} \lor \left( \begin{array}{@{}l@{}}
                        i \in \vi(\ke) \land \ke = \ke' \land j < i
                \end{array} \right) \\
                \qquad \implies j \in \vi(\ke') 
        \end{array} \\
    \end{rclarray}
\]

For the soundness, we pick the invariant as the following:
\[  
\begin{rclarray}
    I_1(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \right) \setminus \T_\rd \\
    I_2(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \right) \setminus \T_\rd
\end{rclarray}
\]
where \( \T_\rd \) is all the read-only transactions included in both 
\( \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \right)\) 
and \( \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \right) \).
Suppose a kv-store \( \mkvs \), an abstract execution \( \aexec \) and a view \( \vi \)
such that \( \mkvs_\aexec = \mkvs \) and \( I_1(\aexec, \cl) \cup I_2(\aexec, \cl) \subseteq \Tx(\mkvs, \vi) \).
Assume that a fresh transaction identifier \( \txid_\cl^n \) with fingerprint \( \f \) commits to 
the kv-store \( \mkvs \) under view \( \vi \) and the view after is updated to \( \vi' \), that is, 
\( \ET_\CP \vdash (\mkvs, \vi) \csat \f : \vi' \).
Let a new abstract execution \( \aexec' = \extend(\aexec, \txid_\cl^n, \f, \Tx(\mkvs, \vi) \cup \T_\rd) \).
We are about to prove there exists an extra set of read-only transaction \( \T'_\rd \) such that:
\begin{gather}
    \fora{\txid} (\txid, \txid_\cl^n) \in \SO_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:cp-sound-update-so}\\
    \fora{\txid} (\txid, \txid_\cl^n) \in \left( (\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'} \right)^* ; \VIS_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:cp-sound-update-arvis}\\
    I_1(\aexec',\cl) \cup I_2(\aexec',\cl) \subseteq \Tx(\mkvs_{\aexec'}, \vi') \label{equ:cp-sound-inv} 
\end{gather}
the invariant \( I_2 \) implies the \cref{equ:cp-sound-update-so} where the proof is the same as in \cref{sec:sound-complete-ryw}.
For \cref{equ:cp-sound-update-arvis}, it is sufficient to prove one step inclusion, \ie
\[
    \fora{\txid} (\txid, \txid_\cl^n) \in \left( (\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'} \right) ; \VIS_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd 
\]
To prove above, let \( \T'_\rd \) initially be empty set.
We will add more read-only transactions until it satisfies \cref{equ:cp-sound-update-arvis}.
Assume a transaction \( \txid \) such that 
\( (\txid, \txid_\cl^n) \in \left( (\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'} \right) ; \VIS_{\aexec'}\).
There exists a transaction \( \txid' \) such that \( \txid \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'}} \txid' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n \).
It follows \( \txid'  \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd  \).
There are two cases: \textbf{(i)} \( \txid' \) writes to at least a key; \textbf{(ii)} \( \txid' \) is a read-only transaction.
\begin{itemize}
    \item
    If \( \txid' \) writes to at least a key, then \( \txid' \in \Tx(\mkvs, \vi)\).
    By the \( \ddagger \) constraint, \( \txid \in \Tx(\mkvs, \vi)\) if it contains write,
    otherwise we add \( \txid \) into the \( \T'_\rd \).
    \item 
    if \( \txid' \) is a read-only transaction, then either \( \txid' \in \T_\rd \) or \( \txid' \in \T'_\rd \).
    More specifically we have three cases: \textbf{(i)} \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \), \textbf{(ii)} \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \) or \textbf{(iii)} \( \txid' \in \T'\_\rd\).
    \begin{itemize}
        \item
        Assume \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \).
        It means \( \txid' \) is visible for some previous transaction \( \txid_\cl^m \) (\( m < n \)) from the same client \( cl \), 
        \ie \( \txid \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'}} \txid' \toEdge{\VIS_{\aexec'}}  \txid_\cl^m \).
        Note that all the edges before \( \txid_\cl^m \) must exist in \( \aexec \).
        Since \( \aexec \) satisfies the \( \left( (\SO \cup \WR ) ; \RW? \cup \WW \right)^* ; \VIS_\aexec \subseteq \VIS_\aexec \),
        we have \( \txid \toEdge{\VIS_{\aexec'}} \txid_\cl^m \), and then \( \txid \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl)\).
        It means \( \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \).
    \item 
    Assume  \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \SO_{\aexec}^{-1}(\txid^i_\cl) \)
    Since \( \txid' \) is a read-only transaction, 
    the edges can be simplified to \( \txid \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} )} \txid' \toEdge{\SO_{\aexec'}}  \txid_\cl^n \)
    Given that \( \SO \) is transitive, then  either \( \txid \toEdge{\SO_{\aexec'}} \txid_\cl^n \) or \( \txid \toEdge{\WR_{\aexec'} } \txid' \toEdge{\SO_{\aexec'}}  \txid_\cl^n \).
    For the first case, \( \txid \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \SO_{\aexec}^{-1}(\txid^i_\cl) = \Tx(\mkvs, \vi) \cup \T_\rd \).
    For the second case, the \( \WR \) edge must exists before update.
    Because \( \WR_\aexec \subseteq \VIS_\aexec \) then  \( \txid \toEdge{\VIS_{\aexec} } \txid' \toEdge{\SO_{\aexec'}}  \txid_\cl^n  \).
    It means \( \txid \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) = \Tx(\mkvs, \vi) \cup \T_\rd \).
    \item 
    Last, assume \( \txid' \in \T'_\rd \).
    Since \( \T'_\rd \) initially is empty set, there exists another write transaction \( \txid'' \) such that:
    \[
        \txid \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'}} \txid' \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \cup \WW_{\aexec'}} \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n
    \]
    Given that \( \txid' \) is a read-only and \( \txid'' \) has write, the edges can be simplified:
    \[
        \txid \toEdge{(\SO_{\aexec'} \cup \WR_{\aexec'} )} \txid' \toEdge{\SO_{\aexec'} ; \RW_{\aexec'}?} \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n
    \]
    Because transitivity of  \( \SO \), we have the following two cases:
    \[
        \begin{array}{@{}l@{}}
            \txid \toEdge{ \WR_{\aexec'} } \txid' \toEdge{\SO_{\aexec'} ; \RW_{\aexec'}?} \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n \\
            \txid \toEdge{\SO_{\aexec'} ; \RW_{\aexec'}?} \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n 
        \end{array}
    \]
    for both cases, if \( \txid \) has write, by \( \ddagger \), then \( \txid \in \Tx(\mkvs, \vi) \).
    Otherwise we add \( \txid \) into \(\T'_\rd \).
    \end{itemize}
\end{itemize}
Since \( \CP \) satisfies \( \RYW \) and \( \MRd \), thus invariants \( I_1 \) and  \( I_2 \) are preserved after update.
    
For completeness,
Since \( \SO_\aexec \subseteq \VIS_\aexec  \), the prove for \( \ET_\RYW \) is the as in \cref{sec:sound-complete-mr}.
For any \( \VIS_\aexec \)  satisfies the constraint for \( \CP \), it satisfies that 
\[
    \VIS \defeq \left( (\SO \cup \WR ) ; \RW? \cup \WW \cup R \right)^* ; (\SO \cup \WR )
\]
for some relation \( R \).
It means \( \VIS_\aexec ; \SO_\aexec \subseteq \VIS_\aexec \).
Therefore it is complete with respect to \( \ET_\MRd \).
Let consider the \( \ddagger \).
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
We need to prove there exists \( \vi'_i \) such that 
\( \ET_\CP \vdash ( \mkvs_{\cut(\aexec, i-1)}, \vi_i ) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i} \).
Recall the \( \ddagger \):
\[
    \begin{rclarray}
        \ddagger & \equiv &
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, \ke', i, j, m, \txid, \txid', \txid''} \\
            \left( \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \land {} \\
            \quad \left(
                \begin{array}{@{}l @{}}
                    \left( \begin{array}{@{}l@{}}
                        \txid' \in \func{SO^{-1}}{\txid}
                        \land \txid' \in \Set{\WTx(\mkvs(\ke',j))} \cup  \RTx(\mkvs(\ke',j))
                    \end{array} \right)  \lor {} \\
                    \left( \begin{array}{@{}l@{}}
                            \txid \in \RTx(\mkvs(\ke',j)) \land \txid' = \WTx(\mkvs(\ke',j))
                    \end{array} \right)
                    \end{array} \right) 
                \end{array}
                \right)  \\
                {} \lor \left( \begin{array}{@{}l@{}}
                        i \in \vi(\ke) \land \ke = \ke' \land j < i
                \end{array} \right) \\
                \qquad \implies j \in \vi(\ke') 
        \end{array} \\
    \end{rclarray}
\]
Assume \( j \in \vi_i(\ke) \) for some key \(\ke \) and index \( i \).
It means the writer  of the version is visible by the transaction \( \txid_i\),
\ie \( \WTx(\mkvs(\ke,i)) \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
We need to prove the following:
\begin{gather}
    \label{equ:cp-complete-arvis}
    \begin{rclarray}
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, \ke', i, j, \txid, \txid'} \\
            \left( \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \WTx(\mkvs(\ke,i)) \in \VIS_\aexec^{-1}(\txid_i)
            \land \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \land {} \\
            \quad \left(
                \begin{array}{@{}l @{}}
                    \left( \begin{array}{@{}l@{}}
                        \txid' \in \func{SO^{-1}}{\txid}
                        \land \txid' \in \Set{\WTx(\mkvs(\ke',j))} \cup  \RTx(\mkvs(\ke',j))
                    \end{array} \right)  \lor {} \\
                    \left( \begin{array}{@{}l@{}}
                            \txid \in \RTx(\mkvs(\ke',j)) \land \txid' = \WTx(\mkvs(\ke',j))
                    \end{array} \right)
                    \end{array} \right) 
                \end{array}
                \right)  \\
                {} \lor \left( \begin{array}{@{}l@{}}
                        i \in \vi(\ke) \land \ke = \ke' \land j < i
                \end{array} \right) \\
                \qquad \implies \WTx(\mkvs(\ke',j)) \in \VIS_\aexec^{-1}(\txid_i)
        \end{array} \\
    \end{rclarray}
\end{gather}
Note that \( \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \) 
means \( \txid \toEdge{\RW_{\aexec}?} \WTx(\mkvs(\ke,i)) \),
the formulae \(\left( \begin{array}{@{}l@{}} \txid \in \RTx(\mkvs(\ke',j)) \land \txid' = \WTx(\mkvs(\ke',j)) \end{array} \right) \) 
means \( \txid \toEdge{\WR_\aexec} \txid' \),
and \( \left( \begin{array}{@{}l@{}} \txid = \WTx(\mkvs(\ke',m)) \land \txid' = \WTx(\mkvs(\ke',j)) \land m > j \end{array} \right) \) 
means \( \txid \toEdge{\WW_\aexec} \txid' \).
The \cref{equ:cp-complete-arvis} holds, if the following holds:
\[
    \begin{rclarray}
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, \ke', i, j, \txid, \txid'} \\
            \left( \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \WTx(\mkvs(\ke,i)) \in \VIS_\aexec^{-1}(\txid_i) \\
            {} \land \txid' = \WTx(\mkvs(\ke',j))
            \land \txid \toEdge{\RW_{\aexec}?} \WTx(\mkvs(\ke,i)) \land {} \\
            \left(
                \begin{array}{@{}l @{}}
                    \txid' \toEdge{\WR_\aexec ; \SO_\aexec}\txid \lor
                    \txid' \toEdge{\SO_\aexec}\txid \lor
                    \txid' \toEdge{\WR_\aexec}\txid
                    \end{array} \right) 
                \end{array}
                \right)  \\
                {} \lor \txid' \toEdge{\WW_\aexec} \WTx(\mkvs(\ke,i)) \\
                \qquad \implies \txid' \in \VIS_\aexec^{-1}(\txid_i)
        \end{array} \\
    \end{rclarray}
\]
The above holds, if the following holds:
\begin{gather}
    \label{equ:cp-complete-arvis-2}
    \begin{rclarray}
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, i, \txid} \\
            \left( \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \WTx(\mkvs(\ke,i)) \in \VIS_\aexec^{-1}(\txid_i) \\
            {} \land \txid \toEdge{( (\WR_\aexec; \SO_\aexec) \cup \SO_\aexec \cup \WR_\aexec) ; \RW_{\aexec}? \cup \WW_\aexec} \WTx(\mkvs(\ke,i)) 
                \end{array}
                \right)  \\
                \qquad \implies \txid \in \VIS_\aexec^{-1}(\txid_i)
        \end{array} \\
    \end{rclarray}
\end{gather}

By \( \left( (\SO \cup \WR ) ; \RW? \cup \WW \right)^* ; \VIS_\aexec \subseteq \VIS_\aexec \),
It implies \cref{equ:cp-complete-arvis-2}, and then \cref{equ:cp-complete-arvis} holds.


\subsection{\(\PSI\)}


\subsection{\( \SI \)}
Given abstract execution \( \aexec \), we define write-write read-write relation:
\[
    \RW(\aexec,\ke) \defeq \Setcon{(\txid, \txid')}{\txid \toEdge{\AR_\aexec} \txid' \land (\otR,\ke, \stub ) \in \txid \land (\otW,\ke, \stub ) \in \txid'  } 
\]
Note that it is easy to see \( \RW(\aexec,\ke) \)  can be derived from \( \WW(\aexec,\ke) \) and \( \WR(\aexec, \ke ) \) as the following:
\[
    \RW(\aexec,\ke) = \Setcon{(\txid, \txid')}{ \exsts{\txid'' } (\txid'', \txid) \in \WR(\aexec, \ke) \land (\txid'', \txid') \in \WW(\aexec, \ke) }
\]
Then, the notation \( \RW_\aexec \defeq \bigcup\limits_{\ke \in \Keys} \RW(\aexec, \ke) \).
Note that for a key-value store \( \mkvs \) such that \( \mkvs = \mkvs_\aexec \),
by the definition of  \(  \mkvs = \mkvs_\aexec \), 
the following holds:
\[
    \RW_\aexec = \Setcon{(\txid, \txid')}{\exsts{\ke, i,j } \txid \in \RTx(\mkvs(\ke, i)) \land \txid' = \WTx(\mkvs(\ke, j)) \land i < j}
\]

The specification for \( \SI \) is \( (\RP_{\LWW}, \Set{\lambda \aexec. \AR_\aexec ; \VIS_\aexec, \lambda \aexec \ldotp \SO_\aexec, \lambda \aexec \ldotp \WW_\aexec }) \).
By \cite{cerone:snapshot}, for any \( \aexec \) satisfies the \( \SI \),
there exists a minimum visibility \( \VIS_{\aexec}' \subseteq \VIS_\aexec \) satisfying 
\[ (\RP_{\LWW}, \Set{\lambda \aexec. \left( (\SO_\aexec \cup \WW_\aexec \cup \WR_\aexec ) ; \RW_\aexec? \right)^+ ; \VIS'_\aexec, \lambda \aexec \ldotp (\WW_\aexec \cup \SO_\aexec) }) \]
Under the minimum visibility \( \VIS' \) all the transactions still have the same behaviour as before,
meaning they do not violate last-write-win.
Recall the specification on key-value store for \( \SI \):
\[
    \Setcon{(\mkvs, \vi, \f, \vi')}{\dagger}  \cap \UA \cap \MRd \cap \RYW
\]
where the \( \dagger \) (and auxiliary relation under key-value store \( \mkvs\)) is defined as the following:
\[
    \begin{rclarray}
        \func{RW^{-1}}{\mkvs, \ke, i} & \defeq & \Setcon{\txid}{\exsts{ j \leq i } \txid \in \RTx(\mkvs(\ke,j))} \\
        \dagger & \equiv &
        \begin{array}[t]{@{}l@{}}
            \fora{\ke, \ke', i, j, m, \txid, \txid', \txid''} \\
            \begin{array}{@{}l@{}}
            i \in \vi(\ke) 
            \land \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \land {} \\
            \quad \left(
                \begin{array}{@{}l @{}}
                    \left( \begin{array}{@{}l@{}}
                        \txid' \in \func{SO^{-1}}{\txid}
                        \land \txid' \in \Set{\WTx(\mkvs(\ke',j))} \cup  \RTx(\mkvs(\ke',j))
                    \end{array} \right)  \lor {} \\
                    \left( \begin{array}{@{}l@{}}
                        \txid \in \RTx(\mkvs(\ke',j)) 
                        \land \txid' = \WTx(\mkvs(\ke',j))
                    \end{array} \right) \lor {} \\ 
                    \left( \begin{array}{@{}l@{}}
                        \txid = \WTx(\mkvs(\ke',m)) 
                        \land \txid' = \WTx(\mkvs(\ke',j)) \land m > j
                    \end{array} \right) 
                \end{array}
                \right)  \\
            \qquad \implies j \in \vi(\ke') 
            \end{array}
        \end{array} \\
    \end{rclarray}
\]

To prove the soundness, we pick the invariant as the following:
\[  
\begin{rclarray}
    I_1(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \right) \setminus \T_\rd \\
    I_2(\aexec, \cl) & = & \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \right) \setminus \T_\rd
\end{rclarray}
\]
where \( \T_\rd \) is all the read-only transactions included in both 
\( \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \right)\) 
and \( \left( \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \right) \).
Suppose a kv-store \( \mkvs \), an abstract execution \( \aexec \) and a view \( \vi \)
such that \( \mkvs_\aexec = \mkvs \) and \( I_1(\aexec, \cl) \cup I_2(\aexec, \cl) \subseteq \Tx(\mkvs, \vi) \).
Assume that a fresh transaction identifier \( \txid_\cl^n \) with fingerprint \( \f \) commits to 
the kv-store \( \mkvs \) under view \( \vi \) and the view after is updated to \( \vi' \), that is, 
\( \ET_\SI \vdash (\mkvs, \vi) \csat \f : \vi' \).
Let a new abstract execution \( \aexec' = \extend(\aexec, \txid_\cl^n, \f, \Tx(\mkvs, \vi) \cup \T_\rd) \).
We are about to prove there exists an extra set of read-only transaction \( \T'_\rd \) such that:
\begin{gather}
    \fora{\txid} (\txid, \txid_\cl^n) \in \SO_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:si-sound-update-so}\\
    \fora{\txid} (\txid, \txid_\cl^n) \in \WW_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:si-sound-update-ww}\\
    \fora{\txid} (\txid, \txid_\cl^n) \in \left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) ; \VIS_{\aexec'} \implies \txid \in \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \label{equ:si-sound-update-arvis}\\
    I_1(\aexec',\cl) \cup I_2(\aexec',\cl) \subseteq \Tx(\mkvs_{\aexec'}, \vi') \label{equ:si-sound-inv} 
\end{gather}
The invariant \( I_2 \) implies \cref{equ:si-sound-update-so} as the same in \cref{sec:sound-complete-ryw}.
Since \( \SI \) also satisfies \( \UA \), the \cref{equ:si-sound-update-ww} can be proven as the same in \cref{sec:sound-complete-ua}.
Note that for \cref{equ:si-sound-update-arvis}, it is sufficient to prove one step instead of transitive 
because \( \VIS_{\aexec'}(\txid_\cl^n) =  \Tx(\mkvs, \vi) \cup \T_\rd \cup \T'_\rd \).
To prove \cref{equ:si-sound-update-arvis}, 
let \( \T'_\rd \) initially be empty set.
More read-only transactions will be added in until \cref{equ:si-sound-update-arvis} holds.
Assume a transaction \( \txid \) such that \( (\txid, \txid_\cl^n) \in \left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) ; \VIS_{\aexec'} \).
It means \( (\txid \toEdge{\left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) } \txid' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n \) for some transaction \( \txid' \).
There are two cases: \textbf{(i)} \( \txid' \) writes to at least one key; \textbf{(ii)} \( \txid' \) is read-only.
\begin{itemize}
\item For the first case, assume that the transaction \( \txid' \) writes to a key \( \ke \).
It means \(  \txid' \in \Tx(\mkvs, \vi) \), 
and therefore \( i \in \vi(\ke) \) where \( \txid' \) is the writer of the i-\emph{th} version, \ie \( \txid' = \WTx(\mkvs(\ke, i)) \).
By the \( \dagger \) it is easy to see \( \txid \in \Tx(\mkvs,\vi) \) if \( \txid \) has write,
otherwise \( \txid \) is a read-only transaction and will be added into \( \T'_\rd \).
\item For the second case where \( \txid' \) is read-only transaction, we know \( \txid' \in \T_\rd \) or \( \txid' \in \T'_\rd \).
    \begin{itemize}
    \item If \( \txid' \in \T_\rd \), it means \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \) or  \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \).
        \begin{itemize}
        \item Assume \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} \VIS_{\aexec}^{-1}(\txid^i_\cl) \).
            There exist a previous transaction from the same client \( \txid_\cl^m\) such that \( m < n \) and \( \txid \toEdge{\left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) } \txid' \toEdge{\VIS_{\aexec'}}  \txid_\cl^m \).
            Since those edges already exists in the abstract execution before update, \( \aexec\), and by the constraints of \( \aexec \) we have \( \txid \toEdge{\VIS_{\aexec'}} \txid_\cl^m\).
            Therefore by the invariant \( I_1 \), either \( \txid \in \Tx(\mkvs, \vi) \) if \( \txid \) has writes, otherwise \(\txid \in \T_\rd \).
        \item Assume \( \txid' \in \bigcup\limits_{\{\txid_{\cl}^{i} \in \T_{\aexec} \mid i \in \Nat\}} (\SO_{\aexec}^{-1})?(\txid^i_\cl) \).
            Note that  \( \txid' \) is a read-only transaction.
            Therefore \( \txid \toEdge{\left( \SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'}  \right)} \txid_\cl^m \toEdge{\SO_{\aexec'}}  \txid_\cl^n \) for some \( m \) such that \( m < n \).
            The path from \( \txid \) to \( \txid_\cl^m \) must exist in the abstract execution before update and they satisfy the constraint, so \( \txid \toEdge{\VIS_\aexec} \txid_\cl^m \).
            Therefore by the invariant \( I_1 \), either \( \txid \in \Tx(\mkvs, \vi) \) if \( \txid \) has writes, otherwise \(\txid \in \T_\rd \).
        \end{itemize}
    \item If \( \txid' \in \T'_\rd \), given that \( \T'_\rd \) initially is empty, there is anther transaction \( \txid'' \) that has at least a write such that:
        \[
            \txid \toEdge{\left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) } \txid' \toEdge{\left( (\SO_{\aexec'} \cup \WW_{\aexec'} \cup \WR_{\aexec'} ) ; \RW_{\aexec'}? \right) } \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n 
        \]
        By the fact that \( \txid' \) is read-only and \( \txid'' \) has write, it follows:
        \[
            \txid \toEdge{\left( \SO_{\aexec'} \cup \WR_{\aexec'} \right) } \txid' \toEdge{\left( \SO_{\aexec'} ; \RW_{\aexec'}? \right) } \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n 
        \]
        Let first consider no \( \RW \), \ie  \( \txid \toEdge{\left( \SO_{\aexec'} \cup \WR_{\aexec'} \right) } \txid' \toEdge{\SO_{\aexec'} } \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n  \).
        Since \( \SO \) is transitive, we have the following two cases:
        \[
            \begin{array}{@{}c@{}}
                \txid \toEdge{\WR_{\aexec'} } \txid' \toEdge{\SO_{\aexec'} ; \RW_{\aexec'}? } \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n  \\
                \txid \toEdge{\SO_{\aexec'} ; \RW_{\aexec'}? } \txid'' \toEdge{\VIS_{\aexec'}}  \txid_\cl^n 
            \end{array}
        \]
        for both cases, if \( \txid \) has write, by \( \dagger \), then \( \txid \in \Tx(\mkvs, \vi) \).
        Otherwise we add \( \txid \) into \(\T'_\rd \).
    \end{itemize}
\end{itemize}
Since \( \SI \) satisfies \( \RYW \) and \( \MRd \), thus invariants \( I_1 \) and  \( I_2 \) are preserved after update.

To prove completeness, 
It is easy to see it is complete with respect to \( \UA \) and \( \RYW \) as \( \WW \cup \SO \subseteq \VIS \).
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
We need to prove there exists \( \vi'_i \) such that 
\( \ET_\SI \vdash ( \mkvs_{\cut(\aexec, i-1)}, \vi_i ) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i} \).
Let first consider if \( \vi_i \) satisfies the constraint of the execution test \( \ET_\SI \).
Assume \( j \in \vi_i(\ke) \) for some key \(\ke \) and index \( i \).
It means the writer  of the version is visible by the transaction \( \txid_i\),
\ie \( \WTx(\mkvs(\ke,i)) \in \VIS^{-1}_{\aexec}(\txid_{i}) \).
Now we need to prove the following:
\begin{gather}
    \label{equ:si-complete-arvis}
    \begin{array}{@{}l@{}}
        \fora{\ke, \ke', i, j, m, \txid, \txid', \txid''} \\
        \begin{array}{@{}l@{}}
        i \in \vi(\ke) 
        \land \WTx(\mkvs(\ke,i)) \in \VIS^{-1}_{\aexec}(\txid_{i}) 
        \land \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \land {} \\
            \quad \left(
                \begin{array}{@{}l @{}}
                    \left( \begin{array}{@{}l@{}}
                        \txid' \in \func{SO^{-1}}{\txid}
                        \land \txid' \in \Set{\WTx(\mkvs(\ke',j))} \cup  \RTx(\mkvs(\ke',j))
                    \end{array} \right)  \lor {} \\
                    \left( \begin{array}{@{}l@{}}
                        \txid \in \RTx(\mkvs(\ke',j)) 
                    \end{array} \right) \lor 
                    \left( \begin{array}{@{}l@{}}
                        \txid = \WTx(\mkvs(\ke',m)) 
                        \land m > j
                    \end{array} \right) 
                \end{array}
                \right)  \\
        \qquad \implies \WTx(\mkvs(\ke',j)) \in \VIS^{-1}_{\aexec}(\txid_{i})
        \end{array} 
    \end{array} 
\end{gather}
Note that \( \txid \in \Set{\WTx(\mkvs(\ke,i))} \cup \func{RW^{-1}}{\mkvs, \ke, i} \) 
means \( \txid \toEdge{\RW_{\aexec}?} \WTx(\mkvs(\ke,i)) \),
the formulae \(\left( \begin{array}{@{}l@{}} \txid \in \RTx(\mkvs(\ke',j)) \land \txid' = \WTx(\mkvs(\ke',j)) \end{array} \right) \) 
means \( \txid \toEdge{\WR_\aexec} \txid' \),
and \( \left( \begin{array}{@{}l@{}} \txid = \WTx(\mkvs(\ke',m)) \land \txid' = \WTx(\mkvs(\ke',j)) \land m > j \end{array} \right) \) 
means \( \txid \toEdge{\WW_\aexec} \txid' \).
So \cref{equ:si-complete-arvis} holds if the following holds:
\[
    \begin{array}{@{}l@{}}
        \fora{\ke, \ke', i, j, \txid, \txid'} \\
        \left( \begin{array}{@{}l@{}}
        i \in \vi(\ke) 
        \land \WTx(\mkvs(\ke,i)) \in \VIS^{-1}_{\aexec}(\txid_{i}) 
        \land \txid' = \WTx(\mkvs(\ke',j)) \\
        {} \land \txid \toEdge{\RW_{\aexec}?} \WTx(\mkvs(\ke,i))  \land {} 
        \left(
        \begin{array}{@{}l @{}}
            \txid' \toEdge{\SO_\aexec} \txid \lor
            \txid' \toEdge{\WR_\aexec ; \SO_\aexec} \txid \lor
            \txid' \toEdge{\WR_\aexec} \txid \lor
            \txid' \toEdge{\WW_\aexec} \txid 
        \end{array}
        \right)  \\
        \qquad \implies \txid' \in \VIS^{-1}_{\aexec}(\txid_{i})
        \end{array} \right)
    \end{array} \\
\]
The above holds, if the following holds:
\begin{gather}
    \label{equ:si-complete-arvis-2}
    \begin{array}{@{}l@{}}
        \fora{\ke, i, \txid} \\
        \left( \begin{array}{@{}l@{}}
        i \in \vi(\ke) 
        \land \WTx(\mkvs(\ke,i)) \in \VIS^{-1}_{\aexec}(\txid_{i})  \\
        {} \land \txid \toEdge{(\SO_\aexec \cup (\WR_\aexec ; \SO_\aexec ) \cup \WR_\aexec \cup \WW_\aexec ) ; \RW_{\aexec}?} \WTx(\mkvs(\ke,i))  \\
        \quad \implies \txid \in \VIS^{-1}_{\aexec}(\txid_{i})
        \end{array} \right)
    \end{array} 
\end{gather}
Note that the constraint \( \left( (\SO_{\aexec} \cup \WW_{\aexec} \cup \WR_{\aexec} ) ; \RW_{\aexec}? \right)^* ; \VIS_{\aexec}  \subseteq \VIS_\aexec \) implies the \cref{equ:si-complete-arvis-2}.
Therefore we have the proof for \cref{equ:si-complete-arvis}.

By the \cite{cerone:snapshot}, we know that for any abstract execution that satisfies \( (\WW_\aexec \cup \SO_\aexec) \subseteq \VIS_\aexec \)
and \( \left( (\SO_\aexec \cup \WW_\aexec \cup \WR_\aexec ) ; \RW_{\aexec}? \right) ; \VIS_\aexec \subseteq \VIS_\aexec \),
the visibility relation will have have the following form for some relation \( R \):
\[
    \VIS_\aexec = \left( \left( (\SO_\aexec \cup \WW_\aexec \cup \WR_\aexec ) ; \RW_{\aexec}? \right)  \cup R \right)^* ; (\SO_\aexec \cup \WR_\aexec \cup \WW_\aexec) 
\]
Given above, it is easy to see \( \VIS_\aexec ; \SO_\aexec \subseteq \VIS_\aexec \) since \( \SO \) is transitive, 
thus we have the proof for \( \MRd \) where the detail is in \cref{sec:sound-complete-mr}.


\subsection{ \( \SER \)}

The execution test $\ET_\UA$ is sound with respect to the axiomatic specification 
\[ 
    (\RP_{\LWW}, \Set{\lambda \aexec. \AR })
\]
We pick the invariant as \( I( \aexec, \cl ) = \emptyset \), given the fact of no constraint on the view after update.
Assume a key-value store \( \mkvs \) and its corresponding abstract execution \( \aexec \) so that \( \mkvs = \mkvs_\aexec \).
Given an update on the key-value store that satisfies \( \SER \), \ie \(\ET_\SER \vdash (\mkvs, \vi) \csat \f : \vi' \),
by the \cref{def:et_sound}, it remains to prove that there exists a set of read-only transactions \( \T_\rd \) such that
\[
    \begin{array}{@{}l@{}}
        \fora{ \aexec', \txid, \txid', \ke } 
        \aexec' = \extend(\aexec, \txid, \Tx(\mkvs, \vi) \cup \T_\rd, \f ) 
        \land \txid', \txid \in \WTa(\aexec', \ke) \land  \txid' \toEdge{\AR_{\aexec'}} \txid  \\
        \qquad {} \implies \txid' \in \Tx(\mkvs, \vi) \cup \T_\rd
    \end{array}
\]
Since the abstract execution satisfies the constraint for \( \SER \), \ie \( \AR \subseteq \VIS \), we know \( \AR = \VIS \).
Since \( \Tx(\mkvs, \vi)  \) contains all transactions that write at least a key, 
we can pick a \( \T_\rd \) such that \( \Tx(\mkvs, \vi) \cup \T_\rd = \T_\aexec\),
which gives us the proof.

The execution test $\ET_\UA$ is complete with respect to the axiomatic specification \( (\RP_{\LWW}, \Set{\lambda \aexec. \AR_\aexec }) \).
Suppose that $\T_{\aexec} = \Set{\txid_{i}}_{i=1}^{n}$, and for any $i=1,\cdots, n-1$,
$\txid_{i} \xrightarrow{\AR_{\aexec}} \txid_{i+1}$.
Fix $i=1,\cdots,n$, and let a view $\vi_{i} = \getView(\aexec, \VIS^{-1}_{\aexec}(\txid_{i}))$.
It is sufficient to prove the following:
\[
    \ET_\SER \vdash ( \mkvs_{\cut(\aexec, i-1)}, \vi_i ) \csat \TtoOp{T}_{\aexec}(\txid_{i}) : \vi'_{i}
\]
Because \( \VIS^{-1}(\txid_i) = \AR^{-1}(\txid_i) = \Setcon{\txid }{\txid \texttt{ appears in } \mkvs_{\cut(\aexec, i-1)} }\),
so for any key \( \ke \) and index \( i \) such that \( 0 \leq i < \abs{\mkvs_{\cut(\aexec, i-1)}(\ke)} \),
the i-\emph{th} version of the key contains in the view, \ie \( i \in \vi(\ke)\).

