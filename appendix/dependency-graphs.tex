\section{Proof of Theorem \ref{thm:kv2graphs}}

\begin{proposition}
Let $\hh$ be a well-formed kv-store. Then $\Gr_{\hh}$ is a well-formed dependency graph.
\end{proposition}

Let $\hh$ be a (well-formed) kv-store. We need to show that 
$\Gr_{\hh} = (\TtoOp{T}_{\hh}, \RF_{\hh}, \VO_{\hh}, \AD_{\hh})$ is a well-formed dependency graph. 
As a first step, we show that $\Gr_{\hh}$ is a dependency graph, 
i.e. it satisfies all the constraints placed by \cref{def:dgraph}.

\begin{itemize}
\item Let $\txid \in \dom(\TtoOp{T}_{\hh})$, and suppose that $(\otR, \ke, \val) \in \TtoOp{T}_{\hh}(\txid)$. 
We need to prove that either $\val = \val_{0}$, and there exists no $\txid' \in \dom(\TtoOp{T}_{\hh})$ such that 
$\txid' \xrightarrow{\RF_{\hh}(\ke)} \txid$, or $\txid' \xrightarrow{\RF_{\hh}(\ke)} \txid$ for some 
$\txid' \in \dom(\TtoOp{T}_{\hh})$ such that $(\otW, \ke, \val) \in \TtoOp{T}_{\hh}(\txid')$. 
Because $\txid \in \dom(\TtoOp{T}_{\hh})$, the definition of $\Gr_{\hh}$ (and in particular the 
fact that $\TtoOp{T}_{\hh} : \TxID_{0} \rightharpoonup \powerset{\Ops}$) ensures that 
$\txid \neq \txid_0$. Furthermore, because $(\otR, \ke, \val) \in \TtoOp{T}_{\hh}(\txid)$, there 
must exist an index $i: 0 \leq i < \lvert \hh(\ke) \rvert$ such that $\hh(\ke, i) = (\val, \txid', \{\txid \} \cup \_ )$ 
for some $\txid' \in \TxID$. 
We have two possibilities: 
\begin{enumerate}
\item $i = 0$, in which case the hypothesis that $\hh$ is well-formed ensures that $\txid' = \txid_0$, 
and $\val = \val_0$. We also have that there exists no transaction $\txid''$ such that $\txid'' \xrightarrow{\RF_{\hh}(\ke)} \txid$: 
in fact, by \cref{def:kv2graph}, we have that $\txid'' \xrightarrow{\RF(\ke)} \txid$ if and only if there exists an index 
$j: 0 < j < \lvert \hh(\ke) \rvert$ such that $\hh(\ke, j) = (\_, \txid'', \{\txid\} \cup \_)$. However, in this case we would 
have that $0 < j$, and $\txid \in \RTx(\hh(\ke, j)) \cap \RTx(\hh(\ke, 0))$, contradicting the constraint placed 
over well-formed kv-stores that a transaction never reads multiple versions for a key. Therefore, there exists 
no transaction $\txid''$ such that $\txid'' \xrightarrow{\RF_{\hh}(\ke)} \txid$, 
\item $i > 0$; in this case \cref{def:kv2graph} ensures that $\txid' \xrightarrow{\RF_{\hh}(\ke)} \txid$; also, 
because $\hh(\ke, i) = (\val, \txid', \_)$, it must be the case that $(\otW, \ke, \val) \in \TtoOp{T}_{\hh}(\txid')$.
\end{enumerate}
\item Let $\txid \in \dom(\TtoOp{T}_{\hh})$, and suppose that there exist $\txid_1, \txid_2$ such that 
$\txid_{1} \xrightarrow{\RF_{\ke}(\hh)} \txid$, $\txid_{2} \xrightarrow{\RF_{\ke}(\hh)} \txid$. 
By \cref{def:kv2graph}, there exist two indexes $i, j: 0 < i, j < \lvert \hh(\ke) \rvert$, such that 
$\hh(\ke, i) = (\_, \txid_1, \{\txid\} \cup \_)$, $\hh(\ke, j) = (\_, \txid_2, \{\txid\} \cup \_)$. 
We have that $\txid \in \RTx(\hh(\ke, i)) \cap \RTx(\hh(\ke, j))$, i.e. 
$\RTx(\hh(\ke,i)) \cap \RTx(\hh(\ke, j)) \neq \emptyset$. Because we are assuming 
that $\hh$ is well-formed, then it must be the case that $i = j$. This implies that $\txid_1 = \txid_2$.
\item Let $\cl \in \Clients$, $m, n \in \Nat$ and $\ke \in \Keys$ be such that 
$\txid_{\cl}^{n} \xrightarrow{\RF_{\hh}(\ke)} \txid_{\cl}^{m}$. Then it must be the case that 
there exists an index $i : 0 \leq i < \lvert \hh(\ke) \rvert$ such that $\hh(\ke, i) = 
(\_, \txid_{\cl}^{n}, \{\txid_{\cl}^{m}\} \cup \_)$. Because $\hh$ is well-formed, 
it must be the case that $n < m$.
\item Let $\txid, \txid'$ be such that $\txid' \xrightarrow{\VO_{\ke}(\hh)} \txid$. 
We must show that  $(\otW, \ke, \_) \in \TtoOp{T}_{\hh}(\txid')$, and $(\otW, \ke, \_) \in \TtoOp{T}_{\hh}(\txid)$.
By \cref{def:kv2graph}, there exist $i, j: 0 < i,j < \lvert \hh(\ke) \rvert$ such that 
$\hh(\ke, i) = (\val', \txid', \_)$ and $\hh(\ke, j) = (\val, \txid, \_)$, for some 
$\val, \val' \in \Val$. \cref{def:kv2graph} also ensures that $(\otW, \ke, \val') \in 
\TtoOp{T}_{\hh}(\txid')$, and $(\otW, \ke, \val) \in \TtoOp{T}_{\hh}(\txid)$.
\item Let $\txid, \txid'$ be such that $(\otW, \ke, \_) \in \TtoOp{T}_{\hh}(\txid)$ 
and $(\otW, \ke, \_) \in \TtoOp{T}_{\hh}(\txid')$. We need to prove that 
either $\txid = \txid', \txid \xrightarrow{\VO_{\hh}(\ke)} \txid'$, or $\txid' \xrightarrow{\VO_{\hh}(\ke)} \txid$. 
By \cref{def:kv2graph} there exist two indexes $i, j: 0 < i,j< \lvert \hh(\ke) \rvert$ such that 
$\hh(\ke, i) = (\_, \txid, \_)$ and $\hh(\ke, j) = (\_, \txid', \_)$. If $i = j$, then $\txid = \txid'$ 
and there is nothing left to prove. Otherwise, suppose without loss of generality that 
$i < j$. Then \cref{def:kv2graph} ensures that $\txid \xrightarrow{\VO_{\hh}(\ke)} \txid'$. 
\item Suppose that $\txid_{\cl}^{m} \xrightarrow{\VO_{\hh}(\ke)} \txid_{\cl}^{n}$ for 
some $\cl \in \Clients$ and $m, n \in \Nat$. We need to show that $m < n$. 
By \cref{def:kv2graph}, because  $\txid_{\cl}^{m} \xrightarrow{\VO_{\hh}(\ke)} \txid_{\cl}^{n}$ 
there exist two indexes $i,j: 0 < i,j < \lvert \hh(\ke) \rvert$ such that $\WTx(\hh(\ke,i)) = \txid_{\cl}^{m}$ 
and $\WTx(\hh(\ke, j)) = \txid_{\cl}^{n}$. From the assumption that $\hh$ is well-formed, it 
follows that $n < m$.
\end{itemize}