\section{Proof of Theorem \ref{thm:aexec2kv.compatible}}

Let $\aexec$ be an abstract execution that satisfies the last write wins 
policy.

\begin{lemma}
$\getView(\aexec, \emptyset) = \lambda \ke.\{0\}$.
\end{lemma}

\begin{proof}
$\getView(\aexec, \emptyset)(\ke) = \{0\} \cup \{ i \mid 
\WTx(\hh(\ke, i)) \in \emptyset\} = \{0\} \cup \emptyset = \{0\}$.
\end{proof}
%
%\begin{lemma}
%Let $\txid$ be a read-only transaction in $\aexec$, that is whenever $(O, \_, \_) \in_{\aexec} \txid$, 
%then $O = \otR$. Then $\getView(\aexec, \{\txid\}) = \lambda \ke. \{0\}$.
%\end{lemma}
%
\begin{lemma}
$\getView(\aexec, \{\txid\}) = \lambda \ke. \{0\} \cup \{i \mid 
\WTx(\hh(\ke, i) = \txid\}$
\end{lemma}

\begin{proof}
Immediate from the definition of $\getView$.
\end{proof}

\begin{lemma}
For any $\T_1, \T_2 \subseteq \T_{\aexec}$, $\getView(\aexec, \T_1 \cup \T_2) = 
\getView(\aexec, \T_1) \cup \getView(\aexec, \T_2)$.
\end{lemma}

\begin{proof}
\[
\begin{array}{lr}
\getView(\aexec, \T_1 \cup \T_2)(\ke) = \{ 0 \} \cup \{ i \mid \WTx(\hh(\ke, i)) \in \T_1 \cup \T_2\} &=\\
\{0\} \cup (\{i \mid \WTx(\hh(\ke, i)) \in \T_1\} \cup \{i \mid \WTx(\hh(\ke, i)) \in \T_2\}) &= \\
(\{0\} \cup \{i \mid \WTx(\hh(\ke,i)) \in \T_1\}) \cup \{i \mid \WTx(\hh(\ke, i)) \in \T_2\}) &= \\
\getView(\aexec, \T_1) \cup \getView(\aexec, \T_2).
\end{array}
\]
\end{proof}

\begin{lemma}
Let $\txid_1, \txid_2 \in \T_{\aexec}$. If $\getView(\aexec, \{\txid_1\})(\ke) \cap \getView(\aexec, \{\txid_2\})(\ke) \neq \emptyset$ 
for some $\ke \in \Keys$, then $\txid_1 = \txid_2$.
\end{lemma}

\begin{proof}
Fix $\ke \in \Keys$, and suppose that $i \in \getView(\aexec, \{\txid_1\})(\ke) \cap \getView(\aexec, \{\txid_2\})(\ke)$. 
By definition, $\txid_1 = \WTx(\hh_{\aexec}(\ke, i)) = \txid_2$. 
\end{proof}

\begin{proposition}
For any subset $\T \subseteq \T_{\aexec}$, $\RP_{\LWW}(\aexec, \T) = \{\snapshot(\hh_{\aexec}, \getView(\aexec, \T))\}$.
\end{proposition}

\begin{proof}
Fix $\T \subseteq \aexec$, and let $\{\hh\} = \RP_{\LWW}(\aexec, \T)$. We prove that, for any $\ke \in \Keys$, 
$\hh(\ke) = \snapshot(\getView(\aexec, \T))(\ke)$. We distinguish between two different cases: 
\begin{enumerate}
\item $\T \cap \{ \txid \mid (\otW, \ke, \_) \in_{\aexec} \txid \} = \emptyset$. 
In this case $\hh(\ke) = \val_0$. 
We know that $\graphof(\aexec)$ satisfies all the constraints required by the definition of dependency graph 
(\cite{laws}). Together with \ref{thm:kv2graphs} it follows that $\hh_{\aexec}(\ke, 0) = (\val_0, \txid_0, \_)$.
We prove that $\getView(\aexec, \T)(\ke) = \{0\}$, 
hence 
\[ 
\snapshot(\hh_{\aexec}, \getView(\aexec, \T))(\ke) = \valueOf(\hh_{\aexec}(\ke, 0)) = \val_{0}.
\]
Note that whenever $(\otW, \ke, \_) \in_{\aexec} \txid$ for some $\txid$, then 
$\txid \notin \T$. Therefore, whenever $(\val, \txid, \_) = \hh_{\aexec}(\ke, i)$ for some $i \geq 0$, then 
$\txid \notin \T_{\graphof(\aexec)} = \T_{\aexec}$.
\[
\getView(\aexec, \T)(\ke) = \{0\} \cup \{i \mid \WTx(\hh_{\aexec}(\ke, i)) \in \T)\} = \{0\} \cup \emptyset = \{0\}.
\]
\item Suppose now that $\T \cap \{ \txid \mid (\otW, \ke, \_) \in_{\aexec} \txid \} \neq \emptyset$. 
Let then $\txid = \max_{\AR_{\aexec}}(\T \cap \{\txid \mid (\otW, \ke, \_) \in_{\aexec} \txid\})$. 
Then $(\otW, \ke, \val) \in_{\aexec} \txid$ for some $\val \in \Val$. Furthermore, $\RP_{\LWW}(\aexec, \T)(\ke) = \val$.
By definition, $\txid' \in \T \cap \{ \txid \mid (\otW, \ke, \_) \in_{\aexec} \txid\}$, 
then either $\txid' = \txid$ or $\txid' \xrightarrow{\AR_{\aexec}} \txid$. The definition of 
$\graphof(\aexec)$ gives that $\txid' \xrightarrow{\VO_{\aexec}(\ke)} \txid$. 
Because $(\otW, \ke, \val) \in_{\aexec} \txid$, then there exists an index 
$i \geq 0$ such that $\hh_{\aexec}(\ke, i) = (\val, \txid, \_)$. Furthermore, 
whenever $\WTx(\ke, j) = \txid'$ for some $\txid'$ and $j > i$, then it must 
be the case that $\txid \xrightarrow{\VO_{\aexec}(\ke)} \txid'$, and because 
$\VO_{\aexec}(\ke)$ is transitive and irreflexive, it must be that  
$\neg( \txid' \xrightarrow{\VO_{\aexec}(\ke)} \txid)$ and $\txid \neq \txid'$: this implies that 
$\txid' \notin \T$. It follows that $\max(\getView(\aexec, \T)(\ke)) = i$, hence 
$\snapshot(\hh_{\aexec}, \getView(\aexec, \T)) = \valueOf(\hh_{\aexec}(\ke, i)) = \val$.
\end{enumerate}
\end{proof}