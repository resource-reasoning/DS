Note that our definition of views (\cref{def:views}) is critical to 
the validity of Theorem \cref{thm:kvtrace2aexec}, 
as the following example shows. 

\begin{figure}
\begin{center}
\hrule
\begin{tabular}{@{}c @{\qquad}|@{\qquad} c@{}}
\begin{tikzpicture}[scale=0.85, every node/.style={transform shape}]
%\draw[help lines] grid(6,4);

\node (t1wx) {$(\otW, \key_1, \val_1)$}; 
\path (t1wx.east) + (0.2,0) node[anchor = west] (t1wy) {$(\otW, \key_2, \val_1)$};
\path (t1wx.south east) + (0.1, -1) node[anchor = north] (t2wx) {$(\otW, \key_1, \val_2)$};
\path (t1wy.south east) + (1,-1) node[anchor = north west] (t3rx) {$(\otR, \key_1, \val_2$)};
\path (t3rx.east) + (0,0) node[anchor=west] (t3ry) {$(\otR, \key_2, \val_0)$};

\begin{pgfonlayer}{background}
\node[background, fit=(t1wx) (t1wy)] (t1) {};
\node[background, fit= (t2wx)] (t2) {};
\node[background, fit= (t3rx) (t3ry)] (t3) {};

\path(t1.north) node[anchor=south] (t1lbl) {$\txid_{\cl_1}^{1}$};
\path(t2.south) node[anchor=north] (t2lbl) {$\txid_{\cl_2}^{1}$};
\path(t3.east) node[anchor=west] (t3lbl) {$\txid_{\cl_3}^{1}$};

\path[->]
(t1.south) edge node[right] {$\AR$} (t2.north)
(t2.east) edge node[above] {$\AR, \VIS$} (t3.west);
\end{pgfonlayer}
\end{tikzpicture}
&
\begin{tikzpicture}
\begin{pgfonlayer}{foreground}
%Uncomment line below for help lines
%\draw[help lines] grid(5,4);

%Location x
\node(locx) {$\key_1 \mapsto$};

\matrix(versionx) [version list]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\txid_0$ & {a} & $\txid_{\cl_1}^{1}$ & {a} & $\txid_{\cl_2}^{1}$\\
    {a} & $\emptyset$ & {a} & $\emptyset$ & {a} & $\left\{\txid_{\cl_3}^{1}\right\}$\\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$\val_0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$\val_1$};
\tikzvalue{versionx-1-5}{versionx-2-5}{locx-v2}{$\val_2$};

%Location y
\path (locx.south) + (0,\tikzkeyspace) node (locy) {$\key_2 \mapsto$};
\matrix(versiony) [version list]
   at ([xshift=\tikzkvspace]locy.east) {
 {a} & $\txid_0$ & {a} & $\txid_{\cl_1}^{1}$ \\
  {a} & $\left\{\txid_{\cl_3}^1\right\}$ & {a} & $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$\val_0$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$\val_1$};

\end{pgfonlayer}
\end{tikzpicture}
\end{tabular}
\end{center}
\hrule
\caption{An example of abstract execution and associated kv-store.}
\label{fig:aexec.noncontiguous}
\end{figure}

\begin{example}
\label{ex:badviews}
At an earlier stage of this research, views of kv-stores were defined to include only contiguous sets of versions 
for any key $\key$: that is, for given a kv-store $\mkvs$, we required from a view $\vi \in \Views(\mkvs)$ that 
$\vi(\key) = [i]$ for some $i: 0 < \lvert \mkvs(\key) \rvert$, in addition to the constraints posed by \cref{def:views}. 
In this setting, the most permissive execution test $\ET$ is the following: 
\[
\left(\ET \vdash (\mkvs, \vi) \triangleright \fp : \vi' \right) \iff \forall \key.\;\exists i_{\key}, j_{\key}.\; \vi(\key) = [ i ] \wedge \vi'(\key) = [ j ].
\]

Consider the abstract execution $\aexec$ depicted in Figure \ref{fig:aexec.noncontiguous}, 
and the associated kv-store $\hh_{\aexec}$, depicted to the right in the same Figure.
We argue that $\hh_{\aexec} \notin \CMs(\ET)$. According to \cref{thm:et.normalform} it suffices to prove 
that there exists no $\ET$-trace that is in normal form, and whose last configuration is $(\hh_{\aexec} ,\_)$. 
Suppose that such an $\ET$-trace $\tr$ existed: because we require that the last configuration in $\tr$ is 
$(\hh_{\aexec}, \_)$, then it must be the case that in $\tr$ transaction $\txid_{\cl_1}^{1}$ is executed 
before $\txid_{\cl_2}^{1}$, and the latter is executed before $\txid_{\cl_3}^1$. This is because 
$\txid_{\cl_2}^{1}$ installs a newer version of $\key_1$ than the one read by $\txid_{\cl_2}^1$, 
and $\txid_{\cl_3}^{1}$ reads the version of $\key_1$ installed by $\txid_{\cl_2}^{1}$. Because, 
$\tr$ is in normal form, we have the following: 
\[
\begin{array}{ll}
\tr = & (\hh_{0}, \viewFun_{0}) \xrightarrowtriangle{(\cl_1, \varepsilon)}_{\ET} (\hh_0, \viewFun_0') 
\xrightarrowtriangle{(\cl_1, \fp_1)}_{\ET} (\hh_1, \viewFun_1) \xrightarrowtriangle{(\cl_2, \varepsilon)}_{\ET} \\
& (\hh_1, \viewFun_1') \xrightarrowtriangle{(\cl_2, \fp_2)}_{\ET} (\hh_2, \viewFun_2) \xrightarrowtriangle{(\cl_3, \varepsilon)}_{\ET} 
(\hh_2, \viewFun_2')\xrightarrowtriangle{(\cl_3, \fp_3)}_{\ET} (\hh_3, \viewFun_3),
\end{array}
\]
where $\fp_1 = \{(\otW, \key_1, \val_1), (\otW, \key_2, \val_1)\}$, $\fp_2 = \{(\otW, \key_1, \val_2)\}$, 
$\fp_3 = \{(\otR, \key_1, \val_2), (\otR, \key_2, \val_0)\}$,\\ $\hh_1 = \updateKV(\hh_0, \cl_1, \_, \fp_1)$, 
$\hh_2 = \updateKV(\hh_1, \cl_2, \_, \fp_2)$, and $\hh_3 = \updateKV(\hh_2, \cl_3, \viewFun_2'(\cl_3), \fp_3)$ 
for a suitable $\viewFun_2'$.
Furthermore, we require that $\hh_3 = \hh_{\aexec}$, which is possible only if $\viewFun_2'(\cl_3) = [\key_1 \mapsto [2], \key_2 \mapsto [0] ]$ 
(recall that by definition of $\ET$, it must be that for any key $\key$, $\viewFun_2'(\cl)(\key) = [i_{\key}]$ for some $i_{\key} \geq 0$); 
this is because, in $\hh_3 = \hh_{\aexec}$, transaction $\txid_{\cl}^3$ reads the $2$-nd version of $\key_1$ and the $0$-th version of 
$\key_2$. It remains to note that the view $\viewFun_{2}'(\cl_3)$ is not atomic w.r.t. $\hh_2$, causing a contradiction: 
in fact, we have that $\WTx(\hh_{2}(\key_1, 1) = \txid_{\cl_1}^{1} = \WTx(\hh_2(\key_2, 1))$. However, 
$1 \in \viewFun_{2}'(\cl_3)(\key_1)$, but $1 \notin \viewFun_{2}'(\cl_3)(\key_2)$: the view $\viewFun_{2}'(\cl_3)$ 
contains the update of $\key_1$ performed by $\txid_{\cl_1}^{1}$, but not the update of $\key_2$ performed by the 
same transaction.
\end{example}
