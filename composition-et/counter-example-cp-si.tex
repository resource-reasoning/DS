\subsection{Example: \( \CP \) and \( \SI \) is not commutative}
\label{sec:comm-counter-cp-si}
We should the following counter example why \( \CP \) and \( \SI \) are not commutative.
Let consider an initial kv-store \( \mkvs \) (some writers are omitted):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\stub$ & {a} & $\txid$\\
    {a} & $\emptyset$ & {a} & $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
 {a} & $\stub$ & {a} & $\stub$ \\
  {a} & $\emptyset$ & {a} & $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
Assume two clients, \( \cl_1 \) and \( \cl_2 \), want to read the two keys \( \ke_1 \) and \( \ke_2 \).
Let assume the first client \( cl_1 \) initially has view 
\( \vi_1 = \Set{\ke_1 \mapsto \Set{0}, \ke_2 \mapsto \Set{0}} \)
With the view, we have the fingerprint for the client \( \f_1 = \Set{(\otR, \ke_1,0), (\otR, \ke_2,2)} \),
which leads to the final kv-store \( \mkvs_1 \):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\stub$ & {a} & $\txid$\\
    {a} & $\Set{\txid_1}$ & {a} & $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
 {a} & $\stub$ & {a} & $\stub$ \\
  {a} & $\Set{\txid_1}$ & {a} & $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
Assume the view remains the same afterwards.
It is easy to see \( \ET_\CP \vdash (\mkvs,\vi_1) \csat \f_1 : (\mkvs_1,\vi_1)\), and also for \( \ET_\SI \).

Now for the second client \( \cl_2 \), assume the view 
\( \vi_2 = \Set{\ke_1 \mapsto \Set{0,1}, \ke_2 \mapsto \Set{0}} \),
which leads to the fingerprint \( \f_2 = \Set{(\otR, \ke_1,1), (\otR, \ke_2,2)} \),
and the kv-store \( \mkvs_2 \):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\stub$ & {a} & $\txid$\\
    {a} & $\Set{\txid_1}$ & {a} & $\Set{\txid_2}$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=14mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
 {a} & $\stub$ & {a} & $\stub$ \\
  {a} & $\Set{\txid_1,\txid_2}$ & {a} & $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
It is trivial that \( \ET_\CP \vdash (\mkvs_1,\vi_2) \csat \f_2 : (\mkvs_2,\vi_2)\), and also for \( \ET_\SI \).

Commutative allows to swap two fingerprints from different clients and still yields the same kv-store.
It is not the case here.
If we let \( \f_2 \) commits first we have the following kv-store \( \mkvs'_2 \):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\stub$ & {a} & $\txid$\\
    {a} & $\emptyset$ & {a} & $\Set{\txid_2}$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
 {a} & $\stub$ & {a} & $\stub$ \\
  {a} & $\Set{\txid_2}$ & {a} & $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
Over the \( \mkvs'_2 \), the view \( \vi_1 \) is no longer valid because in \( \ET_\CP \):
\[
0 \in \vi_1(\ke_2)  
\wedge \WTx(\hh(\ke_1, 1)) \toEdge{(((\PO \cup \RF_{\hh}) ; \AD_{\hh}^?) \cup \VO_{\hh})^{+}} \WTx(\hh(\ke_2, 0)) 
\]
but \( i \notin \vi_1(\ke_1)\).
It is similar for \( \ET_\SI \).

