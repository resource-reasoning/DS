\subsection{\( \ET \)s matching views}
\label{sec:et-match-view}

To recall, 
two execution tests $\ET_1$ and $\ET_2$ have matching views if for any \(\mkvs, \mkvs',\fp,\vi_1,\vi_2,\vi_1',\vi_2'\):
\begin{centermultline}
    \ET_1 \vdash (\mkvs,\vi_1) \csat \fp : (\mkvs', \vi_1' ) \land
    \ET_2 \vdash (\mkvs,\vi_2) \csat \fp : (\mkvs', \vi_2' )  \\
    {} \implies
    \exsts{\vi, \vi'}
    \ET_1 \vdash (\mkvs,\vi) \csat \fp : (\mkvs', \vi' ) \land
    \ET_2 \vdash (\mkvs,\vi) \csat \fp : (\mkvs', \vi' )  
    \land \dagger(\vi) \land \begin{bracketarray} \fora{\vi''} \dagger(\vi'') \implies \vi \viewleq \vi'' \end{bracketarray} \\
    {} \land \min(\ET_1, \mkvs', \cl)(\key) \cup \min(\ET_2, \mkvs', \cl)(\key) = \vi'(\key) \subseteq \vi'_1(\key) \cup \vi'_2(\key) 
\end{centermultline}

\Cref{tab:et-def-minimum-footprint} presents execution tests that are adapted to satisfy the minimum footprint.
\begin{table}[h!]
    \centering
    \caption{Minimum view for clients}
    \label{tab:et-minimum-view}
\begin{tabular}{ @{} l r  @{} }
\hline
Model & \(\min(\ET, \mkvs, \cl)\)
\\
\hline
\MR & $\getView[\mkvs,\Set{\txid }[\exsts{\txid_{\cl}} \txid \toEDGE{\WR_\mkvs} \txid_{\cl}]]$
\\
\MW & \(\vi_0\) \\
\RYW & $\getView[\mkvs,\Set{\txid_{\cl} \in \mkvs }]$  \\
\WFR & \(\vi_0\) \\
\hline
\end{tabular}%
\end{table}
Given \cref{tab:et-def-minimum-footprint} the minimum views \( \vi \) for transitions \( (\mkvs,\vi) \csat \fp : (\mkvs',\vi' )\):
\begin{table}[h!]
    \centering
    \caption{Minimum views for fingerprints}
    \label{tab:et-minimum-fingerprint}
\begin{tabular}{ @{} l r  @{} }
\hline
Model & Given \((\mkvs,\vi) \csat \fp : (\mkvs',\vi')\), the minimum view that has the effect:
\\
\hline
\MR & $\getView[\mkvs,\Set{\txid }[\exsts{\txid_{\cl}} \txid \toEDGE{\WR_{\mkvs'}} \txid_{\cl}]  \cup \Set{\txid_0} ]$ \\
\MW & \allowed[\mkvs,\vi,\fp,\SO\rflx] \\
\RYW & $\getView[\mkvs,\Set{\txid_{\cl} \in \mkvs} \cup \Set{\txid}[\exsts{\txid'} \txid \in \mkvs' \land \txid' \notin \mkvs \land \txid \toEDGE{\WR_{\mkvs'}} \txid' ] \cup \Set{\txid_0} ]$  \\
\WFR & \allowed[\mkvs,\vi,\fp, \WR_\mkvs ; \SO\rflx ] \\
\hline
\end{tabular}%
\end{table}
where,
\begin{align*}
    \allowed[\mkvs, \vi, \fp, R] & \defeq  
    \exsts{\txidset} \Tx[\mkvs,\vi] \subseteq \txidset 
    \land \begin{bracketarray} 
        \fora{ \txid \in \txidset, \txid' \in \mkvs } 
        \exsts{\key,\val,i} 
        (\otR,\key,\val) \in \fp \\
        {} \land \txid = \wtOf[\mkvs(\key,i)]
        \land \txid' \in \mkvs 
        {} \land \txid' \toEDGE{R^*} \txid \implies \txid' \in \txidset 
    \end{bracketarray} 
    \land \vi = \getView[\mkvs, \txidset]  \\
    \allowed[\mkvs, \vi, \fp, R] & \defeq 
    \vi = \getView[\mkvs, \func{lfpTx}[\mkvs,\vi,\fp, R]] \\
    \func{lfpTx}[\mkvs,\vi,\fp, R] 
    & \defeq 
    \mu X . 
    \begin{bracketarray}
        \left( \Tx[\mkvs,\vi] \cap \Set{\wtOf[\mkvs(\key,i)]}[\exsts{\val} (\otR,\key,\val) \in \fp ] \right) \subseteq X  \\
        \land \begin{bracketarray} \fora{ \txid \in X, \txid' \in \mkvs} \txid' \toEDGE{R} \txid \implies \txid' \in X \end{bracketarray} 
    \end{bracketarray} 
\end{align*}


\begin{theorem}
    \( \MR \), \( \MW \), \( \RYW \) and \( \WFR \) have matching views.
\end{theorem}
\begin{proof}
Assume the following where free variable are universally quantified:
\begin{centermultline}
    \ET_{\MR} \vdash (\mkvs,\vi_1) \csat \fp : (\mkvs', \vi_1' ) 
    \land \ET_{\MW} \vdash (\mkvs,\vi_2) \csat \fp : (\mkvs', \vi_2' ) \\
    {} \land \ET_{\RYW} \vdash (\mkvs,\vi_3) \csat \fp : (\mkvs', \vi_3' )
    \land \ET_{\WFR} \vdash (\mkvs,\vi_4) \csat \fp : (\mkvs', \vi_4' ) 
\end{centermultline}
Let \( \cl \) the client who commit the fingerprint.
Let \( \vi \) be the view satisfies \cref{tab:et-minimum-fingerprint}, that is,
\begin{centermultline}
    \vi = \getView[\mkvs, \Set{\txid_0} \cup \Set{\txid }[\exsts{\txid_{\cl}} \txid \toEDGE{\WR_{\mkvs'}} \txid_{\cl}] \cup \Set{\txid_{\cl} \in \mkvs} \cup \func{lfpTx}[\mkvs,\vi_2,\fp, \SO\rflx] \cup \func{lfpTx}[\mkvs,\vi_4,\fp, \WR_\mkvs ; \SO\rflx] ]
\end{centermultline}
and \( \vi \) be the view satisfies \cref{tab:et-minimum-view}:
\begin{centermultline}
    \vi' = \getView[\mkvs', \Set{\txid_0} \cup \Set{\txid }[\exsts{\txid_{\cl}} \txid \toEDGE{\WR_{\mkvs'}} \txid_{\cl}] \cup \Set{\txid_{\cl} \in \mkvs'} \cup \func{lfpTx}[\mkvs,\vi_2,\fp, \SO\rflx] \cup \func{lfpTx}[\mkvs,\vi_4,\fp, \WR_\mkvs ; \SO\rflx] ]
\end{centermultline}
We now prove that \( \ET_\MR \cap \ET_\MW \cap \ET_\RYW \cap \ET_\WFR \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi')\).
We first prove under the new views, it still satisfies the \( \MW \) and \( \WFR \).
Alongside the proofs of \( \MW  \) and \( \WFR \), we also prove \( \bigwedge_{1 \leq i \leq 4} \max(\vi)(\key) = \max(\vi_i)(\key) \) for any key \( \key \) being read.
Last we prove that under the new final view \( \vi' \), it still satisfies \( \MR \) and \( \RYW \).
\begin{itemize}
    \item \( \MW \).
        Let assume a key \( \key \) that has been accessed, \ie \( \exsts{l,\val} (l,\key,\val) \in \fp \).
        Let assume the n-\emph{th} version of \( key \), such that \( n \notin \vi_2(\key) \) and \( n \in \vi_1(\key) \cup \vi_3(\key) \cup \vi_4(\key) \).
        Note that \( \bigwedge_{1 \leq i \leq 4} n < \max(\vi_i(\key))\).
        Let assume another version of \( \key \), says the m-\emph{th} version, such that \( \wtOf[\mkvs(\key,j)] \toEDGE{\SO^*} \).
    \item \( \WFR \).
    \item \( \MR \). Given \( \vi_1 \viewleq \vi'_1 \) it is easy to see that \( \vi \viewleq \vi' \) and then \( \ET_\MR \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).
    \item \( \RYW \). 
    Since that \( \vi'(\key) = \vi'_1(\key) \cup \vi'_2(\key) \) for any key \(\key\), 
    it follows that \( \vi' \) contains all the version written by the client of the new transaction \( \txid \):
    \[
        \fora{\key,i} \txid \in \mkvs' \land \txid \notin \mkvs \wtOf[\mkvs'(\key,i)] \toEDGE{\SO\rflx} \txid \implies i \in \vi'(\key)
    \]
    That is, \( \ET_\RYW \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).

\end{itemize}
\end{proof}




\begin{lemma}
\( \MR \) and \( \MW \) have matching views.
\end{lemma}
\begin{proof}
Assume kv-stores \( \mkvs, \mkvs' \), a fingerprints \( \fp \) and views \( \vi_1, \vi'_1, \vi_2, \vi'_2 \):
\begin{centermultline}
    \ET_{\MR} \vdash (\mkvs,\vi_1) \csat \fp : (\mkvs', \vi_1' ) \land
    \ET_{\MW} \vdash (\mkvs,\vi_2) \csat \fp : (\mkvs', \vi_2' )
    \land \begin{bracketarray}\fora{l, \key, \val} (l, \key, \val) \in \fp \implies \max(\vi_1(\key)) = \max(\vi_2(\key))\end{bracketarray} 
\end{centermultline}
We pick \(\vi, \vi' \) such that:
\begin{centermultline}
    \fora{\key} 
    \begin{bracketarray}\exsts{l,\val} (l,\key,\val) \in \fp \implies \vi_1(\key) \cup \vi_2(\key) = \vi(\key)\end{bracketarray} \\
    {} \land \begin{bracketarray}
        \nexists l,\val \ldotp \; (l,\key,\val) \in \fp 
        \implies \vi_1(\key) \cup \vi_2(\key) \cup \vi'_1(\key) \cup \vi'_2(\key) = \vi(\key)
\end{bracketarray}
    \land \vi'(\key) = \vi'_1(\key) \cup \vi'_2(\key)
\end{centermultline}
Given \( \vi_1 \viewleq \vi'_1 \) it is easy to see that \( \vi \viewleq \vi' \) and then \( \ET_\MR \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).
Given that \( \fora{\key} \exsts{l,\val}  (l,\key,\val) \in \fp \implies \vi_1(\key) \cup \vi_2(\key) = \vi(\key) \), it means \( \allowed[\mkvs,\vi,\fp,\SO\rflx]\),
and thus \( \ET_\MW \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).
\end{proof}

\begin{lemma}
    \( \MR \) and \( \RYW \) have matching views.
\end{lemma}
\begin{proof}
Assume kv-stores \( \mkvs, \mkvs' \), a fingerprints \( \fp \) and views \( \vi_1, \vi'_1, \vi_2, \vi'_2 \):
\begin{centermultline}
    \ET_{\MR} \vdash (\mkvs,\vi_1) \csat \fp : (\mkvs', \vi_1' ) \land
    \ET_{\RYW} \vdash (\mkvs,\vi_2) \csat \fp : (\mkvs', \vi_2' )
    \land \begin{bracketarray}\fora{l, \key, \val} (l, \key, \val) \in \fp \implies \max(\vi_1(\key)) = \max(\vi_2(\key))\end{bracketarray} 
\end{centermultline}
We pick \(\vi, \vi' \) such that:
\begin{centermultline}
    \fora{\key} 
    \begin{bracketarray}\exsts{l,\val} (l,\key,\val) \in \fp \implies \vi_1(\key) \cup \vi_2(\key) = \vi(\key)\end{bracketarray} \\
    {} \land \begin{bracketarray}
        \nexists l,\val \ldotp \; (l,\key,\val) \in \fp 
        \implies \vi_1(\key) \cup \vi_2(\key) \cup \vi'_1(\key) \cup \vi'_2(\key) = \vi(\key)
\end{bracketarray}
    \land \vi'(\key) = \vi'_1(\key) \cup \vi'_2(\key)
\end{centermultline}
Given \( \vi_1 \viewleq \vi'_1 \) it is easy to see that \( \vi \viewleq \vi' \) and then \( \ET_\MR \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).
Since that \( \vi'(\key) = \vi'_1(\key) \cup \vi'_2(\key) \) for any key \(\key\), 
it follows that \( \vi' \) contains all the version written by the client of the new transaction \( txid \):
\[
    \fora{key,i} \txid \in \mkvs' \land \txid \notin \mkvs \wtOf[\mkvs'(\key,i)] \toEDGE{\SO\rflx} \txid \implies i \in \vi'(\key)
\]
That is, \( \ET_\RYW \vdash (\mkvs,\vi) \csat \fp : (\mkvs',\vi') \).
\end{proof}

