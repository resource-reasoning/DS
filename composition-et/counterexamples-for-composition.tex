\subsection{Counter examples for compositionality}
\label{sec:counter-examples-composition}
For compositionality of two execution tests, 
it is not enough that one execution test is commutative.
The following three counter examples lead us to further restrict the execution tests.

\subsubsection{No blind write}
\label{ex:noblindwrites}
\label{sec:no-blind-writes-counter}

Let consider a kv-store \( \mkvs = \Set{\ke \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid,\emptyset) }\):
\begin{centertikz}
%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} \& $\txid_0$ \& {a} \& $\txid$\\
    {a} \& $\emptyset$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi_1) \csat \f, (\mkvs',\vi') 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi_2) \csat \f, (\mkvs',\vi') 
\]
where \( \vi_1 = \Set{\ke \mapsto \Set{0} }\), \( \vi' = \vi_2 = \Set{\ke \mapsto \Set{0,1}} \) and \( \f = \Set{(\otW, \ke, 2)}\).
This leads to the final kv-store \( \mkvs' = \mkvs\rmto{\ke}{\mkvs(\ke) \lcat (2,\txid',\emptyset)} \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
        {a} \& $\txid_0$ \& {a} \& $\txid$ \& {a} \& $\txid'$ \\
    {a} \& $\emptyset$ \& {a} \& $\emptyset$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};
\tikzvalue{versionx-1-5}{versionx-2-5}{locx-v1}{$2$};
\end{centertikz}

It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
If execution tests enforce \emph{no blind write}, \( \ET_1\) and \( \ET_2 \) cannot produce the same kv-store, thus \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \emptyset\), because the initial views are different.

\begin{definition}[No blind writes]
\label{def:noblidwrites}
An execution test $\ET$ has \emph{no blind writes} if, whenever $\ET \vdash (\hh, \vi) \csat \opset \cup \{(\otW, \ke, \stub)\} : (\mkvs',\vi')$, 
then $(\otR, \ke, \stub) \in \opset$.
\end{definition}


\subsubsection{minimum footprint}
\label{sec:minimum-footprint-counter}
Let consider a kv-store \( \mkvs = \Set{\ke_1 \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid_1,\emptyset), \ke_2 \mapsto (2,\txid_0,\emptyset) \lcat (3,\txid_2,\emptyset)}\):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} \& $\txid_0$ \& {a} \& $\txid_1$\\
    {a} \& $\emptyset$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
   {a} \& $\txid_0$ \& {a} \& $\txid_2$ \\
   {a} \& $\emptyset$ \& {a} \& $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi_1) \csat \f, (\mkvs',\vi') 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi_2) \csat \f, (\mkvs',\vi') 
\]
where \( \vi_1 = \Set{\ke_1 \mapsto \Set{0}, \ke_2 \mapsto \Set{0} }\), \( \vi_2 = \Set{\ke_1 \mapsto \Set{0}, \ke_2 \mapsto \Set{0,1} }\) and \( \f = \Set{(\otR, \ke_1, 0)}\).
This leads to the final kv-store \( \mkvs' = \mkvs\rmto{\ke}{(0,\txid_0,\Set{\txid'}) \lcat (1,\txid_1,\emptyset)} \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} \& $\txid_0$ \& {a} \& $\txid_1$\\
    {a} \& $\Set{\txid'}$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\ke_2 \mapsto$};
\matrix(versiony) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
   at ([xshift=\tikzkvspace]locy.east) {
   {a} \& $\txid_0$ \& {a} \& $\txid_2$ \\
   {a} \& $\emptyset$ \& {a} \& $\emptyset$\\
};

\tikzvalue{versiony-1-1}{versiony-2-1}{locy-v0}{$2$};
\tikzvalue{versiony-1-3}{versiony-2-3}{locy-v1}{$3$};
\end{centertikz}
It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
\begin{definition}[Minimum footprints]
\label{def:et-minimum-footprint}
An execution test $\ET$ has \emph{minimum footprints} if for any key-value store \( \hh \)
views \( \vi, \vi',\vi''\) and fingerprint \( \f \),
\[
\begin{array}{@{}l@{}}
    \ET \vdash (\hh, \vi) \csat \opset : (\mkvs',\vi'')
\land \fora{ \ke} \left( (\stub, \ke, \stub) \in \f \implies \vi(\ke) = \vi'(\ke) \right) 
\implies \ET \vdash (\hh, \vi') \csat \opset : (\mkvs',\vi'')
\end{array}
\]
\end{definition}
If execution tests enforce \emph{minimum footprint}, 
given that \( \ke_2 \) does not appear in the fingerprint \( \f \),
then we have 
\(
\ET_2 \vdash (\mkvs, \vi_2) \csat \f, (\mkvs',\vi') 
\implies 
\ET_2 \vdash (\mkvs, \vi_1) \csat \f, (\mkvs',\vi') 
\).
This means \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \Set{\mkvs'}\).

\subsubsection{monotonic post-views}
Let consider a kv-store \( \mkvs = \Set{\ke \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid,\emptyset) }\):
\begin{centertikz}
%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} \& $\txid_0$ \& {a} \& $\txid$\\
    {a} \& $\emptyset$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi) \csat \f, (\mkvs',\vi_1) 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi) \csat \f, (\mkvs',\vi_2) 
\]
where \( \vi = \vi_1 = \Set{\ke \mapsto \Set{0} }\), \(\vi_2 = \Set{\ke \mapsto \Set{0,1}} \) and \( \f = \Set{(\otR, \ke, 0)}\).
This leads to the final kv-store \( \mkvs' = \Set{\ke \mapsto (0,\txid_0,\Set{\txid'}) \lcat (1,\txid,\emptyset) } \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list,column 2/.style={text width=8mm},column 4/.style={text width=8mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} \& $\txid_0$ \& {a} \& $\txid$\\
    {a} \& $\Set{\txid'}$ \& {a} \& $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};
\end{centertikz}
It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
\begin{definition}
\label{def:et-continuous-postview}
\label{def:et-monotonic-postview}
An execution test $\ET$ has \emph{monotonic post-views} if for any key-value store \( \hh \)
views \( \vi, \vi',\vi''\) and fingerprint \( \f \), 
\[
\begin{array}{@{}l@{}}
    \ET \vdash (\hh, \vi) \csat \opset : (\mkvs',\vi') \land \vi' \sqsubseteq \vi'' \implies \ET \vdash (\hh, \vi) \csat \opset : (\mkvs',\vi'')
\end{array}
\]
\end{definition}
If execution tests enforce \emph{monotonic post-views}, 
we have 
\( 
    \ET_1 \vdash (\mkvs, \vi) \csat \f, (\mkvs',\vi_1) \implies 
    \ET_1 \vdash (\mkvs, \vi) \csat \f, (\mkvs',\vi_2) 
\)
thus \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \Set{\mkvs'}\).


