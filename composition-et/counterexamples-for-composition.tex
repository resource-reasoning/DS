\subsection{Counter examples for compositionality}
\label{sec:counter-examples-composition}
For compositionality of two execution tests, 
it is not enough that one execution test is commutative.
The following three counter examples lead us to further restrict the execution tests.

\subsubsection{No blind write}
\label{ex:noblindwrites}
\label{sec:no-blind-writes-counter}

Let consider a kv-store \( \mkvs = \Set{\key \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid,\emptyset) }\):
\begin{centertikz}
%Location x
\node(locx) {$\key \mapsto$};

\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
    /$0$/$\txid_0$/$\emptyset$
    , /$1$/$\txid$/$\emptyset$
}};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi_1) \csat \fp, (\mkvs',\vi') 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi_2) \csat \fp, (\mkvs',\vi') 
\]
where \( \vi_1 = \Set{\key \mapsto \Set{0} }\), \( \vi' = \vi_2 = \Set{\key \mapsto \Set{0,1}} \) and \( \fp = \Set{(\otW, \key, 2)}\).
This leads to the final kv-store \( \mkvs' = \mkvs\rmto{\key}{\mkvs(\key) \lcat (2,\txid',\emptyset)} \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\key \mapsto$};

\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
    /$0$/$\txid_0$/$\emptyset$
    , /$1$/$\txid$/$\emptyset$
    , /$2$/$\txid'$/$\emptyset$
}};
\end{centertikz}

It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
If execution tests enforce \emph{no blind write}, \( \ET_1\) and \( \ET_2 \) cannot produce the same kv-store, thus \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \emptyset\), because the initial views are different.

\begin{definition}[No blind writes]
\label{def:noblidwrites}
An execution test $\ET$ has \emph{no blind writes} if, whenever $\ET \vdash (\mkvs, \vi) \csat \fp \cup \{(\otW, \key, \stub)\} : (\mkvs',\vi')$, 
then $(\otR, \key, \stub) \in \fp$.
\end{definition}


\subsubsection{minimum footprint}
\label{sec:minimum-footprint-counter}
Let consider a kv-store \( \mkvs = \Set{\key_1 \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid_1,\emptyset), \key_2 \mapsto (2,\txid_0,\emptyset) \lcat (3,\txid_2,\emptyset)}\):
\begin{centertikz}
%Location x
\node(locx) {$\key_1 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
    /$0$/$\txid_0$/$\emptyset$
    , /$1$/$\txid_1$/$\emptyset$
}};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\key_2 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locy.east) {vlist={versiony}{%
    /$2$/$\txid_0$/$\emptyset$
    , /$3$/$\txid_2$/$\emptyset$
}};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi_1) \csat \fp, (\mkvs',\vi') 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi_2) \csat \fp, (\mkvs',\vi') 
\]
where \( \vi_1 = \Set{\key_1 \mapsto \Set{0}, \key_2 \mapsto \Set{0} }\), \( \vi_2 = \Set{\key_1 \mapsto \Set{0}, \key_2 \mapsto \Set{0,1} }\) and \( \fp = \Set{(\otR, \key_1, 0)}\).
This leads to the final kv-store \( \mkvs' = \mkvs\rmto{\key}{(0,\txid_0,\Set{\txid'}) \lcat (1,\txid_1,\emptyset)} \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\key_1 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
        /$0$/$\txid_0$/$\Set{\txid'}$
    , /$1$/$\txid_1$/$\emptyset$
}};

%Location y
\path (versionx.east) + (1,0) node (locy) {$\key_2 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locy.east) {vlist={versiony}{%
    /$2$/$\txid_0$/$\emptyset$
    , /$3$/$\txid_2$/$\emptyset$
}};
\end{centertikz}
It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
\begin{definition}[Minimum footprints]
\label{def:et-minimum-footprint}
An execution test $\ET$ has \emph{minimum footprints} if for any key-value store \( \mkvs \)
views \( \vi, \vi',\vi''\) and fingerprint \( \fp \),
\[
\begin{array}{@{}l@{}}
    \ET \vdash (\mkvs, \vi) \csat \fp : (\mkvs',\vi'')
\land \fora{ \key} \left( (\stub, \key, \stub) \in \fp \implies \vi(\key) = \vi'(\key) \right) 
\implies \ET \vdash (\mkvs, \vi') \csat \fp : (\mkvs',\vi'')
\end{array}
\]
\end{definition}
If execution tests enforce \emph{minimum footprint}, 
given that \( \key_2 \) does not appear in the fingerprint \( \fp \),
then we have 
\(
\ET_2 \vdash (\mkvs, \vi_2) \csat \fp, (\mkvs',\vi') 
\implies 
\ET_2 \vdash (\mkvs, \vi_1) \csat \fp, (\mkvs',\vi') 
\).
This means \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \Set{\mkvs'}\).

\subsubsection{monotonic post-views}
Let consider a kv-store \( \mkvs = \Set{\key \mapsto (0,\txid_0,\emptyset) \lcat (1,\txid,\emptyset) }\):
\begin{centertikz}
%Location x
\node(locx) {$\key_1 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
        /$0$/$\txid_0$/$\emptyset$
    , /$1$/$\txid$/$\emptyset$
}};
\end{centertikz}
and the following two execution test:
\[
    \ET_1 \vdash (\mkvs, \vi) \csat \fp, (\mkvs',\vi_1) 
    \qquad 
    \ET_2 \vdash (\mkvs, \vi) \csat \fp, (\mkvs',\vi_2) 
\]
where \( \vi = \vi_1 = \Set{\key \mapsto \Set{0} }\), \(\vi_2 = \Set{\key \mapsto \Set{0,1}} \) and \( \fp = \Set{(\otR, \key, 0)}\).
This leads to the final kv-store \( \mkvs' = \Set{\key \mapsto (0,\txid_0,\Set{\txid'}) \lcat (1,\txid,\emptyset) } \) for some \( \txid' \):
\begin{centertikz}
%Location x
\node(locx) {$\key_1 \mapsto$};
\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={versionx}{%
        /$0$/$\txid_0$/$\Set{\txid'}$
    , /$1$/$\txid$/$\emptyset$
}};

\end{centertikz}
It is easy to see \( \ET_1 \cap \ET_2  = \emptyset \) therefore \( \CMs(\ET_1 \cap \ET_2) = \emptyset \), yet \( \CMs(\ET_1) \cap \CMs(\ET_2) = \Set{\mkvs'}\).
\begin{definition}
\label{def:et-continuous-postview}
\label{def:et-monotonic-postview}
An execution test $\ET$ has \emph{monotonic post-views} if for any key-value store \( \mkvs \)
views \( \vi, \vi',\vi''\) and fingerprint \( \fp \), 
\[
\begin{array}{@{}l@{}}
    \ET \vdash (\mkvs, \vi) \csat \fp : (\mkvs',\vi') \land \vi' \sqsubseteq \vi'' \implies \ET \vdash (\mkvs, \vi) \csat \fp : (\mkvs',\vi'')
\end{array}
\]
\end{definition}
If execution tests enforce \emph{monotonic post-views}, 
we have 
\( 
    \ET_1 \vdash (\mkvs, \vi) \csat \fp, (\mkvs',\vi_1) \implies 
    \ET_1 \vdash (\mkvs, \vi) \csat \fp, (\mkvs',\vi_2) 
\)
thus \( \CMs(\ET_1) \cap \CMs(\ET_2) = \CMs(\ET_1 \cap \ET_2) = \Set{\mkvs'}\).


