\begin{figure*}[h]
\captionsetup[subfigure]{aboveskip=-5pt, belowskip=5pt}
\begin{tabular}{@{} c | c | c | c@{}}
\hline
\phantom{-}& \phantom{-}& \phantom{-}& \phantom{-}\\
\begin{subfigure}{0.15\textwidth}
\begin{centertikz}
%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\txid_0$ \\
    {a} & $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\end{centertikz}\vspace{5pt}%
\caption{Initial state}
\label{fig:counter_kv_initial}
\end{subfigure}
&
\begin{subfigure}{0.22\textwidth}
\begin{centertikz}

%Location x
\node(locx) {$\ke_1 \mapsto$};

\matrix(versionx) [version list, column 2/.style={text width=6mm}, column 4/.style={text width=6mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\txid_0$ & {a} & $\txid$\\
    {a} & $\left\{\txid \right\}$ & {a} & $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};

\end{centertikz}\vspace{5pt}
\caption{After \(\txid \)}
\label{fig:counter_kv_first_inc}
\end{subfigure}
&
\begin{subfigure}{0.22\textwidth}
\begin{centertikz}

%Location x
\node(locx) {$\ke \mapsto$};

\matrix(versionx) [version list, column 2/.style={text width=6mm}, column 3/.style={dotted}, column 4/.style={text width=6mm,dotted}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\txid_0$ & {a} & $\color{gray}\txid$\\
    {a} & $\left\{\txid \right\}$ & {a} & $\color{gray}\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\node[version node,fit=(versionx-1-3) (versionx-2-3),fill=white,inner sep=0pt,draw=none] (locx-v1) {\color{gray}$1$};

\end{centertikz}\vspace{5pt}
\caption{View of \( \cl_2 \) before \( \txid' \)}
\label{fig:counter_kv_view}
\end{subfigure} 
&
\begin{subfigure}{0.30\textwidth}
\begin{centertikz}
\node(locx) {$\ke \mapsto$};
\matrix(versionx) [version list, column 2/.style={text width=10mm}]
    at ([xshift=\tikzkvspace]locx.east) {
    {a} & $\txid_0$ & {a} & $\txid$ & {a} & $\txid'$\\
    {a} & $\{\txid, \txid'\}$ & {a} & $\emptyset$ & {a} & $\emptyset$ \\
};
\tikzvalue{versionx-1-1}{versionx-2-1}{locx-v0}{$0$};
\tikzvalue{versionx-1-3}{versionx-2-3}{locx-v1}{$1$};
\tikzvalue{versionx-1-5}{versionx-2-5}{locx-v2}{$1$};
\end{centertikz}%
\vspace{5pt}
\caption{After \( \txid' \), lost update}
\label{fig:counter_kv_final}
\label{fig:ua-disallowed}
\end{subfigure}\\
\hline
\end{tabular}
\caption{Example key-value stores (\subref{fig:counter_kv_initial}, \subref{fig:counter_kv_first_inc}, \subref{fig:counter_kv_final}); a client view (\subref{fig:counter_kv_view})}
\vspace*{-5pt}
\end{figure*}
