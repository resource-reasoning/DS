\pgfdeclarelayer{main}
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}


% global variable environment
\newcommand{\tikzkvspace}{1.5pt}
\newcommand{\tikzkeyspace}{-1.1}
\NewEnviron{centertikz}{%
    \begin{center}%
    \scalebox{.8}{%
    \begin{tikzpicture}[every node/.style={inner sep=0,outer sep=0},font=\large]%
    \BODY%
    \end{tikzpicture}%
    }%
    \end{center}%
}

\tikzstyle{background}=[rectangle, draw=black, inner sep=0.2cm, rounded corners=1.2mm]

\tikzset{
    v-cell/.style={
        rectangle,
        minimum height=5mm,
        text depth=0.5ex,
        minimum width=5mm,
        text height=2ex,
        inner sep=0pt,
        outer sep=0pt
        %,font=\footnotesize
    },      
    nonvisible/.style={
        dotted,
        gray
    },
    pics/singleversion/.style n args = {4}{
        code = {
        \node[v-cell] (A) at (0,0) {#2};  
        \node[anchor=south west,v-cell] (B) at (A.east){#3};
        \node[anchor=north west,v-cell] (C) at (A.east){#4};
        \draw (B.north west) -- (C.south west)
              (B.south west) -- (C.north east);    
        \node[outer sep=0pt,inner sep=0pt,draw,fit=(A)(B)(C)] (#1) {}; 
        }
    },
    pics/vlist/.style n args = {2}{
        code={
        \def\vlistname{#1}
        \coordinate (VERSION-TEMP) at (0,0);
        \coordinate (\vlistname) at (0,0);
        \foreach \vi/\v/\wt/\rs in {#2}
        {
            % draw a new version
            \draw pic [\vi,anchor=east,right=0pt of VERSION-TEMP] {singleversion={VERSION-TEMP}{\v}{\wt}{\rs}};
            % add the new version into the node vlistname
            \node[inner sep=0pt, outer sep=0pt,fit=(\vlistname)(VERSION-TEMP)] (\vlistname) {};
        }
        }
    }
}
%% the following is the demo of vilist
%\node (NODE-NAME) {$KEY-NAME \mapsto$};

%\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={LEFT-MOST-COORDINATOR-NAME}{%
        %VERSION-LIST-CONTENT
        % [nonvisible]/value/writer/readers, ...
        % with maximum 10 elements
%}};
%e.g.
%\node(locx) {$\key_1 \mapsto$};

%\draw pic at ([xshift=\tikzkvspace]locx.east) {vlist={xlist}{%
        %/0/$\txid_0$/$\t$,%
        %nonvisible/1/$\txid_1$/$\t'$,%
        %/2/$\txid_2$/$\Set{\txid_3}$%
%}};

